function openWebPaint(){window.TextCursor||(window.TextCursor=function(t,e){this.fillStyle=t||"rgba(0, 0, 0, 0.7)",this.width=e||2,this.left=0,this.top=0},window.TextCursor.prototype={getHeight:function(t){var e=t.measureText("W").width;return e+e/6},createPath:function(t){t.beginPath(),t.rect(this.left,this.top,this.width,this.getHeight(t))},draw:function(t,e,i){t.save(),this.left=e,this.top=i-this.getHeight(t),this.createPath(t),t.lineWidth=1,t.fillStyle=this.fillStyle,t.fill(),t.restore()},erase:function(t){window.NOTEPAD.restoreCanvas([this.left-1,this.top,this.width+2,this.getHeight(t)])}}),window.TextLine||(window.TextLine=function(t,e){this.text="",this.left=t,this.bottom=e,this.caret=0},window.TextLine.prototype={insert:function(t){var e=this.text.slice(0,this.caret),i=this.text.slice(this.caret);e+=t,this.text=e,this.text+=i,this.caret+=t.length},getCaretX:function(t){var e=this.text.substring(0,this.caret),i=t.measureText(e).width;return this.left+i},removeCharacterBeforeCaret:function(){0!==this.caret&&(this.text=this.text.substring(0,this.caret-1)+this.text.substring(this.caret),this.caret--)},removeLastCharacter:function(){this.text=this.text.slice(0,-1)},getWidth:function(t){return t.measureText(this.text).width},getHeight:function(t){var e=t.measureText("W").width;return e+e/6},draw:function(t){t.save(),t.textAlign="start",t.textBaseline="bottom",t.lineWidth=1,t.strokeText(this.text,this.left,this.bottom),t.fillText(this.text,this.left,this.bottom),t.restore()},erase:function(t){window.NOTEPAD.restoreCanvas()}}),window.Paragraph||(window.Paragraph=function(t,e,i,n,s){this.context=t,this.drawingSurface=n,this.left=e,this.top=i,this.lines=[],this.activeLine=void 0,this.cursor=s,this.blinkingInterval=void 0},window.Paragraph.prototype={clearIntervals:function(t){this.blinkingInterval=window.clearInterval(this.blinkingInterval),this.blinkingTimeout=window.clearTimeout(this.blinkingTimeout),this.cursor.erase(this.context,this.drawingSurface),"function"!=typeof t||this.blinkingInterval?this.blinkingInterval&&this.clearIntervals(t):t()},isPointInside:function(t){var e=this.context;return e.beginPath(),e.rect(this.left,this.top,this.getWidth(),this.getHeight()),e.isPointInPath(t.x,t.y)},getHeight:function(){var t=0;return this.lines.forEach(Function.prototype.bind.call((function(e){t+=e.getHeight(this.context)}),this)),t},getWidth:function(){var t=0,e=0;return this.lines.forEach(Function.prototype.bind.call((function(i){t=i.getWidth(this.context),e<t&&(e=t)}),this)),e},draw:function(){this.lines.forEach(Function.prototype.bind.call((function(t){t.draw(this.context)}),this))},erase:function(t){window.NOTEPAD.restoreCanvas()},addLine:function(t){this.lines.push(t),this.activeLine=t,this.moveCursor(t.left,t.bottom)},insert:function(t){this.erase(this.context,this.drawingSurface),this.activeLine.insert(t);var e=this.activeLine.text.substring(0,this.activeLine.caret),i=this.context.measureText(e).width;this.moveCursor(this.activeLine.left+i,this.activeLine.bottom),this.draw(this.context)},blinkCursor:function(t,e){var i=this;this.blinkingInterval&&(this.blinkingInterval=window.clearInterval(this.blinkingInterval)),this.blinkingInterval=setInterval((function(t){var e=window.NOTEPAD.drawOptions[window.NOTEPAD.selectedDrawOption];e&&("text"===e.type?(i.cursor.erase(i.context,i.drawingSurface),i.blinkingTimeout&&(i.blinkingTimeout=window.clearTimeout(i.blinkingTimeout)),i.blinkingTimeout=setTimeout((function(t){i.cursor.draw(i.context,i.cursor.left,i.cursor.top+i.cursor.getHeight(i.context))}),200)):i.blinkingInterval=window.clearInterval(i.blinkingInterval))}),900)},moveCursorCloseTo:function(t,e){var i=this.getLine(e);i&&(i.caret=this.getColumn(i,t),this.activeLine=i,this.moveCursor(i.getCaretX(this.context),i.bottom))},moveCursor:function(t,e){this.cursor.erase(this.context,this.drawingSurface),this.cursor.draw(this.context,t,e),this.blinkingInterval||this.blinkCursor(t,e)},moveLinesDown:function(t){for(var e=t;e<this.lines.length;++e){var i=this.lines[e];i.bottom+=i.getHeight(this.context)}},newline:function(){var t,e,i=this.activeLine.text.substring(0,this.activeLine.caret),n=this.activeLine.text.substring(this.activeLine.caret),s=this.context.measureText("W").width+this.context.measureText("W").width/6,o=this.activeLine.bottom+s;this.erase(this.context,this.drawingSurface),this.activeLine.text=i,(e=new TextLine(this.activeLine.left,o)).insert(n),t=this.lines.indexOf(this.activeLine),this.lines.splice(t+1,0,e),this.activeLine=e,this.activeLine.caret=0;for(var a=(t=this.lines.indexOf(this.activeLine))+1;a<this.lines.length;++a)(e=this.lines[a]).bottom+=s;this.draw(),this.cursor.draw(this.context,this.activeLine.left,this.activeLine.bottom)},getLine:function(t){for(var e,i=0;i<this.lines.length;++i)if(t>(e=this.lines[i]).bottom-e.getHeight(this.context)&&t<e.bottom)return e},getColumn:function(t,e){var i,n,s,o,a=!1;for((s=new TextLine(t.left,t.bottom)).insert(t.text);!a&&0<s.text.length;)i=s.left+s.getWidth(this.context),s.removeLastCharacter(),(n=s.left+s.getWidth(this.context))<e&&(o=(e-n<i-e?n:i)===i?s.text.length+1:s.text.length,a=!0);return o},activeLineIsOutOfText:function(){return 0===this.activeLine.text.length},activeLineIsTopLine:function(){return this.lines[0]===this.activeLine},moveUpOneLine:function(){var t,e;t=""+this.activeLine.text;var i=this.lines.indexOf(this.activeLine);this.activeLine=this.lines[i-1],this.activeLine.caret=this.activeLine.text.length,this.lines.splice(i,1),this.moveCursor(this.activeLine.left+this.activeLine.getWidth(this.context),this.activeLine.bottom),this.activeLine.text+=t;for(var n=i;n<this.lines.length;++n)(e=this.lines[n]).bottom-=e.getHeight(this.context)},backspace:function(){var t,e;this.context.save(),0===this.activeLine.caret?this.activeLineIsTopLine()||(this.erase(this.context,this.drawingSurface),this.moveUpOneLine(),this.draw()):(this.erase(this.context,this.drawingSurface),this.activeLine.removeCharacterBeforeCaret(),t=this.activeLine.text.slice(0,this.activeLine.caret),e=this.context.measureText(t).width,this.moveCursor(this.activeLine.left+e,this.activeLine.bottom),this.draw(this.context),this.context.restore())}}),Function.prototype.bind||(Function.prototype.bind=function(t){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var e=Array.prototype.slice.call(arguments,1),i=this,n=function(){},s=function(){return i.apply(this instanceof n&&t?this:t,e.concat(Array.prototype.slice.call(arguments)))};return n.prototype=this.prototype,s.prototype=new n,s});var t,e;t="undefined"!=typeof window?window:this,e=function(t){var e=function(){this.MAX_ITEMS=50,this.currentIndex=0,this.array=[]};e.prototype.add=function(t){if(this.currentIndex<this.array.length-1?(this.array[++this.currentIndex]=t,this.array=this.array.slice(0,this.currentIndex+1)):(this.array.push(t),this.currentIndex=this.array.length-1),this.array.length>this.MAX_ITEMS){var e=this.array.length-this.MAX_ITEMS;this.array=this.array.splice(-this.MAX_ITEMS),this.currentIndex=this.currentIndex-e}},e.prototype.previous=function(){return 0===this.currentIndex?null:this.array[--this.currentIndex]},e.prototype.next=function(){return this.currentIndex===this.array.length-1?null:this.array[++this.currentIndex]},e.prototype.hasPrevious=function(){return 0<this.currentIndex},e.prototype.hasNext=function(){return this.currentIndex<this.array.length-1};var i="undefined"!=typeof chrome?chrome:"undefined"!=typeof browser?browser:void 0,n={canvas:null,context:null,buffer:null,initialized:!1,controlPanelHidden:!1,persistTimer:null,history:null,config:{},drawOptions:[{type:"pen",title:"Pencil - draw a custom line"},{type:"eyedropper",title:"Color picker - pick a color from the web page or your drawings and use it for drawing"},{type:"text",font:"Arial",minSize:15,maxSize:50,title:"Text - insert text"},{type:"line",title:"Line - draw a straight line"},{type:"arrow",title:"Arrow - create arrow on the canvas"},{type:"quadratic_curve",title:"Quadratic curve - draw a quadratic curve",iteration:0,initLoc:null,lastLoc:null},{type:"bezier_curve",title:"Bezier curve - draw a bezier curve",iteration:0,initLoc:null,firstPoint:null,lastPoint:null},{type:"polygon",title:"Polygon - draw a polygon",initLoc:null,lastLoc:null},{type:"circle",title:"Ellipse - draw an ellipse or a circle"},{type:"rectangle",title:"Rectangle - draw a rectangle or a square"},{type:"cursor",title:"Cursor - interact with the web page"},{type:"eraser",title:"Eraser - erase part of your drawings",width:30,height:30},{type:"fill",title:"Paint Bucket - fill an area"}],selectedDrawOption:null,selectedColorOption:null,selectedAlphaOption:null,mousedown:!1,lastMouseDownLoc:null,drawingSurfaceImageData:null,resizeTimeoutID:null,cursor:new TextCursor,paragraph:null,panel:null,browser:{isChrome:/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)},createCanvas:function(){this.canvas=t.document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.canvas.setAttribute("id","NOTEPAD"),this.browser.isChrome||(this.buffer=document.createElement("canvas")),t.document.body.appendChild(this.canvas),t.addEventListener("resize",this.resizeBinded),t.addEventListener("scroll",this.resizeBinded);var e=localStorage.getItem("WP_CRX_STORAGE_SNAPSHOT_"+t.location.pathname);if(e&&isSetAsBack){var i=new Image;i.onload=Function.prototype.bind.call(this.initCanvas,this,i),i.src=e}else this.initCanvas()},initCanvas:function(t){t?(this.handleResize(!0),this.context.drawImage(t,0,0),this.storeCanvas(!0)):this.handleResize(),this.storeHistory()},checkHistoryButtonStatus:function(){this.nextBtn&&this.backBtn&&(this.history.hasNext()?this.removeClass(this.nextBtn,"disabled"):this.addClass(this.nextBtn,"disabled"),this.history.hasPrevious()?this.removeClass(this.backBtn,"disabled"):this.addClass(this.backBtn,"disabled"))},storeHistory:function(){this.history.add(this.context.getImageData(0,0,this.canvas.width,this.canvas.height)),this.checkHistoryButtonStatus()},handleBackButtonClick:function(){this.history.hasPrevious()&&(this.finishLastDrawing(),this.context.putImageData(this.history.previous(),0,0),this.storeCanvas(),this.checkHistoryButtonStatus())},handleForwardButtonClick:function(){this.history.hasNext()&&(this.finishLastDrawing(),this.context.putImageData(this.history.next(),0,0),this.storeCanvas(),this.checkHistoryButtonStatus())},persistLocalStorage:function(){var e=this.canvas.toDataURL();try{t.localStorage.setItem("WP_CRX_STORAGE_SNAPSHOT_"+t.location.pathname,e)}catch(i){try{t.localStorage.clear(),t.localStorage.setItem("WP_CRX_STORAGE_SNAPSHOT_"+t.location.pathname,e)}catch(t){}}},storeCanvas:function(e){this.buffer=this.context.getImageData(0,0,this.canvas.width,this.canvas.height),e||(this.persistTimer&&(this.persistTimer=t.clearInterval(this.persistTimer)),this.persistTimer=t.setTimeout(this.persistLocalStorageBinded,500))},restoreCanvas:function(t){t?(this.context.clearRect.apply(this.context,t),t.unshift(this.buffer,0,0),t[t.length-1]+=1,t[t.length-2]+=1,this.context.putImageData.apply(this.context,t)):(this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.putImageData(this.buffer,0,0))},handlePanelAppearing:function(t){t.target.style.opacity=1},handleResize:function(e){var i=!1,n=t.pageYOffset||document.documentElement.scrollTop,s=(t.innerHeight||document.documentElement.clientHeight,this.context.lineWidth),o=Math.max(document.documentElement.clientWidth,document.body.scrollWidth,document.documentElement.scrollWidth,document.body.offsetWidth,document.documentElement.offsetWidth),a=Math.max(document.documentElement.clientHeight,document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight),r=Math.min(a-this.canvas.offsetTop,5e3);5e3<n-this.canvas.offsetTop?(r=Math.min(a-n,5e3),this.canvas.style.top=n+"px",i=!0):n<this.canvas.offsetTop&&(r=5e3,this.canvas.style.top=Math.max(0,5e3*Math.floor(n/5e3))+"px",i=!0),i?(this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.paragraph&&(this.paragraph.clearIntervals(),this.paragraph=null),this.storeCanvas(!0)):this.storeCanvas(e),this.canvas.width=o,this.canvas.height=r,i||this.restoreCanvas(),this.updatePaintStyle(),this.context.lineWidth=s},createOpenControlsPanelBtn:function(){if(window.location.href.includes("new_tab_view")){let e=t.document.createElement("button");e.setAttribute("class","open_panel");let i=t.document.createElement("img");i.src="images/icon_wp_nt.svg",e.appendChild(i),t.document.body.appendChild(e),e.addEventListener("click",Function.prototype.bind.call(this.openControlsWithBtn,this))}},createLinks:function(){if(window.location.href.includes("new_tab_view")){let e=t.document.createElement("div");e.setAttribute("class","links");let i=t.document.createElement("a");i.href="https://home.web-paint.com/privacy",i.setAttribute("target","_blank"),i.text="Privacy Policy ",e.appendChild(i);let n=t.document.createElement("a");n.href="https://home.web-paint.com/contact_us",n.setAttribute("target","_blank"),n.text="Contact Us ",e.appendChild(n);let s=t.document.createElement("a");s.href="https://home.web-paint.com/tou",s.setAttribute("target","_blank"),s.text="Terms of Use ",e.appendChild(s);let o=t.document.createElement("a");o.href="https://home.web-paint.com/about_us",o.setAttribute("target","_blank"),o.text="About Us ",e.appendChild(o),t.document.body.appendChild(e)}},createControlPanel:function(){this.panel=t.document.createElement("div"),this.backBtn=t.document.createElement("div"),this.nextBtn=t.document.createElement("div");var e=t.document.createElement("div"),i=t.document.createElement("div"),n=t.document.createElement("div"),s=t.document.createElement("div"),o=t.document.createElement("div"),a=t.document.createElement("div");this.panel.setAttribute("id","NOTEPAD_controls"),e.setAttribute("class","NOTEPAD_controls_draw"),i.setAttribute("class","NOTEPAD_controls_color"),n.setAttribute("class","NOTEPAD_controls_control"),s.setAttribute("class","NOTEPAD_controls_range_wrapper"),o.setAttribute("class","NOTEPAD_controls_range alpha_control"),a.setAttribute("class","NOTEPAD_controls_range size_control"),t.document.body.appendChild(this.panel),this.panel.appendChild(e),s.appendChild(i),s.appendChild(o),s.appendChild(a),this.panel.appendChild(s),this.panel.appendChild(n);for(var r=0;r<this.drawOptions.length;r++){var h=this.drawOptions[r];let i=t.document.createElement("div");i.setAttribute("class","NOTEPAD_controls_draw_option"),i.setAttribute("title",h.title),this.addClass(i,h.type),i.addEventListener("click",Function.prototype.bind.call(this.onControlPanelClick,this,r)),e.appendChild(i),(null!==this.config.tool&&void 0!==this.config.tool||0!==r)&&r!==this.config.tool||this.triggerClick(i)}const c=document.createElement("div");c.setAttribute("class","settings_btn"),c.setAttribute("title","Settings - open settings page"),c.addEventListener("click",this.handleOptionsClick),this.panel.insertAdjacentElement("afterbegin",c),this.colorPicker=t.document.createElement("input"),this.colorPicker.setAttribute("type","color"),this.colorPicker.value=this.config.color||"#40c0eb",this.colorPicker.setAttribute("title","Select a color"),this.colorPicker.addEventListener("change",Function.prototype.bind.call(this.onColorPanelClick,this),!1),i.appendChild(this.colorPicker),this.alphaPicker=t.document.createElement("input"),this.alphaPicker.setAttribute("type","range"),this.alphaPicker.setAttribute("min","0"),this.alphaPicker.setAttribute("max","1"),this.alphaPicker.setAttribute("step","0.01"),this.alphaPicker.value=null!==this.config.alpha&&void 0!==this.config.alpha?this.config.alpha:1,this.alphaPicker.setAttribute("title","Select transparency"),this.alphaPicker.addEventListener("change",Function.prototype.bind.call(this.onAlphaChange,this),!1),this.alphaPicker.addEventListener("input",Function.prototype.bind.call(this.onAlphaUpdate,this),!1),o.appendChild(this.alphaPicker);var l=t.document.createElement("input");l.setAttribute("type","range"),l.setAttribute("min","1"),l.setAttribute("max","20"),l.setAttribute("step","1"),l.value=this.config.thickness||1,l.setAttribute("title","Select line width"),l.addEventListener("change",Function.prototype.bind.call(this.onLineChange,this),!1),l.addEventListener("input",Function.prototype.bind.call(this.onLineUpdate,this),!1),a.appendChild(l),this.selectedColorOption=this.hexToRgb(this.colorPicker.value),this.selectedAlphaOption=this.alphaPicker.value,this.context.lineWidth=l.value,this.updatePaintStyle();var d=t.document.createElement("div"),u=t.document.createElement("div"),p=t.document.createElement("div"),v=t.document.createElement("div");d.setAttribute("class","NOTEPAD_controls_control_option prtBtn"),d.setAttribute("title","Take a screenshot of the current web page with your drawings"),u.setAttribute("class","NOTEPAD_controls_control_option exitBtn"),u.setAttribute("title","Quit"),this.backBtn.setAttribute("class","NOTEPAD_controls_control_option backBtn"),this.backBtn.setAttribute("title","Step backward"),this.nextBtn.setAttribute("class","NOTEPAD_controls_control_option nextBtn"),this.nextBtn.setAttribute("title","Step forward"),p.setAttribute("class","NOTEPAD_controls_control_option eraseAllBtn"),p.setAttribute("title","Erase all"),v.setAttribute("class","NOTEPAD_controls_control_option hideCtrlBtn"),v.setAttribute("title","Close control panel (Click the extension icon to re-open)"),d.addEventListener("click",Function.prototype.bind.call(this.onPrintButtonClick,this)),u.addEventListener("click",Function.prototype.bind.call(this.exit,this)),this.backBtn.addEventListener("click",Function.prototype.bind.call(this.handleBackButtonClick,this)),this.nextBtn.addEventListener("click",Function.prototype.bind.call(this.handleForwardButtonClick,this)),p.addEventListener("click",Function.prototype.bind.call(this.eraseAll,this)),v.addEventListener("click",Function.prototype.bind.call(this.hideControlPanel,this)),n.appendChild(this.backBtn),n.appendChild(this.nextBtn),n.appendChild(p),n.appendChild(d),n.appendChild(v),n.appendChild(u),this.checkHistoryButtonStatus(),this.CSSAnimationManager.supported?this.panel.addEventListener(this.CSSAnimationManager.end,Function.prototype.bind.call(this.handlePanelAppearing,this),!1):this.panel.style.opacity=1},handleOptionsClick:function(){chrome.runtime.sendMessage({method:"open_options"})},finishLastDrawing:function(){var t=this.drawOptions[this.selectedDrawOption];t&&"polygon"===t.type&&t.lastLoc&&t.initLoc?(this.context.beginPath(),this.context.moveTo(t.lastLoc.x,t.lastLoc.y),this.context.lineTo(t.initLoc.x,t.initLoc.y),this.context.stroke(),this.context.closePath(),this.mousedown=!1,t.initLoc=null,t.lastLoc=null,this.storeCanvas(),this.storeHistory()):t&&"quadratic_curve"===t.type&&0!==t.iteration?(this.context.closePath(),this.storeCanvas(),this.storeHistory(),this.mousedown=!1,t.iteration=0,t.initLoc=null,t.lastLoc=null):t&&"bezier_curve"===t.type&&0!==t.iteration?(this.context.closePath(),this.storeCanvas(),this.storeHistory(),this.mousedown=!1,t.iteration=0,t.initLoc=null,t.firstPoint=null,t.lastPoint=null):"eyedropper"!==t&&!0===this.mousedown&&(this.mousedown=!1,this.storeCanvas(),this.storeHistory()),this.paragraph&&this.paragraph.clearIntervals(Function.prototype.bind.call((function(){this.paragraph=null,this.storeCanvas(),this.storeHistory()}),this))},setColor:function(t){t&&(this.colorPicker.value=this.rgbToHex(t.r,t.g,t.b),this.selectedColorOption={r:t.r,g:t.g,b:t.b},this.alphaPicker.value=t.a/255,this.selectedAlphaOption=this.alphaPicker.value,this.alphaPickerPreview&&(this.alphaPickerPreview.innerHTML=Math.round(100*this.selectedAlphaOption)+"%"),this.updatePaintStyle(),this.config.color===this.colorPicker.value&&this.config.alpha===this.selectedAlphaOption||(this.config.color=this.colorPicker.value,this.config.alpha=this.selectedAlphaOption,this.saveData()))},getColorOfCurrentPixel:function(t){i.runtime.sendMessage({method:"get_pixel_color",point:t},this.setColorBinded)},onPrintButtonClick:function(){this.hidePanel().then((()=>{i.runtime.sendMessage({method:"take_screen_shot"}),t.setTimeout(Function.prototype.bind.call((function(){this.removeClass(this.panel,"hide")}),this),500),$(".open_panel")&&$(".open_panel").hide()}))},hidePanel:function(){return new Promise((t=>{this.addClass(this.panel,"hide"),setTimeout((()=>t()),500)}))},onControlPanelClick:function(e,i){if(this.selectedDrawOption!==e){var n=t.document.querySelectorAll("#NOTEPAD_controls .NOTEPAD_controls_draw_option");this.finishLastDrawing();for(var s=0;s<n.length;s++)this.removeClass(n[s],"selected");this.addClass(n[e],"selected"),this.removeClass(this.canvas,"pen"),this.removeClass(this.canvas,"cross"),this.removeClass(this.canvas,"eraser"),this.removeClass(this.canvas,"text"),this.removeClass(this.canvas,"cursor"),this.removeClass(this.canvas,"eyedropper"),this.removeClass(this.canvas,"fill"),this.selectedDrawOption=e;var o=this.drawOptions[this.selectedDrawOption];"pen"===o.type?this.addClass(this.canvas,"pen"):"eraser"===o.type?this.addClass(this.canvas,"eraser"):"text"===o.type?this.addClass(this.canvas,"text"):"cursor"===o.type?this.addClass(this.canvas,"cursor"):"eyedropper"===o.type?this.addClass(this.canvas,"eyedropper"):"fill"===o.type?this.addClass(this.canvas,"fill"):this.addClass(this.canvas,"cross"),this.config.tool!==this.selectedDrawOption&&(this.config.tool=this.selectedDrawOption,this.saveData())}},hexToRgb:function(t){var e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:null},rgbToHex:function(t,e,i){return"#"+((1<<24)+(t<<16)+(e<<8)+i).toString(16).slice(1)},onColorPanelClick:function(t){this.selectedColorOption=this.hexToRgb(t.currentTarget.value),this.updatePaintStyle(),this.config.color!==t.currentTarget.value&&(this.config.color=t.currentTarget.value,this.saveData())},onAlphaChange:function(t){this.selectedAlphaOption=t.currentTarget.value,this.alphaPickerPreview&&(this.alphaPickerPreview.innerHTML=Math.round(100*this.selectedAlphaOption)+"%"),this.updatePaintStyle(),this.config.alpha!==this.selectedAlphaOption&&(this.config.alpha=this.selectedAlphaOption,this.saveData())},onAlphaUpdate:function(t){this.alphaPickerPreview&&(this.alphaPickerPreview.innerHTML=Math.round(100*t.currentTarget.value)+"%")},onLineChange:function(t){this.context.lineWidth=t.currentTarget.value,this.config.thickness!==this.context.lineWidth&&(this.config.thickness=this.context.lineWidth,this.saveData())},onLineUpdate:function(t){},updatePaintStyle:function(){null!==this.selectedColorOption&&null!==this.selectedAlphaOption&&(this.cursor.fillStyle="rgba("+this.selectedColorOption.r+","+this.selectedColorOption.g+","+this.selectedColorOption.b+","+this.selectedAlphaOption+")",this.context.strokeStyle="rgba("+this.selectedColorOption.r+","+this.selectedColorOption.g+","+this.selectedColorOption.b+","+this.selectedAlphaOption+")",this.context.fillStyle="rgba("+this.selectedColorOption.r+","+this.selectedColorOption.g+","+this.selectedColorOption.b+","+this.selectedAlphaOption+")")},addMouseEventListener:function(){var e=Function.prototype.bind.call(this.handleMouseDown,this),i=Function.prototype.bind.call(this.handleMouseMove,this),n=Function.prototype.bind.call(this.handleMouseUp,this),s=Function.prototype.bind.call(this.handleMouseLeave,this);this.canvas.addEventListener("mousedown",e),this.canvas.addEventListener("touchstart",e),this.canvas.addEventListener("mousemove",i),this.canvas.addEventListener("touchmove",i),this.canvas.addEventListener("mouseup",n),this.canvas.addEventListener("touchend",n),this.canvas.addEventListener("mouseleave",s),t.document.addEventListener("keydown",this.keydownBinded),t.document.addEventListener("keypress",this.keypressBinded)},addKeyEventListeners:function(){chrome.storage.local.get((e=>{e.config.hotkeys&&(this.config.hotkeys=e.config.hotkeys,t.document.addEventListener("keydown",this.handleHotKeysDownBinded))}))},handleHotKeysDown:function(e){var i=t.event?event:e;if((i.ctrlKey||i.metaKey)&&i.altKey)for(var n in this.config.hotkeys)if(this.config.hotkeys.hasOwnProperty(n)&&this.config.hotkeys[n].charCodeAt(0)===i.keyCode){if("eraseAll"===n)return void this.eraseAll();if("undo"===n)return void this.handleBackButtonClick();if("redo"===n)return void this.handleForwardButtonClick();if("screenshot"===n)return void this.onPrintButtonClick();for(var s=0;s<this.drawOptions.length;s++)if(this.drawOptions[s].type===n){this.onControlPanelClick(s);break}break}},matchOutlineColor:function(t,e,i,n){return 255!==t&&255!==e&&255!==i&&0!==n},handleFill:function(t){t.x=Math.round(t.x),t.y=Math.round(t.y);var e=this.context.getImageData(0,0,this.canvas.width,this.canvas.height),i=Math.round(4*(t.y*this.canvas.width+t.x)),n=e.data[i],s=e.data[i+1],o=e.data[i+2],a=e.data[i+3],r=this.selectedColorOption.r,h=this.selectedColorOption.g,c=this.selectedColorOption.b,l=Math.round(255*this.selectedAlphaOption);n===r&&s===h&&o===c&&a===l||this.matchOutlineColor(n,s,o,a)||(this.floodFill(t.x,t.y,[this.selectedColorOption.r,this.selectedColorOption.g,this.selectedColorOption.b,Math.round(255*this.selectedAlphaOption)],!1,e,0,!0),this.context.putImageData(e,0,0),this.storeCanvas(),this.storeHistory())},floodFill:function(t,e,i,n,s,o,a){var r,h,c,l=s.data,d=[],u=!1,p=!1,v=s.width,g=s.height,f=new Uint8ClampedArray(v*g),y=4*v,x=t,m=e,w=m*y+4*x,C=l[w],b=l[w+1],L=l[w+2],P=l[w+3],k=!1,T=function(t,e){if(t<0||e<0||g<=e||v<=t)return!1;var n=e*y+4*t,s=Math.max(Math.abs(C-l[n]),Math.abs(b-l[n+1]),Math.abs(L-l[n+2]),Math.abs(P-l[n+3]));s<o&&(s=0);var a=Math.abs(0-f[e*v+t]);return k||0!==s&&255!==a&&(l[n]=i[0],l[n+1]=i[1],l[n+2]=i[2],l[n+3]=(i[3]+l[n+3])/2,f[e*v+t]=255),s+a===0};for(d.push([x,m]);d.length;){var D=d.pop();for(x=D[0],m=D[1],k=!0;T(x,m-1);)m-=1;for(k=!1,n&&(!T(x-1,m)&&T(x-1,m-1)&&d.push([x-1,m-1]),!T(x+1,m)&&T(x+1,m-1)&&d.push([x+1,m-1])),p=u=!1;T(x,m);)l[c=(h=m)*y+4*(r=x)]=i[0],l[c+1]=i[1],l[c+2]=i[2],l[c+3]=i[3],f[h*v+r]=255,T(x-1,m)?u||(d.push([x-1,m]),u=!0):u&&(u=!1),T(x+1,m)?p||(d.push([x+1,m]),p=!0):p&&(p=!1),m+=1;n&&(T(x-1,m)&&!u&&d.push([x-1,m]),T(x+1,m)&&!p&&d.push([x+1,m]))}},handleKeyDown:function(t){this.paragraph&&(8!==t.keyCode&&13!==t.keyCode||t.preventDefault(),8===t.keyCode?this.paragraph.backspace():13===t.keyCode&&this.paragraph.newline())},handleKeyPress:function(t){if(this.paragraph){var e=String.fromCharCode(t.which);if(8!==t.keyCode&&!t.ctrlKey&&!t.metaKey){t.preventDefault();var i=this.drawOptions[this.selectedDrawOption];this.context.font=i.minSize+(i.maxSize-i.minSize)*this.context.lineWidth/20+"px "+i.font,this.paragraph.insert(e)}}},handleMouseDown:function(e){e.preventDefault(),this.mousedown=!0;var i=this.drawOptions[this.selectedDrawOption];if(this.lastMouseDownLoc=this.windowToCanvas(e.clientX,e.clientY),"pen"===i.type)this.context.beginPath(),this.context.moveTo(this.lastMouseDownLoc.x,this.lastMouseDownLoc.y+16);else if("eyedropper"===i.type)this.getColorOfCurrentPixel({x:Math.round(t.devicePixelRatio*(void 0===e.clientX?e.touches[0].clientX:e.clientX-2)),y:Math.round(t.devicePixelRatio*(void 0===e.clientY?e.touches[0].clientY:e.clientY+22))});else if("line"===i.type)this.storeCanvas();else if("quadratic_curve"===i.type){if(0===i.iteration)this.storeCanvas(),i.initLoc={x:this.lastMouseDownLoc.x,y:this.lastMouseDownLoc.y};else if(1!==i.iteration)throw new Error("invalid iteration")}else if("bezier_curve"===i.type){if(0===i.iteration)this.storeCanvas(),i.initLoc={x:this.lastMouseDownLoc.x,y:this.lastMouseDownLoc.y};else if(1===i.iteration);else if(2!==i.iteration)throw new Error("invalid iteration")}else if("polygon"===i.type)this.storeCanvas(),i.lastLoc?(this.context.beginPath(),this.context.moveTo(i.lastLoc.x,i.lastLoc.y),this.context.lineTo(this.lastMouseDownLoc.x,this.lastMouseDownLoc.y),this.context.stroke()):(i.lastLoc={x:this.lastMouseDownLoc.x,y:this.lastMouseDownLoc.y},i.initLoc={x:this.lastMouseDownLoc.x,y:this.lastMouseDownLoc.y});else if("circle"===i.type)this.storeCanvas();else if("rectangle"===i.type)this.storeCanvas();else if("eraser"===i.type)this.restoreCanvas(),this.context.save(),this.context.translate(this.lastMouseDownLoc.x,this.lastMouseDownLoc.y),this.context.clearRect(0,0,i.width,i.height),this.context.restore();else if("fill"===i.type)this.handleFill(this.lastMouseDownLoc);else if("text"===i.type)if(this.cursor.erase(this.context,this.drawingSurfaceImageData),this.storeCanvas(),this.paragraph&&this.paragraph.isPointInside(this.lastMouseDownLoc))this.paragraph.moveCursorCloseTo(this.lastMouseDownLoc.x,this.lastMouseDownLoc.y);else{this.paragraph&&(this.paragraph.clearIntervals(),this.paragraph=null);var n=this.context.measureText("W").width;n+=n/6,this.paragraph=new Paragraph(this.context,this.lastMouseDownLoc.x,this.lastMouseDownLoc.y-n,this.drawingSurfaceImageData,this.cursor),this.paragraph.addLine(new TextLine(this.lastMouseDownLoc.x,this.lastMouseDownLoc.y))}},handleMouseMove:function(t){t.preventDefault();const e=this.drawOptions[this.selectedDrawOption],i=this.windowToCanvas(void 0===t.clientX?t.touches[0].clientX:t.clientX,void 0===t.clientY?t.touches[0].clientY:t.clientY);if(this.setLineProperty(),this.mousedown||"eraser"!=e.type||(this.restoreCanvas(),this.context.save(),this.context.translate(i.x,i.y),this.context.clearRect(0,0,e.width,e.height),this.context.restore()),"quadratic_curve"===e.type?e.iteration&&e.lastLoc&&(this.restoreCanvas(),this.context.beginPath(),this.context.moveTo(e.initLoc.x,e.initLoc.y),this.context.quadraticCurveTo(i.x,i.y,e.lastLoc.x,e.lastLoc.y),this.context.stroke()):"bezier_curve"===e.type&&(1===e.iteration&&e.firstPoint?(this.restoreCanvas(),this.context.beginPath(),this.context.moveTo(e.initLoc.x,e.initLoc.y),this.context.quadraticCurveTo(i.x,i.y,e.firstPoint.x,e.firstPoint.y),this.context.stroke()):2===e.iteration&&e.firstPoint&&e.lastPoint&&(this.restoreCanvas(),this.context.beginPath(),this.context.moveTo(e.initLoc.x,e.initLoc.y),this.context.bezierCurveTo(e.lastPoint.x,e.lastPoint.y,i.x,i.y,e.firstPoint.x,e.firstPoint.y),this.context.stroke())),this.mousedown)if("pen"===e.type)this.restoreCanvas(),this.context.lineTo(i.x,i.y+16),this.context.stroke();else if("line"===e.type)this.restoreCanvas(),this.context.beginPath(),this.context.moveTo(this.lastMouseDownLoc.x,this.lastMouseDownLoc.y),this.context.lineTo(i.x,i.y),this.context.stroke();else if("arrow"===e.type){this.restoreCanvas(),this.context.beginPath();const t=20,e=i.x-this.lastMouseDownLoc.x,n=i.y-this.lastMouseDownLoc.y,s=Math.atan2(n,e);this.context.moveTo(this.lastMouseDownLoc.x,this.lastMouseDownLoc.y),this.context.lineTo(i.x,i.y),this.context.lineTo(i.x-t*Math.cos(s-Math.PI/6),i.y-t*Math.sin(s-Math.PI/6)),this.context.moveTo(i.x,i.y),this.context.lineTo(i.x-t*Math.cos(s+Math.PI/6),i.y-t*Math.sin(s+Math.PI/6)),this.context.stroke()}else"quadratic_curve"===e.type||"bezier_curve"===e.type?0===e.iteration&&(this.restoreCanvas(),this.context.beginPath(),this.context.moveTo(this.lastMouseDownLoc.x,this.lastMouseDownLoc.y),this.context.lineTo(i.x,i.y),this.context.stroke()):"polygon"===e.type?(this.restoreCanvas(),this.context.beginPath(),this.context.moveTo(e.lastLoc.x,e.lastLoc.y),this.context.lineTo(i.x,i.y),this.context.stroke()):"circle"===e.type?(this.restoreCanvas(),this.drawEllipse(this.lastMouseDownLoc.x,this.lastMouseDownLoc.y,i.x-this.lastMouseDownLoc.x,i.y-this.lastMouseDownLoc.y)):"rectangle"===e.type?(this.restoreCanvas(),this.context.beginPath(),this.context.moveTo(this.lastMouseDownLoc.x,this.lastMouseDownLoc.y),this.context.lineTo(this.lastMouseDownLoc.x,i.y),this.context.lineTo(i.x,i.y),this.context.lineTo(i.x,this.lastMouseDownLoc.y),this.context.lineTo(this.lastMouseDownLoc.x,this.lastMouseDownLoc.y),this.context.stroke()):"eraser"===e.type&&(this.context.save(),this.context.translate(i.x,i.y),this.context.clearRect(0,0,e.width,e.height),this.context.restore())},handleMouseUp:function(t){t.preventDefault(),this.mousedown=!1;var e=this.drawOptions[this.selectedDrawOption],i=this.windowToCanvas(void 0===t.clientX?t.changedTouches[0].clientX:t.clientX,void 0===t.clientY?t.changedTouches[0].clientY:t.clientY);"arrow"===e.type&&(this.context.closePath(),this.storeCanvas(),this.storeHistory()),"pen"===e.type||"line"===e.type?(this.context.closePath(),this.storeCanvas(),this.storeHistory()):"quadratic_curve"===e.type?0===e.iteration?(e.lastLoc={x:i.x,y:i.y},e.iteration++):1===e.iteration&&(this.context.closePath(),this.storeCanvas(),this.storeHistory(),e.iteration=0,e.initLoc=null,e.lastLoc=null):"bezier_curve"===e.type?0===e.iteration?(e.firstPoint={x:i.x,y:i.y},e.iteration++):1===e.iteration?(e.lastPoint={x:i.x,y:i.y},e.iteration++):2===e.iteration&&(this.context.closePath(),this.storeCanvas(),this.storeHistory(),e.iteration=0,e.initLoc=null,e.firstPoint=null,e.lastPoint=null):"polygon"===e.type?(this.storeCanvas(),this.storeHistory(),e.lastLoc={x:i.x,y:i.y}):"circle"===e.type?(this.storeCanvas(),this.storeHistory()):"rectangle"===e.type?(this.context.closePath(),this.storeCanvas(),this.storeHistory()):"eraser"===e.type&&(this.storeCanvas(),this.storeHistory())},handleMouseLeave:function(){"eraser"===this.drawOptions[this.selectedDrawOption].type&&this.restoreCanvas()},setLineProperty:function(){this.context.lineJoin="round",this.context.lineCap="round"},drawEllipse:function(t,e,i,n){var s=i/2*.5522848,o=n/2*.5522848,a=t+i,r=e+n,h=t+i/2,c=e+n/2;this.context.beginPath(),this.context.moveTo(t,c),this.context.bezierCurveTo(t,c-o,h-s,e,h,e),this.context.bezierCurveTo(h+s,e,a,c-o,a,c),this.context.bezierCurveTo(a,c+o,h+s,r,h,r),this.context.bezierCurveTo(h-s,r,t,c+o,t,c),this.context.stroke()},addClass:function(t,e){0<=t.className.indexOf(e)||(t.className=t.className+" "+e)},removeClass:function(t,e){t.className=t.className.replace(new RegExp("\\b"+e+"\\b","g"),"")},triggerClick:function(t){this.triggerEvent(t,"click")},triggerEvent:function(t,e){var i;document.createEvent?(i=document.createEvent("HTMLEvents")).initEvent(e,!0,!0):document.createEventObject&&((i=document.createEventObject()).eventType=e),i.eventName=e,t.dispatchEvent?t.dispatchEvent(i):t.fireEvent&&htmlEvents["on"+e]?t.fireEvent("on"+i.eventType,i):t[e]?t[e]():t["on"+e]&&t["on"+e]()},initDragging:function(){this.panel.addEventListener("mousedown",this.handleDraggingStart),this.panel.addEventListener("touchstart",this.handleDraggingStart),t.document.addEventListener("mouseup",this.handleDragDone),t.document.addEventListener("touchend",this.handleDragDone)},handleDraggingStart:function(t){n.pos_x=this.getBoundingClientRect().left-(void 0===t.clientX?t.touches[0].clientX:t.clientX),n.pos_y=this.getBoundingClientRect().top-(void 0===t.clientY?t.touches[0].clientY:t.clientY),this.addEventListener("mousemove",n.handleDragging),this.addEventListener("touchmove",n.handleDragging)},handleDragging:function(t){"INPUT"!==t.target.nodeName.toUpperCase()&&(t.preventDefault(),this.style.top=(void 0===t.clientY?t.touches[0].clientY:t.clientY)+n.pos_y+"px",this.style.left=(void 0===t.clientX?t.touches[0].clientX:t.clientX)+n.pos_x+"px")},handleDragDone:function(t){n.panel.removeEventListener("mousemove",n.handleDragging),n.panel.removeEventListener("touchmove",n.handleDragging)},windowToCanvas:function(t,e){var i=this.canvas.getBoundingClientRect();return{x:Math.round(t)-i.left*(this.canvas.width/i.width),y:Math.round(e)-i.top*(this.canvas.height/i.height)}},handlePostMessageResponse:function(e){if(e.origin===t.location.origin){var i=e.data;"get_pixel_color_response"===i.method?this.setColor(i.response):"get_data_response"===i.method&&this.render(i.response)}},exit:function(){this.canvas.parentNode.removeChild(this.canvas),this.panel.parentNode.removeChild(this.panel),t.document.removeEventListener("keydown",this.keydownBinded),t.document.removeEventListener("keypress",this.keypressBinded),t.document.removeEventListener("keydown",this.handleHotKeysDownBinded),t.document.removeEventListener("mouseup",this.handleDragDone),t.removeEventListener("resize",this.resizeBinded),t.removeEventListener("scroll",this.resizeBinded),this.canvas=null,this.context=null,this.selectedDrawOption=null,this.selectedColorOption=null,this.selectedAlphaOption=null,this.mousedown=!1,this.lastMouseDownLoc=null,this.drawingSurfaceImageData=null,this.paragraph=null,this.panel=null,this.initialized=!1,this.controlPanelHidden=!1,"undefined"!=typeof unsafeWindow&&null!==unsafeWindow&&(unsafeWindow.NOTEPAD_INIT=!1,unsafeWindow.CTRL_HIDDEN=!1),$(".search").show(),$(".open_panel").show(),$("#shortcut_wrapper").show(),$("#google_apps").show(),$("#shortcut_wrapper").css("z-index","9999999999999"),$("#google_apps").css("z-index","9999999999999"),$("#NOTEPAD").css("z-index","9"),$("#apps_wrapper").css("z-index","9999999999999"),1!=$(".links").length?document.getElementsByClassName("links")[0].style.display="block":$(".links").show()},eraseAll:function(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.paragraph&&(this.paragraph.clearIntervals(),this.paragraph=null),this.storeCanvas(!0),this.storeHistory(),t.localStorage.removeItem("WP_CRX_STORAGE_SNAPSHOT_"+t.location.pathname),$("body.new_tab_search").css("background","none"),chrome.storage.local.set({isSetAsBack:!1,urlSetAsBack:""},(()=>{}))},hideControlPanel:function(){this.addClass(this.panel,"hide"),this.controlPanelHidden=!0,"undefined"!=typeof unsafeWindow&&null!==unsafeWindow&&(unsafeWindow.CTRL_HIDDEN=!0),$(".search").show(),$(".open_panel").show(),$("#shortcut_wrapper").show(),$("#google_apps").show(),$("#shortcut_wrapper").css("z-index","9999999999999"),$("#google_apps").css("z-index","9999999999999"),$("#apps_wrapper").css("z-index","9999999999999"),$("#NOTEPAD").css("z-index","9"),1!=$(".links").length?document.getElementsByClassName("links")[$(".links").length-1].style.display="block":$(".links").show()},showControlPanel:function(){this.removeClass(this.panel,"hide"),this.controlPanelHidden=!1,"undefined"!=typeof unsafeWindow&&null!==unsafeWindow&&(unsafeWindow.CTRL_HIDDEN=!1)},openControlsWithBtn:function(){$(".search").hide(),$(".links").hide(),$("#shortcut_wrapper").hide(),$("#google_apps").hide(),this.panel?this.removeClass(this.panel,"hide"):openWebPaint()},saveData:function(){i.runtime.sendMessage({method:"save_data",config:this.config})},render:function(t){this.config=t||{},this.createCanvas(),this.setLineProperty(),this.createControlPanel(),this.createOpenControlsPanelBtn(),this.createLinks(),this.initDragging(),this.addMouseEventListener(),this.addKeyEventListeners(),$(".search").hide(),$(".links").hide()},initConfig:function(){i.runtime.sendMessage({method:"get_data"},this.renderBinded)},init:function(){this.history=new e,this.CSSAnimationManager=function(){for(var t,e,i,n=!1,s=["webkit","Moz","O",""],o=s.length,a=document.documentElement.style;o--;)if(s[o]){if(void 0!==a[s[o]+"AnimationName"]){switch(t=s[o],o){case 0:e=t.toLowerCase()+"AnimationStart",i=t.toLowerCase()+"AnimationEnd",n=!0;break;case 1:e="animationstart",i="animationend",n=!0;break;case 2:e=t.toLowerCase()+"animationstart",i=t.toLowerCase()+"animationend",n=!0}break}}else if(void 0!==a.animationName){t=s[o],e="animationstart",i="animationend",n=!0;break}return{supported:n,prefix:t,start:e,end:i}}(),this.setColorBinded=Function.prototype.bind.call(this.setColor,this),this.renderBinded=Function.prototype.bind.call(this.render,this),this.handlePostMessageResponseBinded=Function.prototype.bind.call(this.handlePostMessageResponse,this),this.keydownBinded=Function.prototype.bind.call(this.handleKeyDown,this),this.keypressBinded=Function.prototype.bind.call(this.handleKeyPress,this),this.handleHotKeysDownBinded=Function.prototype.bind.call(this.handleHotKeysDown,this),this.persistLocalStorageBinded=Function.prototype.bind.call(this.persistLocalStorage,this),this.resizeBinded=Function.prototype.bind.call((function(){this.resizeTimeoutID&&(this.resizeTimeoutID=t.clearTimeout(this.resizeTimeoutID)),this.resizeTimeoutID=t.setTimeout(Function.prototype.bind.call(this.handleResize,this),200)}),this),this.initConfig(),this.initialized=!0,"undefined"!=typeof unsafeWindow&&null!==unsafeWindow&&(unsafeWindow.NOTEPAD_INIT=!0)}};return n},"undefined"!=typeof unsafeWindow&&null!==unsafeWindow?unsafeWindow.CTRL_HIDDEN?t.NOTEPAD.showControlPanel():unsafeWindow.NOTEPAD_INIT||(t.NOTEPAD=e(t),t.NOTEPAD.init()):(void 0!==t.NOTEPAD&&null!==t.NOTEPAD||(t.NOTEPAD=e(t)),t.NOTEPAD.controlPanelHidden?t.NOTEPAD.showControlPanel():t.NOTEPAD.initialized||t.NOTEPAD.init())}isSetAsBack=!1,openWebPaint();