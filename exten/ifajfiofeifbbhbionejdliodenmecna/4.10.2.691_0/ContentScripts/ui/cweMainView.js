class DjiCwuMainView{constructor(){this.m_demoMode=!1;this.m_templates={suggestion:null,suggestionTranslationPlaceholder:null,topic:null,lookupTopic:null};this.m_ui={mainView:null,tabView:null,tabViewPages:null,tabViewToolbarButtons:null,mousePosition:{x:-1,y:-1},size:{width:0,height:0}};this.m_resizeObserver=void 0;this.m_eventHandlers={};this.m_data={locale:"",presentationLang:"",suggestions:[],translations:[],topics:[],topicsUpperCase:[],displayTopics:[],translation:{target:null,source:null},features:null};
this.m_messages={translateWriting:{US:"Translate writing from ${source} into ${target}.",UK:"Translate writing from ${source} into ${target}.",BE:"Translate writing from ${source} into ${target}.",CAN:"Translate writing from ${source} into ${target}.",FR:"Traduire l'\u00e9criture de ${source} en ${target}.",GER:"Ubersetze Schreiben von ${source} in ${target}.",SPA:"Traduzca la escritura desde ${source} a ${target}."}};this.m_delegates={viewDidChangeDelegate:void 0,viewSizeChangedDelegate:void 0,trueKeyModeDidChangeDelegate:void 0,
suggestionClickDelegate:void 0,keyboardClickDelegate:void 0,canToggleSpeechRecognitionDelegate:void 0,speechRecognitionDelegate:void 0,speakDelegate:void 0,readDelegate:void 0,updateTopicDelegate:void 0,activateTopicDelegate:void 0,searchTopicsOnWebDelegate:void 0,errorDismissedDelegate:void 0,postGA4Event:void 0};this.m_timers={speak:new DjiTimer(this,this.__onSpeakText),speechRecognition:new DjiTimer(this,this.__onStopPulseSpeechRecognition),searchTopics:new DjiTimer(this,this.__onSearchTopics),
skipBackRead:new DjiTimer(this,this.__onReadPageReadSkipBackReadTimer)};this.m_readPageTimer=void 0;this.m_maxSpeechRate=3.5;this.m_minSpeechRate=.5;this.m_readPageOptions={activate:!1,settings:{rate:1},skip:window.dji.mapping.Skip.NONE,skipCount:1};this.__createEventHandlers()}get view(){return this.m_ui.mainView}get size(){return this.m_ui.size}get mode(){let a=void 0;if(this.m_ui.mainView){const b=this.m_ui.tabView.querySelector("dji-cwu-tab-view-page[dji-cwu-active]");b&&(a=b.getAttribute("dji-cwu-role"))}return a}hasFocus(){return!!(this.m_ui.mainView&&
this.m_ui.mainView.hasFocusWithin()||"topics"===this.mode)}async initialize(a,b){if(this.m_ui.mainView)throw Error("Already initialize!");this.__loadMainViewTemplate();this.__initializeResizeObserver();try{let c=dji.ui.templatesRegistry.load(null,"dji-cwu-suggestion").content;this.m_templates.suggestion=c.querySelector("dji-cwu-suggestion")}catch(c){Logger.instance.error("Template for suggestion couldn't be loaded!")}try{let c=dji.ui.templatesRegistry.load(null,"dji-cwu-suggestion-translation-placeholder").content;
this.m_templates.suggestionTranslationPlaceholder=c.querySelector("dji-cwu-suggestion")}catch(c){Logger.instance.error("Template for suggestion couldn't be loaded!")}try{let c=dji.ui.templatesRegistry.load(null,"dji-cwu-topic").content;this.m_templates.topic=c.querySelector("dji-cwu-topic")}catch(c){Logger.instance.error("Template for topic couldn't be loaded!")}try{let c=dji.ui.templatesRegistry.load(null,"dji-cwu-topic-lookup").content;this.m_templates.lookupTopic=c.querySelector("dji-cwu-topic")}catch(c){Logger.instance.error("Template for lookup topic couldn't be loaded!")}this.m_ui.mainView&&
(this.m_demoMode=!!b,this.m_ui.mainView.setAttribute("id",`${this.m_ui.mainView.tagName}-${Date.now()}`),this.m_ui.mainView.setAttribute("dji-cwu-hidden",""),this.m_demoMode&&this.m_ui.mainView.setAttribute("dji-cwu-demo",""),this.__detectElements(),this.__addEventListeners(),this.reset(),this.m_ui.mainView.addEventListener("mousedown",DjiCwuMainView.__onBlockDefaultBehaviour,!0),a&&a.appendChild(this.m_ui.mainView))}__loadMainViewTemplate(){this.m_ui.mainView=document.querySelector("dji-cwu-main-view");
if(!this.m_ui.mainView)try{const a=dji.ui.templatesRegistry.load(null,"dji-cwu-main-view").content;this.m_ui.mainView=a.querySelector("dji-cwu-main-view")}catch(a){Logger.instance.error("Template for main view couldn't be loaded!")}}__initializeResizeObserver(){this.m_ui.mainView&&(this.m_resizeObserver=new ResizeObserver(a=>{a=this.m_ui.mainView.getBoundingClientRect();if(this.m_ui.size.width!==a.width||this.m_ui.size.height!==a.height)this.m_ui.size.width=a.width,this.m_ui.size.height=a.height,
this.m_delegates.viewSizeChangedDelegate&&this.m_delegates.viewSizeChangedDelegate(a.width,a.height)}),this.m_resizeObserver.observe(this.m_ui.mainView))}show(a){this.m_ui.mainView&&(this.__notifyStopSpeechRecognition(),a&&!this.canShow()&&(a=!1),a?this.m_ui.mainView.removeAttribute("dji-cwu-hidden"):this.m_ui.mainView.setAttribute("dji-cwu-hidden",""),window.dji&&window.dji.accessibility&&window.dji.accessibility.enable(a))}canShow(){const a=this.m_data.features;return!(a&&!a.allowTogglePrediction&&
!a.allowMicrophone)}__updateUI(){window.dji.cwe.i18n.translateHtmlDocument(this.m_ui.mainView);var a=this.m_data.features;let b=!(a&&!a.allowTogglePrediction&&null!==a.allowTogglePrediction&&void 0!==a.allowTogglePrediction),c=b&&!(a&&!a.allowTopics&&null!==a.allowTopics&&void 0!==a.allowTopics),d=b&&!(a&&!a.allowChangeTopics&&null!==a.allowChangeTopics&&void 0!==a.allowChangeTopics);a=!(a&&!a.allowMicrophone&&null!==a.allowMicrophone&&void 0!==a.allowMicrophone);b?(this.m_ui.tabViewTypeToolbarButton.removeAttribute("dji-cwu-hidden"),
this.m_ui.tabViewPageType.removeAttribute("disabled")):(this.m_ui.tabViewTypeToolbarButton.setAttribute("dji-cwu-hidden",!0),this.m_ui.tabViewPageType.setAttribute("disabled",!0),this.m_ui.tabViewTypeToolbarButton.hasAttribute("dji-cwu-active")&&(c&&d?this.__onTabViewToolbarButtonClick(this.m_ui.tabViewTopicsToolbarButton,!0):a&&this.__onTabViewToolbarButtonClick(this.m_ui.tabViewSpeakToolbarButton,!0)));c&&d?(this.m_ui.tabViewTopicsToolbarButton.removeAttribute("dji-cwu-hidden"),this.m_ui.topicsSearchBox.removeAttribute("disabled"),
this.m_ui.topicsSearchBarInput.disabled=!1,this.m_ui.topicsSearchBarStartSpeak.removeAttribute("disabled")):c?(this.m_ui.tabViewTopicsToolbarButton.removeAttribute("dji-cwu-hidden"),this.m_ui.topicsSearchBox.setAttribute("disabled",!0),this.m_ui.topicsSearchBarInput.disabled=!0,this.m_ui.topicsSearchBarStartSpeak.setAttribute("disabled",!0)):(this.m_ui.tabViewTopicsToolbarButton.setAttribute("dji-cwu-hidden",!0),this.m_ui.topicsSearchBox.setAttribute("disabled",!0),this.m_ui.topicsSearchBarInput.disabled=
!0,this.m_ui.topicsSearchBarStartSpeak.setAttribute("disabled",!0),this.m_ui.tabViewTopicsToolbarButton.hasAttribute("dji-cwu-active")&&(b?this.__onTabViewToolbarButtonClick(this.m_ui.tabViewTypeToolbarButton,!0):a&&this.__onTabViewToolbarButtonClick(this.m_ui.tabViewSpeakToolbarButton,!0)));d?this.m_ui.topicsMainPane.removeAttribute("disabled"):this.m_ui.topicsMainPane.setAttribute("disabled",!0);a?(this.m_ui.tabViewSpeakToolbarButton.removeAttribute("dji-cwu-hidden"),this.m_ui.speakPageMicrophone.removeAttribute("disabled")):
(this.m_ui.tabViewSpeakToolbarButton.setAttribute("dji-cwu-hidden",!0),this.m_ui.speakPageMicrophone.setAttribute("disabled",!0),this.m_ui.tabViewSpeakToolbarButton.hasAttribute("dji-cwu-active")&&(b?this.__onTabViewToolbarButtonClick(this.m_ui.tabViewTypeToolbarButton,!0):a&&this.__onTabViewToolbarButtonClick(this.m_ui.tabViewTopicsToolbarButton,!0)));b&&(c||d)||(c||d)&&a||b&&a?this.m_ui.tabViewToolbar.removeAttribute("dji-cwu-hidden"):this.m_ui.tabViewToolbar.setAttribute("dji-cwu-hidden",!0)}setOptions(a){let b;
this.__notifyStopSpeechRecognition();this.m_data.locale=a.locale||"";this.m_data.presentationLang=a.presentationLang||"";this.m_data.features=a.features;b=this.__prepareTranslationLanguages(a.translation);this.__updateSpeechRecognitionView();this.__updateTalkingWordProcessorView(a.speech);this.suggestionsCount=a.suggestions;this.translationsEnabled=b;this.windowOptions=a.window;this.__updateUI()}set viewDidChangeDelegate(a){a instanceof Function&&(this.m_delegates.viewDidChangeDelegate=a)}set viewSizeChangedDelegate(a){a instanceof
Function&&(this.m_delegates.viewSizeChangedDelegate=a)}set trueKeyModeDidChangeDelegate(a){a instanceof Function&&(this.m_delegates.trueKeyModeDidChangeDelegate=a)}set suggestionClickDelegate(a){a instanceof Function&&(this.m_delegates.suggestionClickDelegate=a)}set keyboardClickDelegate(a){a instanceof Function&&(this.m_delegates.keyboardClickDelegate=a)}set canToggleSpeechRecognitionDelegate(a){a instanceof Function&&(this.m_delegates.canToggleSpeechRecognitionDelegate=a)}set speechRecognitionDelegate(a){a instanceof
Function&&(this.m_delegates.speechRecognitionDelegate=a)}set speakClickDelegate(a){a instanceof Function&&(this.m_delegates.speakDelegate=a)}set readClickDelegate(a){a instanceof Function&&(this.m_delegates.readDelegate=a)}set updateTopicDelegate(a){a instanceof Function&&(this.m_delegates.updateTopicDelegate=a)}set activateTopicDelegate(a){a instanceof Function&&(this.m_delegates.activateTopicDelegate=a)}set searchTopicsOnWebDelegate(a){a instanceof Function&&(this.m_delegates.searchTopicsOnWebDelegate=
a)}set errorDismissedDelegate(a){a instanceof Function&&(this.m_delegates.errorDismissedDelegate=a)}set postGA4Event(a){a instanceof Function&&(this.m_delegates.postGA4Event=a)}suggestionFromNumber(a){if(isNaN(a)||!this.m_ui.mainView||this.m_ui.mainView.isHidden()||!this.m_ui.tabViewPageType.isActive()||!this.m_ui.typePagePaneType.isActive())return null;const b=this.m_data.suggestions.length,c=b+this.m_data.translations.length;a--;if(0<=a&&a<b)return this.m_data.suggestions[a];-1===a&&10===c&&(a=
b);return b<=a&&a<c?this.m_data.translations[a-b]:null}toggleTrueKeyMode(){const a=this.m_ui.tabView.querySelector('dji-cwu-tab-view-page[dji-cwu-role="type"][dji-cwu-active]');return a&&this.m_ui.typePagePaneType.isActive()?(this.__onTypePageToolbarButtonClick(this.m_ui.typePageToolbarButton123),!0):a&&this.m_ui.typePagePane123Keyboard.isActive()?(this.__onTypePageToolbarButtonClick(this.m_ui.typePageToolbarButtonABC),!0):!1}get trueKeyMode(){return!!this.m_ui.tabView.querySelector('dji-cwu-tab-view-page[dji-cwu-role="type"][dji-cwu-active] dji-cwu-keyboard-pane[dji-cwu-active]')}reset(){this.resetTypePage();
this.resetSpeechRecognitionPage();this.resetTopicsPage();this.__resetAccessibilityManager();this.__onTabViewToolbarButtonClick(this.m_ui.tabView.querySelector('dji-cwu-tab-view-toolbar-button[dji-cwu-link-to="type"]'),!0)}resetTypePage(){this.m_ui.typePagePaneTranslations.removeAllChildren("dji-cwu-suggestion");this.m_ui.typePagePaneSuggestions.removeAllChildren();this.m_ui.typePagePaneTranslations.setAttribute("dji-cwu-hidden","");this.m_ui.typePagePaneSuggestions.setAttribute("dji-cwu-hidden","");
this.suggestionsCount=5;this.translationsEnabled=!1}async resetSpeechRecognitionPage(a){if(this.m_ui.speakPageMicrophone.__isActive||a){a=this.m_ui.tabViewPageSpeak.hasAttribute("dji-cwu-error");this.m_ui.tabViewToolbar.removeAttribute("dji-cwu-error","");this.m_ui.tabViewPageSpeak.removeAttribute("dji-cwu-error");this.m_ui.speakPageMicrophone.setAttribute("dji-cwu-state","idle");this.m_ui.speakPageInfo.innerText=await window.dji.cwe.i18n.instance.getMessage("cwu_guess_window_start_stt");this.m_ui.speakPageMicrophone.__isActive=
!1;const b=this.m_ui.speakPageMicrophone.querySelector("i.dji-svg-icon");b.classList.remove("svg-mic_white");b.classList.remove("svg-mic_blue");a&&this.m_delegates.errorDismissedDelegate&&this.m_delegates.errorDismissedDelegate()}this.__updateSpeechRecognitionView()}resetTopicsPage(){this.m_ui.topicsSearchBox.__speechRecognitionActive&&(this.m_ui.topicsSearchBox.removeAttribute("dji-cwu-speech-recognition"),this.m_ui.topicsSearchBarInput.value="",this.m_ui.topicsSearchBarInput.enableInputEvents(),
delete this.m_ui.topicsSearchBarInput.__search,this.m_ui.topicsSearchResultsLocal.removeAllChildren(),this.m_ui.topicsSearchResultsWeb.removeAllChildren(),this.m_ui.topicsSearchBox.removeAttribute("dji-cwu-input"),this.m_ui.topicsSearchBox.removeAttribute("dji-cwu-no-results"),this.m_ui.topicsSearchInfoPattern.innerText="",this.m_ui.topicsSearchBox.__speechRecognitionActive=!1)}resetToCreateTopic(a){const b=`${Date.now()}-${parseInt(1E3*Math.random())}`,c=this.mode;this.__onTabViewToolbarButtonClick(this.m_ui.tabView.querySelector('dji-cwu-tab-view-toolbar-button[dji-cwu-link-to="topics"]'),
!0);this.m_ui.mainView.__updateTopic=!0;this.m_ui.topicsSearchBox.activate(!0);this.m_ui.topicsSearchBarInput.enableInputEvents(!1);this.m_ui.topicsSearchBarInput.__search={session:b,pattern:a.details.name,extras:!0};this.m_ui.topicsSearchBarInput.value=a.details.name;this.m_ui.topicsSearchBox.setAttribute("dji-cwu-input","");a.userData&&"activate"===a.userData.action?this.m_ui.mainView.setAttribute("dji-cwu-update-topics","activate"):a.userData&&"create"===a.userData.action?(a.userData.activate||
this.m_ui.mainView.setAttribute("dji-cwu-update-topics-hint","hint-too-many-active"),this.m_ui.mainView.setAttribute("dji-cwu-update-topics","create")):(a.userData.activate||this.m_ui.mainView.setAttribute("dji-cwu-update-topics-hint","hint-too-many-active"),this.m_ui.mainView.setAttribute("dji-cwu-update-topics","update"));this.m_ui.topicsUpdateInfoName.innerText=a.details.name;this.m_ui.topicsSearchResults.scrollTop=0;return c}cancelResetToCreateTopic(a){this.m_ui.mainView.__updateTopic&&this.m_ui.topicsSearchBarInput.__search&&
this.m_ui.topicsSearchBarInput.__search.extras&&(this.m_ui.mainView.removeAttribute("dji-cwu-update-topics"),this.m_ui.mainView.removeAttribute("dji-cwu-update-topics-hint"),this.m_ui.topicsUpdateInfoName.innerText="",this.m_ui.topicsSearchBarInput.enableInputEvents(),this.m_ui.mainView.__updateTopic=!1,this.__onTopicsSearchBack(),a&&a!==this.mode&&(a=this.m_ui.tabView.querySelector(`dji-cwu-tab-view-toolbar-button[dji-cwu-link-to="${a}"]`))&&this.__onTabViewToolbarButtonClick(a,!0))}set windowOptions(a){a&&
(this.scale=a.scale,this.fontFamily=a.fontFamily,this.textColor=a.textColor,this.backgroundColor=a.backgroundColor)}set fontFamily(a){a&&this.m_ui.mainView.style.setProperty("--dji-cwu-opt-text-font-family",a)}set textColor(a){(a=dji.color.parse(a))&&this.m_ui.mainView.style.setProperty("--dji-cwu-opt-text-color-rgb",`${a.red}, ${a.green}, ${a.blue}`)}set backgroundColor(a){(a=dji.color.parse(a))&&this.m_ui.mainView.style.setProperty("--dji-cwu-opt-bkgnd-color-rgb",`${a.red}, ${a.green}, ${a.blue}`)}set suggestionsCount(a){isNaN(a)||
this.m_ui.mainView.style.setProperty("--dji-cwu-opt-suggestion-elem-count",a)}get suggestionsCount(){return this.m_ui.mainView?this.m_ui.mainView.__suggestionsCount:0}set translationsEnabled(a){a?(this.m_ui.typePagePaneType.setAttribute("dji-cwu-options","translations"),this.setTranslations()):(this.m_ui.typePagePaneType.removeAttribute("dji-cwu-options"),this.__clearTranslations());this.m_ui.mainView.__translationsEnabled=!!a}get translationsEnabled(){return this.m_ui.mainView?this.m_ui.mainView.__translationsEnabled:
!1}set scale(a){isNaN(a)||this.m_ui.mainView.style.setProperty("--dji-cwu-opt-transform-scale",a)}setSuggestions(a,b,c){if(a=this.__buildSuggestions(0,a,b,!1))this.m_data.suggestions=a.skipCache?[]:a.entries,c&&(this.m_ui.typePagePaneTranslations.setAttribute("dji-cwu-hidden",""),this.m_ui.typePagePaneTranslations.removeAllChildren("dji-cwu-suggestion")),this.m_ui.typePagePaneSuggestions.removeAllChildren(),this.m_ui.typePagePaneSuggestions.appendChild(a.fragment),0<this.m_data.suggestions.length?
(this.m_ui.typePagePaneSuggestions.removeAttribute("dji-cwu-hidden"),this.m_ui.mainView.style.setProperty("--dji-cwu-suggestion-count",this.m_data.suggestions.length)):this.m_ui.typePagePaneSuggestions.setAttribute("dji-cwu-hidden",""),c&&this.m_data.translation.source&&this.setTranslations(),this.__updateSuggestionsNumbering(),this.__updateAccessibilityManagerInTypePage(!c)}setTranslations(a,b,c){if(a=this.__buildSuggestions(this.m_data.suggestions.length,a,b,!0))this.m_data.translations=a.skipCache?
[]:a.entries,this.m_ui.typePagePaneTranslations.removeAllChildren("dji-cwu-suggestion"),c&&(this.m_ui.typePagePaneSuggestions.setAttribute("dji-cwu-hidden",""),this.m_ui.typePagePaneSuggestions.removeAllChildren()),this.m_ui.typePagePaneTranslations.appendChild(a.fragment),this.m_ui.typePagePaneTranslations.removeAttribute("dji-cwu-hidden"),this.__updateAccessibilityManagerInTypePage(!c)}__updateSuggestionsNumbering(){9<=this.m_ui.typePagePaneSuggestions.querySelectorAll("dji-cwu-suggestion").length?
this.m_ui.typePagePaneTranslations.setAttribute("dji-cwu-restart-numbering",""):this.m_ui.typePagePaneTranslations.removeAttribute("dji-cwu-restart-numbering")}__updateTalkingWordProcessorView(a){this.m_readPageOptions.settings={rate:Number(a.rate)};this.m_ui.readSpeechRateBox.childNodes[0].innerText=this.m_readPageOptions.settings.rate.toString(10)+"x"}async __updateSpeechRecognitionView(){if(this.m_data.translation.target){var a=this.m_data.translation.target,b=this.m_ui.speakPageToolbarButtons[0];
b.__data={langCode:a.langCode||"",langShortName:a.langShortName||"",langFullName:a.langFullName||""};b.innerText=b.__data.langShortName;b.setAttribute("title",b.__data.langFullName)}if(this.m_data.translation.target&&this.m_data.translation.source){b=this.m_data.translation.source;a=this.m_ui.speakPageToolbarButtons[1];let c=a.querySelector('[dji-cwu-role="source"]'),d=a.querySelector('[dji-cwu-role="target"]');c.innerText=this.m_data.translation.source.langShortName;d.innerText=this.m_data.translation.target.langShortName;
a.__data={langCode:b.langCode||"",langShortName:b.langShortName||"",langFullName:b.langFullName||""};b=(await window.dji.cwe.i18n.instance.getMessage("cwu_guess_window_translate_speech")||"").replace("<_SOURCE_>",this.m_data.translation.source.langFullName).replace("<_TARGET_>",this.m_data.translation.target.langFullName);a.setAttribute("title",b)}a=this.m_ui.speakPageToolbarButtons[0];this.m_ui.speakPageToolbarButtons.removeAttribute("dji-cwu-active");this.updateIconForElement(this.m_ui.speakPageToolbarButtons);
this.m_data.translation.target&&this.m_data.translation.source?(this.m_ui.speakPagePaneSpeak.setAttribute("dji-cwu-options","multiple-languages"),a.setAttribute("dji-cwu-active",""),this.updateIconForElement(a)):this.m_ui.speakPagePaneSpeak.removeAttribute("dji-cwu-options");this.m_ui.speakPageMicrophone.__data=a.__data}async pulseSpeechRecognition(a,b){"dictation"===b&&this.m_ui.speakPageMicrophone.__isActive&&(!0===a?(this.m_ui.speakPageMicrophone.setAttribute("dji-cwu-state","pulse"),this.m_ui.speakPageInfo.innerText=
await window.dji.cwe.i18n.instance.getMessage("cwu_guess_window_listening")):!1===a&&(this.m_ui.speakPageMicrophone.setAttribute("dji-cwu-state","active"),this.m_ui.speakPageInfo.innerText=await window.dji.cwe.i18n.instance.getMessage("cwu_guess_window_speak_now")))}async stopSpeechRecognition(a){"dictation"!==a&&null!==a||!this.m_ui.speakPageMicrophone.__isActive?"search_topics"===a&&this.m_ui.topicsSearchBox.__speechRecognitionActive&&this.__onTopicsSearchStopSpeechRecognition(!1,!0):(this.m_ui.speakPageMicrophone.setAttribute("dji-cwu-state",
"idle"),this.m_ui.speakPageInfo.innerText=await window.dji.cwe.i18n.instance.getMessage("cwu_guess_window_start_stt"),this.m_ui.speakPageMicrophone.__isActive=!1,a=this.m_ui.speakPageMicrophone.querySelector("i.dji-svg-icon"),a.classList.remove("svg-mic_white"),a.classList.add("svg-mic_blue"))}showSpeechRecognitionError(a,b,c){"dictation"===b?this.m_ui.tabViewPageSpeak&&(a?("speech-recognition"!==this.m_ui.mainView.getAttribute("dji-cwu-mode")&&this.__onTabViewToolbarButtonClick(this.m_ui.tabViewSpeakToolbarButton,
!0),this.m_ui.tabViewPageSpeak.getElementsByClassName("error-title")[0].innerHTML=c.title,this.m_ui.tabViewPageSpeak.getElementsByClassName("error-message")[0].innerHTML=c.message,this.m_ui.tabViewPageSpeak.getElementsByClassName("error-button")[0].setAttribute("dji-cwu-link-to",c.action),this.m_ui.tabViewToolbar.setAttribute("dji-cwu-error",""),this.m_ui.tabViewPageSpeak.setAttribute("dji-cwu-error","")):(this.m_ui.tabViewToolbar.removeAttribute("dji-cwu-error",""),this.m_ui.tabViewPageSpeak.removeAttribute("dji-cwu-error"))):
"search_topics"===b&&this.m_ui.topicsSearchBox.__speechRecognitionActive&&this.__onTopicsSearchStopSpeechRecognition(!1,!0)}__onStopPulseSpeechRecognition(a){this.pulseSpeechRecognition(!1,a)}set searchTopicsPattern(a){this.m_ui.topicsSearchBox.__speechRecognitionActive&&(this.m_ui.topicsSearchBarInput.value=a||"",this.__onTopicsSearchStopSpeechRecognition(!0),this.__onTopicsSearchInputChange(this.m_ui.topicsSearchBarInput))}set topics(a){this.m_data.topics=a?[...a]:[];this.m_data.topicsUpperCase=
this.m_data.topics.map(function(b){return b.toUpperCase()})}set displayTopics(a){let b=this.__buildTopics(a);this.m_ui.topicsMainPane.removeAllChildren();this.m_ui.topicsMainPane.appendChild(b);this.m_data.displayTopics=a?[...a]:[];this.__updateAccessibilityManagerInTopicsPage(!1,!1,!0)}__buildSuggestions(a,b,c,d){if(this.m_templates.suggestion){var e=!(!d||b&&!(0>=b.length));e&&(b=[`${this.m_data.translation.source.langShortName} > ${this.m_data.translation.target.langShortName}`],c=[(this.m_messages.translateWriting[this.m_data.locale]||
"").replace("${source}",this.m_data.translation.source.langFullName).replace("${target}",this.m_data.translation.target.langFullName)]);b=b||[];c=c||b;b.length!==c.length&&(c=b);var f=document.createDocumentFragment(),k=[];for(let h=0;h<b.length;h++){let g=e?this.m_templates.suggestionTranslationPlaceholder.cloneNode(!0):this.m_templates.suggestion.cloneNode(!0);if(e){let l=g.querySelector('[dji-cwu-role="source"]'),m=g.querySelector('[dji-cwu-role="target"]');l.innerText=this.m_data.translation.source.langShortName;
m.innerText=this.m_data.translation.target.langShortName}else g.innerText=b[h];g.__data={isTranslation:d,index:a&&a+h+1||h+1,item:b[h],audio:c[h]};this.m_demoMode||(e||(g.addEventListener("click",this.m_eventHandlers.__onTypePageSuggestionClick),g.addEventListener("x-enter",this.m_eventHandlers.__onTypePageSuggestionClick)),g.addEventListener("mouseover",this.m_eventHandlers.__onTypePageSuggestionMouseOver),g.addEventListener("x-focus",this.m_eventHandlers.__onTypePageSuggestionMouseOver),g.addEventListener("mouseout",
this.m_eventHandlers.__onGenericMouseOut),g.addEventListener("x-blur",this.m_eventHandlers.__onGenericMouseOut));f.appendChild(g);k.push(g.__data)}return{fragment:f,entries:k,skipCache:e}}}__clearGuesses(){this.m_ui.typePagePaneSuggestions.removeAllChildren();this.__updateSuggestionsNumbering()}__clearTranslations(){this.m_ui.typePagePaneTranslations.removeAllChildren("dji-cwu-suggestion");this.m_ui.typePagePaneTranslations.setAttribute("dji-cwu-hidden","")}__buildTopics(a){if(this.m_templates.lookupTopic){a=
a||[];var b=document.createDocumentFragment();for(let c=0;c<a.length;c++){let d=this.m_templates.topic.cloneNode(!0),e=d.querySelector("dji-cwu-label"),f=d.querySelector("dji-cwu-switch");e.innerText=a[c].name;f.turnOn(a[c].active);d.__data=e.__data=f.__data={item:a[c].name,active:a[c].active,topic:a[c]};this.m_demoMode||(f.addEventListener("click",this.m_eventHandlers.__onTopicsItemOnOff),e.addEventListener("mouseover",this.m_eventHandlers.__onGenericMouseOver),e.addEventListener("mouseout",this.m_eventHandlers.__onGenericMouseOut),
d.addEventListener("x-enter",this.m_eventHandlers.__onTopicsItemOnOff),d.addEventListener("x-focus",this.m_eventHandlers.__onGenericMouseOver),d.addEventListener("x-blur",this.m_eventHandlers.__onGenericMouseOut));b.appendChild(d)}return b}}__buildTopicSearchResults(a,b){if(this.m_templates.lookupTopic){b=b||[];var c=document.createDocumentFragment(),d=[];for(let e=0;e<b.length;e++){let f=this.m_templates.lookupTopic.cloneNode(!0);f.innerText=b[e].name;f.__data={item:b[e].name,url:b[e].url,local:a};
this.m_demoMode||(f.addEventListener("click",this.m_eventHandlers.__onTopicsSearchItemClick),f.addEventListener("x-enter",this.m_eventHandlers.__onTopicsSearchItemClick),f.addEventListener("mouseover",this.m_eventHandlers.__onGenericMouseOver),f.addEventListener("mouseout",this.m_eventHandlers.__onGenericMouseOut));c.appendChild(f);d.push(f.__data)}return{fragment:c,entries:d}}}__prepareTranslationLanguages(a){this.m_data.translation.target=null;this.m_data.translation.source=null;a&&a.target&&a.target.langCode&&
0<a.target.langCode.length&&(this.m_data.translation.target=a.target);a&&a.source&&a.source.langCode&&0<a.source.langCode.length&&(this.m_data.translation.source=a.source);return!(!this.m_data.translation.target||!this.m_data.translation.source)}__detectElements(){this.m_ui.tabView=this.m_ui.mainView.querySelector("dji-cwu-tab-view");this.m_ui.tabViewToolbar=this.m_ui.tabView.querySelectorAll("dji-cwu-tab-view-toolbar");this.m_ui.tabViewToolbarButtons=this.m_ui.tabView.querySelectorAll("dji-cwu-tab-view-toolbar-button");
this.m_ui.tabViewPages=this.m_ui.tabView.querySelectorAll("dji-cwu-tab-view-page");this.m_ui.tabViewPageRead=this.m_ui.tabView.querySelector('dji-cwu-tab-view-page[dji-cwu-role="talking-word-processor"]');this.m_ui.tabViewPageType=this.m_ui.tabView.querySelector('dji-cwu-tab-view-page[dji-cwu-role="type"]');this.m_ui.tabViewPageTopics=this.m_ui.tabView.querySelector('dji-cwu-tab-view-page[dji-cwu-role="topics"]');this.m_ui.tabViewPageSpeak=this.m_ui.tabView.querySelector('dji-cwu-tab-view-page[dji-cwu-role="speech-recognition"]');
this.m_ui.tabViewTypeToolbarButton=this.m_ui.tabView.querySelector("dji-cwu-tab-view-toolbar-button[dji-cwu-link-to=type]");this.m_ui.tabViewTopicsToolbarButton=this.m_ui.tabView.querySelector("dji-cwu-tab-view-toolbar-button[dji-cwu-link-to=topics]");this.m_ui.tabViewSpeakToolbarButton=this.m_ui.tabView.querySelector("dji-cwu-tab-view-toolbar-button[dji-cwu-link-to=speech-recognition]");this.m_ui.typePageToolbarButtons=this.m_ui.tabViewPageType.querySelectorAll("dji-cwu-toolbar-button");this.m_ui.typePageToolbarButtonABC=
this.m_ui.tabViewPageType.querySelector('dji-cwu-toolbar-button[dji-cwu-link-to="suggestions"]');this.m_ui.typePageToolbarButton123=this.m_ui.tabViewPageType.querySelector('dji-cwu-toolbar-button[dji-cwu-link-to="keyboard"]');this.m_ui.typePagePanes=this.m_ui.tabViewPageType.querySelectorAll("dji-cwu-suggestions-pane, dji-cwu-keyboard-pane");this.m_ui.typePagePaneType=this.m_ui.tabViewPageType.querySelector("dji-cwu-suggestions-pane");this.m_ui.typePagePane123Keyboard=this.m_ui.tabViewPageType.querySelector("dji-cwu-keyboard-pane");
this.m_ui.typePagePaneSuggestions=this.m_ui.typePagePaneType.querySelector("dji-cwu-guesses-pane");this.m_ui.typePagePaneTranslations=this.m_ui.typePagePaneType.querySelector("dji-cwu-translations-pane");this.m_ui.typePagePane123Keys=this.m_ui.typePagePane123Keyboard.querySelectorAll("dji-cwu-keyboard-key");this.m_ui.readPagePaneSpeak=this.m_ui.tabViewPageRead.querySelector("dji-cwu-talking-word-processor-pane");this.m_ui.readButton=this.m_ui.tabViewPageRead.querySelector('dji-cwu-icon[dji-cwu-role="read"]');
this.m_ui.readSkipBackButton=this.m_ui.tabViewPageRead.querySelector('dji-cwu-icon[dji-cwu-role="speech-back"]');this.m_ui.readSpeechRateControl=this.m_ui.readPagePaneSpeak.querySelector("dji-cwu-speech-rate-control");this.m_ui.readSpeechRateBox=this.m_ui.readPagePaneSpeak.querySelector("dji-cwu-speech-rate-box");this.m_ui.readIncrementSpeechRate=this.m_ui.readPagePaneSpeak.querySelector('dji-cwu-icon[dji-cwu-role="speech-rate-plus"]');this.m_ui.readDecrementSpeechRate=this.m_ui.readPagePaneSpeak.querySelector('dji-cwu-icon[dji-cwu-role="speech-rate-minus"]');
this.m_ui.speakPageToolbar=this.m_ui.tabViewPageSpeak.querySelector("dji-cwu-toolbar");this.m_ui.speakPageToolbarButtons=this.m_ui.speakPageToolbar.querySelectorAll("dji-cwu-toolbar-button");this.m_ui.speakPageButtons=this.m_ui.tabViewPageSpeak.querySelectorAll("dji-cwu-button");this.m_ui.speakPagePanes=this.m_ui.tabViewPageSpeak.querySelectorAll("dji-cwu-error-pane, dji-cwu-speech-recognition-pane");this.m_ui.speakPagePaneSpeak=this.m_ui.tabViewPageSpeak.querySelector("dji-cwu-speech-recognition-pane");
this.m_ui.speakPagePaneError=this.m_ui.tabViewPageSpeak.querySelector("dji-cwu-error-pane");this.m_ui.speakPageInfo=this.m_ui.speakPagePaneSpeak.querySelector("dji-cwu-info");this.m_ui.speakPageMicrophone=this.m_ui.speakPagePaneSpeak.querySelector('dji-cwu-icon[dji-cwu-role="microphone"]');this.m_ui.topicsSearchBox=this.m_ui.tabViewPageTopics.querySelector("dji-cwu-search-box");this.m_ui.topicsMainPane=this.m_ui.tabViewPageTopics.querySelector("dji-cwu-topics-pane");this.m_ui.topicsSearchBar=this.m_ui.topicsSearchBox.querySelector("dji-cwu-search-bar");
this.m_ui.topicsSearchBarInput=this.m_ui.topicsSearchBar.querySelector("input");this.m_ui.topicsSearchBarBack=this.m_ui.topicsSearchBar.querySelector('dji-cwu-icon[dji-cwu-role="back"]');this.m_ui.topicsSearchBarStartSpeak=this.m_ui.topicsSearchBar.querySelector('dji-cwu-icon[dji-cwu-role="start_speak"]');this.m_ui.topicsSearchBarStopSpeak=this.m_ui.topicsSearchBar.querySelector('dji-cwu-icon[dji-cwu-role="stop_speak"]');this.m_ui.topicsSearchBarClear=this.m_ui.topicsSearchBar.querySelector('dji-cwu-icon[dji-cwu-role="clear"]');
this.m_ui.topicsSearchResults=this.m_ui.topicsSearchBox.querySelector("dji-cwu-search-results");this.m_ui.topicsSearchResultsLocal=this.m_ui.topicsSearchResults.querySelector('dji-cwu-search-results-group[dji-cwu-role="dji-cwu-local"]');this.m_ui.topicsSearchResultsWeb=this.m_ui.topicsSearchResults.querySelector('dji-cwu-search-results-group[dji-cwu-role="dji-cwu-web"]');this.m_ui.topicsSearchInfo=this.m_ui.topicsSearchResults.querySelector('dji-cwu-info-pane[dji-cwu-role="info-no-results"]');this.m_ui.topicsSearchInfoPattern=
this.m_ui.topicsSearchInfo.querySelector('dji-cwu-div[dji-cwu-role="name"]');this.m_ui.topicsUpdateInfo=this.m_ui.topicsSearchResults.querySelector('dji-cwu-info-pane[dji-cwu-role="info-update-topics"]');this.m_ui.topicsUpdateInfoName=this.m_ui.topicsUpdateInfo.querySelector('dji-cwu-div[dji-cwu-role="name"]')}__addEventListeners(){this.m_demoMode||(this.m_ui.tabViewToolbarButtons.addEventListener("click",this.m_eventHandlers.__onTabViewToolbarButtonClick),this.m_ui.tabViewToolbarButtons.addEventListener("x-enter",
this.m_eventHandlers.__onTabViewToolbarButtonClick),this.m_ui.typePageToolbarButtons.addEventListener("click",this.m_eventHandlers.__onTypePageToolbarButtonClick),this.m_ui.typePageToolbarButtons.addEventListener("x-enter",this.m_eventHandlers.__onTypePageToolbarButtonClick),this.m_ui.typePagePane123Keys.addEventListener("click",this.m_eventHandlers.__onTypePageKeyboardItemClick),this.m_ui.typePagePane123Keys.addEventListener("x-enter",this.m_eventHandlers.__onTypePageKeyboardItemClick),this.m_ui.typePagePane123Keys.addEventListener("mouseover",
this.m_eventHandlers.__onTypePageKeyboardItemMouseOver),this.m_ui.typePagePane123Keys.addEventListener("mouseout",this.m_eventHandlers.__onGenericMouseOut),this.m_ui.readButton.addEventListener("click",this.m_eventHandlers.__onReadPageReadButtonClick),this.m_ui.readButton.addEventListener("x-enter",this.m_eventHandlers.__onReadPageReadButtonClick),this.m_ui.readSkipBackButton.addEventListener("click",this.m_eventHandlers.__onReadPageReadSkipBackButtonClick),this.m_ui.readSkipBackButton.addEventListener("x-enter",
this.m_eventHandlers.__onReadPageReadSkipBackButtonClick),this.m_ui.readSpeechRateBox.addEventListener("click",this.m_eventHandlers.__onReadSpeechRateBoxClick),this.m_ui.readSpeechRateBox.addEventListener("click",this.m_eventHandlers.__onReadSpeechRateBoxClick),this.m_ui.readIncrementSpeechRate.addEventListener("click",this.m_eventHandlers.__onReadPageIncrementRateClick),this.m_ui.readIncrementSpeechRate.addEventListener("x-enter",this.m_eventHandlers.__onReadPageIncrementRateClick),this.m_ui.readDecrementSpeechRate.addEventListener("click",
this.m_eventHandlers.__onReadPageDecrementRateClick),this.m_ui.readDecrementSpeechRate.addEventListener("x-enter",this.m_eventHandlers.__onReadPageDecrementRateClick),this.m_ui.speakPageToolbarButtons.addEventListener("click",this.m_eventHandlers.__onSpeakPageToolbarButtonClick),this.m_ui.speakPageToolbarButtons.addEventListener("x-enter",this.m_eventHandlers.__onSpeakPageToolbarButtonClick),this.m_ui.speakPageButtons.addEventListener("click",this.m_eventHandlers.__onSpeakPageButtonClick),this.m_ui.speakPageButtons.addEventListener("x-enter",
this.m_eventHandlers.__onSpeakPageButtonClick),this.m_ui.speakPageMicrophone.addEventListener("click",this.m_eventHandlers.__onSpeakPageMicrophoneClick),this.m_ui.speakPageMicrophone.addEventListener("x-enter",this.m_eventHandlers.__onSpeakPageMicrophoneClick),this.m_ui.speakPageInfo.addEventListener("click",this.m_eventHandlers.__onSpeakPageInfoClick),this.m_ui.speakPageInfo.addEventListener("x-enter",this.m_eventHandlers.__onSpeakPageInfoClick),this.m_ui.topicsSearchBarInput.addEventListener("keydown",
DjiCwuMainView.__onStopPropagation),this.m_ui.topicsSearchBarInput.addEventListener("keypress",DjiCwuMainView.__onStopPropagation),this.m_ui.topicsSearchBarInput.addEventListener("keyup",DjiCwuMainView.__onStopPropagation),this.m_ui.topicsSearchBarInput.addEventListener("input",DjiCwuMainView.__onStopPropagation),this.m_ui.topicsSearchBarInput.addEventListener("click",this.m_eventHandlers.__onTopicsSearchInputClick),this.m_ui.topicsSearchBarInput.addEventListener("x-enter",this.m_eventHandlers.__onTopicsSearchInputClick),
this.m_ui.topicsSearchBarInput.addEventListener("focus",this.m_eventHandlers.__onTopicsSearchInputFocus),this.m_ui.topicsSearchBarInput.addEventListener("blur",this.m_eventHandlers.__onTopicsSearchInputBlur),this.m_ui.topicsSearchBarInput.addEventListener("input",this.m_eventHandlers.__onTopicsSearchInputChange),this.m_ui.topicsSearchBarBack.addEventListener("click",this.m_eventHandlers.__onTopicsSearchBack),this.m_ui.topicsSearchBarBack.addEventListener("x-enter",this.m_eventHandlers.__onTopicsSearchBack),
this.m_ui.topicsSearchBarStartSpeak.addEventListener("click",this.m_eventHandlers.__onTopicsSearchStartSpeechRecognition),this.m_ui.topicsSearchBarStartSpeak.addEventListener("x-enter",this.m_eventHandlers.__onTopicsSearchStartSpeechRecognition),this.m_ui.topicsSearchBarStopSpeak.addEventListener("click",this.m_eventHandlers.__onTopicsSearchStopSpeechRecognition),this.m_ui.topicsSearchBarStopSpeak.addEventListener("x-enter",this.m_eventHandlers.__onTopicsSearchStopSpeechRecognition),this.m_ui.topicsSearchBarClear.addEventListener("click",
this.m_eventHandlers.__onTopicsSearchClear),this.m_ui.topicsSearchBarClear.addEventListener("x-enter",this.m_eventHandlers.__onTopicsSearchClear))}__createEventHandlers(){if(!this.m_demoMode){var a=this;this.m_eventHandlers.__onTabViewToolbarButtonClick=function(){a.__onTabViewToolbarButtonClick(this)};this.m_eventHandlers.__onTypePageToolbarButtonClick=function(){a.__onTypePageToolbarButtonClick(this)};this.m_eventHandlers.__onTypePageSuggestionMouseOver=function(b){a.__onTypePageSuggestionMouseOver(this,
"x-focus"===b.type)};this.m_eventHandlers.__onTypePageSuggestionMouseMove=function(b){a.__onTypePageSuggestionMouseMove(this,b)};this.m_eventHandlers.__onTypePageSuggestionClick=function(){a.__onTypePageSuggestionClick(this)};this.m_eventHandlers.__onTypePageKeyboardItemMouseOver=function(){a.__onTypePageKeyboardItemMouseOver(this)};this.m_eventHandlers.__onTypePageKeyboardItemClick=function(){a.__onTypePageKeyboardItemClick(this)};this.m_eventHandlers.__onSpeakPageToolbarButtonClick=function(){a.__onSpeakPageToolbarButtonClick(this)};
this.m_eventHandlers.__onSpeakPageButtonClick=function(){a.__onSpeakPageButtonClick(this)};this.m_eventHandlers.__onSpeakPageMicrophoneClick=function(){a.__onSpeakPageMicrophoneClick(this)};this.m_eventHandlers.__onSpeakPageInfoClick=function(){a.__onSpeakPageInfoClick(this)};this.m_eventHandlers.__onReadPageReadButtonClick=function(){a.__onReadPageReadButtonClick(this)};this.m_eventHandlers.__onReadPageReadSkipBackButtonClick=function(b){a.__onReadPageReadSkipBackButtonClick(this,b.detail)};this.m_eventHandlers.__onReadSpeechRateBoxClick=
function(){a.__onReadSpeechRateBoxClick(this)};this.m_eventHandlers.__onReadPageIncrementRateClick=function(){a.__onReadPageIncrementRateClick(this)};this.m_eventHandlers.__onReadPageDecrementRateClick=function(){a.__onReadPageDecrementRateClick(this)};this.m_eventHandlers.__onTopicsSearchInputClick=function(){a.m_ui.topicsSearchBarInput.focus()};this.m_eventHandlers.__onTopicsSearchInputFocus=function(){a.__onTopicsSearchInputFocus()};this.m_eventHandlers.__onTopicsSearchInputBlur=function(){a.__onTopicsSearchInputBlur()};
this.m_eventHandlers.__onTopicsSearchInputChange=function(b){a.__onTopicsSearchInputChange(this)};this.m_eventHandlers.__onTopicsSearchBack=function(){a.__onTopicsSearchBack()};this.m_eventHandlers.__onTopicsSearchStartSpeechRecognition=function(){a.__onTopicsSearchStartSpeechRecognition()};this.m_eventHandlers.__onTopicsSearchStopSpeechRecognition=function(){a.__onTopicsSearchStopSpeechRecognition()};this.m_eventHandlers.__onTopicsSearchClear=function(){a.__onTopicsSearchClear()};this.m_eventHandlers.__onTopicsSearchItemClick=
function(){a.__onTopicsSearchItemClick(this)};this.m_eventHandlers.__onTopicsItemOnOff=function(){let b="dji-cwu-switch"===this.tagName.toLowerCase()?this:this.querySelector("dji-cwu-switch");b&&a.__onTopicsItemOnOff(b)};this.m_eventHandlers.__onGenericMouseOver=function(){a.__onGenericMouseOver(this)};this.m_eventHandlers.__onGenericMouseOut=function(){a.__onGenericMouseOut(this)}}}__sendNewTabOpenedGA4Event(a){switch(a){case "talking-word-processor":a="ReadTabOpened";break;case "type":a="PredictionTabOpened";
break;case "topics":a="TopicTabOpened";break;case "speech-recognition":a="SpeechToTextTabOpened";break;default:a=null}this.__postGA4Event(a,null,{website:location.hostname})}__sendSwitchKeyboardGA4Event(a){switch(a){case "suggestions":this.__postGA4Event("SwitchToAlphabetSelected",null,{website:location.hostname});break;case "keyboard":this.__postGA4Event("SwitchToNumericSelected",null,{website:location.hostname})}}__onTabViewToolbarButtonClick(a,b){let c=a.getAttribute("dji-cwu-link-to"),d=this.trueKeyMode;
if(DjiCwuMainView.__isActive(a)){if(!this.__isHorizontalLayout()&&this.m_ui.mainView.getAttribute("dji-cwu-mode")!==c){this.m_ui.mainView.setAttribute("dji-cwu-mode",c);this.__notifyTrueKeyModeDidChange(d);return}c="type";a=this.m_ui.mainView.querySelector(`[dji-cwu-link-to='${c}']`)}this.__notifyStopSpeechRecognition();var e=this.m_ui.tabView.querySelector("dji-cwu-tab-view-page[dji-cwu-active");e=e?e.getAttribute("dji-cwu-role"):null;let f=this.m_ui.tabView.querySelector(`dji-cwu-tab-view-page[dji-cwu-role="${c}"]`);
this.m_ui.tabViewToolbar.removeAttribute("dji-cwu-error","");this.m_ui.tabViewPageSpeak.removeAttribute("dji-cwu-error");this.m_ui.tabViewToolbarButtons.removeAttribute("dji-cwu-active");this.m_ui.tabViewPages.removeAttribute("dji-cwu-active");a.setAttribute("dji-cwu-active","");f.setAttribute("dji-cwu-active","");this.updateIconForElement(this.m_ui.tabViewToolbarButtons);this.updateIconForElement(a);this.m_ui.mainView.setAttribute("dji-cwu-mode",c);this.__resetAccessibilityManager();!b&&this.m_delegates.viewDidChangeDelegate&&
(this.__sendNewTabOpenedGA4Event(c),this.m_delegates.viewDidChangeDelegate(c,e));this.__notifyTrueKeyModeDidChange(d)}updateIconForElement(a){a=NodeList.prototype.isPrototypeOf(a)?[...a]:[a];for(const b of a)if(a=b.querySelector("i.dji-svg-icon")){const c=b.hasAttribute("dji-cwu-active");let d="",e="";for(const f of a.classList.values())f.startsWith("svg-")&&(c?f.endsWith("_white")||(d=f,e=f+"_white"):f.endsWith("_white")&&(d=f,e=f.substring(0,f.length-6)));""!==d&&(a.classList.remove(d),a.classList.add(e))}}__onTypePageToolbarButtonClick(a){if(!DjiCwuMainView.__isActive(a)){var b=
this.m_ui.mainView.getAttribute("dji-cwu-mode");"type"!==b&&(b=this.m_ui.tabViewToolbar[0].querySelector(`[dji-cwu-link-to='${b}']`),this.__onTabViewToolbarButtonClick(b));b=this.trueKeyMode;var c=a.getAttribute("dji-cwu-link-to"),d=this.m_ui.tabViewPageType.querySelector(`[dji-cwu-role="${c}"]`);this.__sendSwitchKeyboardGA4Event(c);this.m_ui.typePageToolbarButtons.removeAttribute("dji-cwu-active");this.m_ui.typePagePanes.removeAttribute("dji-cwu-active");a.setAttribute("dji-cwu-active","");d.setAttribute("dji-cwu-active",
"");this.updateIconForElement(this.m_ui.typePageToolbarButtons);this.updateIconForElement(a);this.__resetAccessibilityManager();this.__notifyTrueKeyModeDidChange(b)}}__onTypePageSuggestionMouseOver(a,b){b?(a.removeEventListener("mousemove",this.m_eventHandlers.__onTypePageSuggestionMouseMove),this.__scheduleSpeakText(a.__data.audio)):a.addEventListener("mousemove",this.m_eventHandlers.__onTypePageSuggestionMouseMove)}__onTypePageSuggestionMouseMove(a,b){5<Math.sqrt(Math.pow(b.clientX-this.m_ui.mousePosition.x,
2)+Math.pow(b.clientY-this.m_ui.mousePosition.y,2))&&(this.m_ui.mousePosition.x=b.clientX,this.m_ui.mousePosition.y=b.clientY,a.removeEventListener("mousemove",this.m_eventHandlers.__onTypePageSuggestionMouseMove),this.__scheduleSpeakText(a.__data.audio))}__onTypePageSuggestionClick(a){this.m_delegates.suggestionClickDelegate&&this.m_delegates.suggestionClickDelegate(a.__data)}__onTypePageKeyboardItemMouseOver(a){a=a.getAttribute("dji-cwu-data");this.__scheduleSpeakText(a)}__onTypePageKeyboardItemClick(a){a=
parseInt(a.getAttribute("dji-cwu-data"));this.m_delegates.keyboardClickDelegate&&!isNaN(a)&&0<=a<=9&&this.m_delegates.keyboardClickDelegate({type:"click",code:`Digit${a}`,key:`${a}`,keyCode:`${a}`.charCodeAt(0),which:`${a}`.charCodeAt(0)})}__isHorizontalLayout(){return!!this.m_ui.mainView.closest("[dji-horizontal-layout]")}__postGA4Event(a,b,c){this.m_delegates.postGA4Event&&this.m_delegates.postGA4Event(a,b,c)}__onSpeakPageToolbarButtonClick(a){DjiCwuMainView.__isActive(a)||(this.__notifyStopSpeechRecognition(),
this.m_ui.speakPageToolbarButtons.removeAttribute("dji-cwu-active"),a.setAttribute("dji-cwu-active",""),this.updateIconForElement(this.m_ui.speakPageToolbarButtons),this.updateIconForElement(a),this.m_ui.speakPageMicrophone.__data=a.__data)}__onSpeakPageButtonClick(a){a=a.getAttribute("dji-cwu-link-to");"dismiss"===a?this.resetSpeechRecognitionPage(!0):"open-settings"===a&&chrome.runtime.sendMessage({message:window.dji.messages.cwe.chrome.OPEN_CONTENT_SETTINGS},()=>{this.resetSpeechRecognitionPage(!0)})}async __onSpeakPageMicrophoneClick(a){const b=
!a.__isActive;var c=!0;this.m_delegates.canToggleSpeechRecognitionDelegate&&(c=this.m_delegates.canToggleSpeechRecognitionDelegate(b));c&&(b&&(a.setAttribute("dji-cwu-state","active"),c=a.querySelector("i.dji-svg-icon"),c.classList.remove("svg-mic_blue"),c.classList.add("svg-mic_white"),this.m_ui.speakPageInfo.innerText=await window.dji.cwe.i18n.instance.getMessage("cwu_guess_window_speak_now"),a.__isActive=!0),this.m_delegates.speechRecognitionDelegate&&this.m_delegates.speechRecognitionDelegate({activate:b,
langCode:a.__data.langCode,scope:"dictation"}))}__onSpeakPageInfoClick(a){}__cancelReadPageTimer(){this.m_readPageTimer&&(clearTimeout(this.m_readPageTimer),this.m_readPageTimer=null)}__sendSpeedChangedEvent(a,b){this.__postGA4Event("SpeedChanged",{speed_set:a,change_location:b},{website:b.hostname})}__onReadSpeechRateBoxClick(a){this.m_readPageOptions.settings.rate=this.m_readPageOptions.settings.rate>=this.m_maxSpeechRate?this.m_minSpeechRate:Number(this.m_readPageOptions.settings.rate+.5).toFixed(1);
this.__sendSpeedChangedEvent(this.m_readPageOptions.settings.rate,"prediction_window");this.__updateTalkingWordProcessorView(this.m_readPageOptions.settings)}__onReadPageIncrementRateClick(a){this.m_readPageOptions.settings.rate>=this.m_maxSpeechRate||(this.m_readPageOptions.settings.rate=Number(this.m_readPageOptions.settings.rate+.1).toFixed(1),this.__sendSpeedChangedEvent(this.m_readPageOptions.settings.rate,"prediction_window"),this.__updateTalkingWordProcessorView(this.m_readPageOptions.settings))}__onReadPageDecrementRateClick(a){this.m_readPageOptions.settings.rate<=
this.m_minSpeechRate||(this.m_readPageOptions.settings.rate=Number(this.m_readPageOptions.settings.rate-.1).toFixed(1),this.__sendSpeedChangedEvent(this.m_readPageOptions.settings.rate,"prediction_window"),this.__updateTalkingWordProcessorView(this.m_readPageOptions.settings))}__onReadPageReadButtonClick(a){this.m_readPageOptions.activate=!a.__isActive;this.m_readPageOptions.activate?this.__postGA4Event("PlaySelected",null,{website:location.hostname}):this.__postGA4Event("PauseSelected",null,{website:location.hostname});
this.m_readPageOptions.skip=window.dji.mapping.Skip.NONE;this.m_readPageOptions.skipCount=0;this.__readPageWithOptions(this.m_readPageOptions)}__onReadPageReadSkipBackButtonClick(a,b){this.m_readPageOptions.activate=!a.__isActive;3<=b?(this.m_readPageOptions.skip=window.dji.mapping.Skip.PARAGRAPH,this.m_readPageOptions.skipCount=1):2===b?(this.m_readPageOptions.skip=window.dji.mapping.Skip.SENTENCE,this.m_readPageOptions.skipCount=1):(this.m_readPageOptions.skip=window.dji.mapping.Skip.WORD,this.m_readPageOptions.skipCount=
10);this.m_timers.skipBackRead.trigger(300)}__onReadPageReadSkipBackReadTimer(){if(this.m_readPageOptions&&this.m_readPageOptions.skip){let a=null;switch(this.m_readPageOptions.skip){case window.dji.mapping.Skip.WORD:a=1;break;case window.dji.mapping.Skip.SENTENCE:a=2;break;case window.dji.mapping.Skip.PARAGRAPH:a=3}this.__postGA4Event("PreviousTenWordsSelected",{clicks:a},{website:location.hostname})}this.__readPageWithOptions(this.m_readPageOptions)}async __readPageWithOptions(a){this.m_delegates.readDelegate&&
await this.m_delegates.readDelegate(a)}onTextHighlightStatusChanged(a){this.m_ui.readButton.__isActive=a;const b=this.m_ui.readButton.querySelector("i.dji-svg-icon");a?(this.m_ui.readButton.setAttribute("dji-cwu-state","active"),this.m_ui.readButton.setAttribute("dji-cwu-src","pause"),this.m_ui.readSpeechRateControl.setAttribute("dji-cwu-state","disabled"),b.classList.remove("svg-play_arrow"),b.classList.add("svg-pause")):(this.m_ui.readButton.setAttribute("dji-cwu-state","idle"),this.m_ui.readButton.setAttribute("dji-cwu-src",
"play_arrow"),this.m_ui.readSpeechRateControl.setAttribute("dji-cwu-state",""),b.classList.remove("svg-pause"),b.classList.add("svg-play_arrow"))}__onTopicsSearchInputFocus(){this.m_ui.topicsSearchBarInput.__search={session:null,pattern:null};this.m_ui.topicsSearchBox.activate(!0);this.__pushTopicSearchStateToAccessibilityManager()}__onTopicsSearchInputBlur(){this.m_ui.topicsSearchBox.__speechRecognitionActive||this.m_ui.mainView.__updateTopic||(this.m_ui.topicsSearchBarInput.value="",delete this.m_ui.topicsSearchBarInput.__search,
this.__popTopicSearchStateFromAccessibilityManager(),this.m_ui.topicsSearchBox.activate(!1),this.m_ui.topicsSearchBox.removeAttribute("dji-cwu-no-results"),this.m_ui.topicsSearchBox.removeAttribute("dji-cwu-input"),this.m_ui.topicsSearchBox.removeAttribute("dji-cwu-speech-recognition"),this.m_ui.mainView.__updateTopic||(this.m_ui.mainView.removeAttribute("dji-cwu-update-topics"),this.m_ui.mainView.removeAttribute("dji-cwu-update-topics-hint")))}__onTopicsSearchBack(){this.m_ui.mainView.__updateTopic||
(this.m_ui.topicsSearchBarInput.getRootNode().activeElement===this.m_ui.topicsSearchBarInput?(this.m_ui.topicsSearchBarInput.blur(),document.hasFocus()||this.__onTopicsSearchInputBlur()):this.__onTopicsSearchInputBlur(),this.m_ui.mainView.removeAttribute("dji-cwu-update-topics"),this.m_ui.mainView.removeAttribute("dji-cwu-update-topics-hint"),this.m_ui.topicsSearchResultsLocal.removeAllChildren(),this.m_ui.topicsSearchResultsWeb.removeAllChildren())}__onTopicsSearchStartSpeechRecognition(){if(this.m_delegates.speechRecognitionDelegate){const a=
this;this.m_ui.topicsSearchBarInput.value="";this.m_ui.topicsSearchBox.setAttribute("dji-cwu-speech-recognition","");this.m_ui.topicsSearchBox.__speechRecognitionActive=!0;this.m_ui.topicsSearchBarInput.enableInputEvents(!1);this.m_ui.topicsSearchBarInput.focusAsync(function(){a.m_ui.topicsSearchResultsLocal.removeAllChildren();a.m_ui.topicsSearchResultsWeb.removeAllChildren();a.m_delegates.speechRecognitionDelegate({activate:!0,langCode:null,scope:"search_topics"})})}}__onTopicsSearchStopSpeechRecognition(a,
b){this.m_ui.topicsSearchBox.__speechRecognitionActive&&(a||(this.m_ui.topicsSearchBarInput.value=""),this.m_ui.topicsSearchBox.removeAttribute("dji-cwu-speech-recognition"),this.m_ui.topicsSearchBox.__speechRecognitionActive=!1,this.m_ui.topicsSearchBarInput.enableInputEvents(),!a&&this.m_ui.topicsSearchBarInput.__search&&(this.m_ui.topicsSearchBarInput.__search.session=null,this.m_ui.topicsSearchBarInput.__search.pattern=null),b||this.m_delegates.speechRecognitionDelegate({activate:!1,langCode:null,
scope:"search_topics"}))}__onTopicsSearchClear(){this.m_ui.mainView.removeAttribute("dji-cwu-update-topics");this.m_ui.mainView.removeAttribute("dji-cwu-update-topics-hint");this.m_ui.topicsSearchBarInput.value="";this.__onTopicsSearchInputChange(this.m_ui.topicsSearchBarInput)}async __onTopicsSearchInputChange(a){if(!this.m_ui.topicsSearchBox.__speechRecognitionActive&&!this.m_ui.mainView.__updateTopic)if(a.__search){this.m_ui.mainView.removeAttribute("dji-cwu-update-topics");this.m_ui.mainView.removeAttribute("dji-cwu-update-topics-hint");
var b=`${Date.now()}-${parseInt(1E3*Math.random())}`,c=a.value.trim();a.__search.pattern!==c&&(this.m_timers.searchTopics.stop(),a.__search.session=b,a.__search.pattern=c,0>=c.length?(this.m_ui.topicsSearchResultsLocal.removeAllChildren(),this.m_ui.topicsSearchResultsWeb.removeAllChildren(),this.m_ui.topicsSearchBox.removeAttribute("dji-cwu-no-results"),this.m_ui.topicsSearchInfoPattern.innerText="",this.m_ui.topicsSearchBox.removeAttribute("dji-cwu-input","")):this.m_timers.searchTopics.trigger(0,
b,c))}else this.m_timers.searchTopics.stop()}async __onTopicsSearchItemClick(a){this.__postGA4Event("TopicSearchEngaged",{topic_name:a.__data.item},{website:location.hostname});if(!this.m_ui.topicsSearchBarInput.__search)return Logger.instance.error("Search metadata not found!");if(this.m_ui.mainView.__updateTopic)return Logger.instance.error("Update topics is already in progress!");const b=`${Date.now()}-${parseInt(1E3*Math.random())}`;this.m_ui.mainView.__updateTopic=!0;this.m_ui.topicsSearchBarInput.enableInputEvents(!1);
this.m_ui.topicsSearchBarInput.__search={session:b,pattern:a.__data.item};try{const c=this;await dji.topicHelper.updateTopicAsync({name:a.__data.item,url:a.__data.url,data:void 0,local:a.__data.local},function(d){c.m_ui.mainView.setAttribute("dji-cwu-update-topics",d.userData.action);d.userData.activate?c.__postGA4Event("TopicStatusChanged",{topic_name:a.__data.item,topic_status:!0},{website:location.hostname}):c.m_ui.mainView.setAttribute("dji-cwu-update-topics-hint","hint-too-many-active");c.m_ui.topicsUpdateInfoName.innerText=
d.name;c.m_ui.topicsSearchResults.scrollTop=0});this.m_ui.topicsSearchBarInput.__search&&this.m_ui.topicsSearchBarInput.__search.session===b&&(this.m_ui.mainView.removeAttribute("dji-cwu-update-topics"),this.m_ui.mainView.removeAttribute("dji-cwu-update-topics-hint"),this.m_ui.topicsUpdateInfoName.innerText="",this.m_ui.topicsSearchBarInput.enableInputEvents(),this.m_ui.mainView.__updateTopic=!1,this.__onTopicsSearchBack())}catch(c){Logger.instance.error(c),this.m_ui.topicsSearchBarInput.__search&&
this.m_ui.topicsSearchBarInput.__search.session===b&&"too_many_active_topics"===c.code&&(this.m_ui.mainView.setAttribute("dji-cwu-update-topics","too-many-active"),this.m_ui.topicsSearchBarInput.enableInputEvents(),this.m_ui.mainView.__updateTopic=!1)}}async __onTopicsItemOnOff(a){let b=a.toggleOnOff(),c=!1;window.dji.accessibility.manager.enable(!1,!0);try{const d=this;c=(await dji.topicHelper.activateTopicAsync({name:a.__data.item,activate:b},function(e){d.m_ui.mainView.setAttribute("dji-cwu-update-topics",
"on-off")})).success}catch(d){Logger.instance.error(d)}c?this.__postGA4Event("TopicStatusChanged",{topic_name:a.__data.item,topic_status:b},{website:location.hostname}):a.toggleOnOff();this.m_ui.mainView.removeAttribute("dji-cwu-update-topics");window.dji.accessibility.manager.enable(!0)}async __onSearchTopics(a,b){let c=[];a=[];try{var d=this.m_data.features;const e=d&&!d.allowCreateTopics||!this.m_delegates.searchTopicsOnWebDelegate?void 0:this.m_delegates.searchTopicsOnWebDelegate(b,this.m_data.locale);
c=this.__searchTopicsInLocal(b);e&&(a=await e)}catch(e){Logger.instance.error(e)}this.m_ui.topicsSearchResultsLocal.removeAllChildren();this.m_ui.topicsSearchResultsWeb.removeAllChildren();d=this.__buildTopicSearchResults(!0,c);a=this.__buildTopicSearchResults(!1,a);0<d.entries.length&&this.m_ui.topicsSearchResultsLocal.appendChild(d.fragment);0<a.entries.length&&this.m_ui.topicsSearchResultsWeb.appendChild(a.fragment);0<d.entries.length||0<a.entries.length?(this.m_ui.topicsSearchBox.removeAttribute("dji-cwu-no-results"),
this.m_ui.topicsSearchInfoPattern.innerText=""):(this.m_ui.topicsSearchInfoPattern.innerText=b,this.m_ui.topicsSearchBox.setAttribute("dji-cwu-no-results",""));this.m_ui.topicsSearchBox.setAttribute("dji-cwu-input","");this.__updateAccessibilityManagerInTopicsPage(!1,!0,!1)}__searchTopicsInLocal(a){a=a.toUpperCase();const b=[];for(let c=0;c<this.m_data.topicsUpperCase.length;c++)0<=this.m_data.topicsUpperCase[c].indexOf(a)&&b.push({name:this.m_data.topics[c]});b.sort();return b}__onGenericMouseOver(a){a.__data.audio?
this.__scheduleSpeakText(a.__data.audio):a.__data.item&&this.__scheduleSpeakText(a.__data.item)}__onGenericMouseOut(a){a.removeEventListener("mousemove",this.m_eventHandlers.__onTypePageSuggestionMouseMove);this.__cancelScheduleSpeakText()}__scheduleSpeakText(a){this.m_timers.speak.stop();this.m_delegates.speakDelegate&&this.m_timers.speak.trigger(500,a)}__cancelScheduleSpeakText(){this.m_timers.speak.stop()}__onSpeakText(a){this.m_delegates.speakDelegate&&this.m_delegates.speakDelegate(a)}__notifyStopSpeechRecognition(){this.m_ui.speakPageMicrophone.__isActive&&
this.m_delegates.speechRecognitionDelegate&&this.m_delegates.speechRecognitionDelegate({activate:!1,langCode:null})}__notifyTrueKeyModeDidChange(a){if(this.m_delegates.trueKeyModeDidChangeDelegate){let b=this.trueKeyMode;a!==b&&this.m_delegates.trueKeyModeDidChangeDelegate(b,a)}}__resetAccessibilityManager(){window.dji&&window.dji.accessibility&&window.dji.accessibility.manager&&(window.dji.accessibility.manager.reset(),window.dji.accessibility.manager.addBlockAndSetup("main",{name:"main",blocks:[{name:"type",
dom:{element:this.m_ui.tabViewPageType,selectors:["[dji-accessible]"]}},{name:"topics",blocks:[{name:"search_bar",dom:{element:this.m_ui.tabViewPageTopics,selectors:["dji-cwu-search-box > dji-cwu-search-bar [dji-accessible]"]}},{name:"topic_items",dom:{element:this.m_ui.tabViewPageTopics,selectors:["dji-cwu-topics-pane [dji-accessible]"]}}]},{name:"speak",dom:{element:this.m_ui.tabViewPageSpeak,selectors:["[dji-accessible]"]}},{name:"toolbar",dom:{element:this.m_ui.tabView,selectors:["dji-cwu-tab-view-toolbar-button[dji-accessible]"]}}]}),
this.__updateAccessibilityManagerInTypePage(),this.__updateAccessibilityManagerInTopicsPage(!0,!0,!0),this.__updateAccessibilityManagerInSpeakPage())}__pushTopicSearchStateToAccessibilityManager(){window.dji&&window.dji.accessibility&&window.dji.accessibility.manager&&window.dji.accessibility.manager.addBlockAndSetup("topics_search",{name:"topics_search",blocks:[{name:"search_bar",dom:{element:this.m_ui.tabViewPageTopics,selectors:["dji-cwu-search-box > dji-cwu-search-bar [dji-accessible]"]}},{name:"search_results",
dom:{element:this.m_ui.tabViewPageTopics,selectors:["dji-cwu-search-box > dji-cwu-search-results [dji-accessible]"]}}]})}__popTopicSearchStateFromAccessibilityManager(){window.dji&&window.dji.accessibility&&window.dji.accessibility.manager.removeBlock("topics_search")}__updateAccessibilityManagerInTypePage(a){window.dji&&window.dji.accessibility&&window.dji.accessibility.manager.reloadBlock("type",!!a)}__updateAccessibilityManagerInTopicsPage(a,b,c,d){window.dji&&window.dji.accessibility&&(a&&window.dji.accessibility.manager.reloadBlock("topics search search_bar",
d),b&&window.dji.accessibility.manager.reloadBlock("search_results",d),c&&window.dji.accessibility.manager.reloadBlock("topics topic_items",d))}__updateAccessibilityManagerInSpeakPage(){window.dji&&window.dji.accessibility&&window.dji.accessibility.manager.reloadBlock("speak",!0)}static __isActive(a){return!(!a||null===a.getAttribute("dji-cwu-active"))}static __onBlockDefaultBehaviour(a){a.target&&a.target.nodeType===Node.ELEMENT_NODE&&"INPUT"===a.target.nodeName.toUpperCase()||(a.preventDefault(),
a.stopPropagation())}static __onStopPropagation(a){a.stopPropagation()}};
