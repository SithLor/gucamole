(function(){function e(){$("body").addClass("dji-cwu-busy")}function f(){$("body").removeClass("dji-cwu-busy")}function m(){a.__onBrowserAction(null,!0);window.close()}function n(){e();a.__onBrowserAction(function(){f();$("#dji-cwu-on").toggleClass("dji-cwu-on")},!0)}function p(){a.onOptions();window.close()}async function q(){const b=await g();a.onCreateTopicFromPage(b.id);window.close()}async function r(){const b=await g();a.onCreateTopicFromSelection(b.id);window.close()}function g(){return new Promise((b,
d)=>{chrome.windows.getCurrent(function(h){chrome.tabs.query({highlighted:!0,windowId:h.id,windowType:"normal"},function(k){b(1===k.length?k[0]:null)})})})}function t(){a.signOut(function(b){b&&a.sendGA4Event("SignedOut",null,{website:location.hostname})});window.close()}function u(){a.onProfile();window.close()}function v(b,d,h){if("com.donjohnston.cowriter.notification"===b.message){d=!1;switch(b.reason){case "load":case "initialize_nacl_started":case "initialize_nacl_finished":case "activate":case "deactivate":case "update_topic_finished":case "update_topic_started":case "update_user_settings":d=
!0}d&&l()}}function w(){chrome.runtime.onMessage.addListener(v);$("#dji-cwu-on").on("click",n);$("#dji-cwu-topic-from-page").on("click",q);$("#dji-cwu-topic-from-selection").on("click",r);$("#dji-cwu-options").on("click",p);$("#dji-cwu-sign-in").on("click",m);$("#dji-cwu-sign-out").on("click",t);$("#dji-cwu-user-name").on("click",u);$("#dji-cwu-reload").on("click",()=>chrome.runtime.reload())}function l(){a&&a.isLoaded()&&!a.isBusy()?f():e();a.translateHtmlDocument(document);a.isLoggedIn()?(a.allowToggleOnOff()?
($("#dji-cwu-on").attr("disabled",!1),$("#dji-cwu-toggle-prediction").removeClass("dji-cwu-disabled")):($("#dji-cwu-on").attr("disabled",!0),$("#dji-cwu-toggle-prediction").addClass("dji-cwu-disabled")),$("#dji-cwu-user-name").find(".dji-cwu-menu-item-text").text(a.userInfo().name),$("[dji-cwu-login]").show(),$("[dji-cwu-no-login]").hide(),a.allowCreateTopics()?($("#dji-cwu-topic-from-page").removeClass("dji-cwu-disabled"),$("#dji-cwu-topic-from-selection").removeClass("dji-cwu-disabled")):($("#dji-cwu-topic-from-page").addClass("dji-cwu-disabled"),
$("#dji-cwu-topic-from-selection").addClass("dji-cwu-disabled")),a.allowSettings()?$("#dji-cwu-options").removeClass("dji-cwu-disabled"):$("#dji-cwu-options").addClass("dji-cwu-disabled")):($("#dji-cwu-topic-from-page").addClass("dji-cwu-disabled"),$("#dji-cwu-topic-from-selection").addClass("dji-cwu-disabled"),$("[dji-cwu-login]").hide(),$("[dji-cwu-no-login]").show());a.m_on?$("#dji-cwu-on").addClass("dji-cwu-on"):$("#dji-cwu-on").removeClass("dji-cwu-on")}let c=chrome.extension.getBackgroundPage(),
a=c&&c.CWEBackgroundManagerInstance?c.CWEBackgroundManagerInstance():null;$(document).ready(function(){l();w();c||(c=chrome.extension.getBackgroundPage());if(c){let b=c.dji.config.cowriterUrl();$("a[dji-cowriter-url]").attr("href",b)}})})();
