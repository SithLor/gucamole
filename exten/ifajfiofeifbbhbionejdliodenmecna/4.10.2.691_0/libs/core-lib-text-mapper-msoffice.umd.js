/*!************************************************************************
 **
 ** Copyright (c) 2022-2023 Don Johnston, Inc. All rights reserved.
 **
 **************************************************************************/
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(require("core-lib-utils"),require("core-lib-text-mapper")):"function"==typeof define&&define.amd?define(["core-lib-utils","core-lib-text-mapper"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).__DjiCoreLibUtils,e.__DjiTextMapper)}(this,(function(e,t){"use strict";class n extends t.CaretPositioner{constructor(e){super(e)}onMoveCaret(e,t){try{let n=Math.max(0,t),o=Math.min(t+1,e.textContent.length);n===o&&(n=Math.max(0,o-1));const r=e.ownerDocument,i=r.createRange();i.setStart(e,n),i.setEnd(e,o);const a=i.getBoundingClientRect(),s={bubbles:!0,cancelable:!0,clientX:a.left,clientY:a.top+a.height/2},c=new MouseEvent("mousedown",s),d=new MouseEvent("mouseup",s),l=new MouseEvent("click",s);let u=this.delegate.getContentEditableForNode(e);u||(u=this.delegate.getViewPanel(r)),window.requestIdleCallback((()=>{u.dispatchEvent(c),u.dispatchEvent(d),u.dispatchEvent(l)}))}catch(e){}}getCaretPositionFromPoint(t,n,o){let r,i=[],a=[],s=null;try{do{s=e.Utils.caretPositionFromPoint(t,n,o);const c=s.offsetNode?s.offsetNode.nodeType===Node.ELEMENT_NODE?s.offsetNode:s.offsetNode.parentElement:null;if(!c)break;if(c===r)break;r=c,(c.matches("div#textareaCaretTracker *")||c.matches("div#textareaCaretTracker")||c.matches("div#predictionFeedbackTooltip *")||c.matches("div#predictionFeedbackTooltip"))&&(i.push(c.style.visibility),a.push(c),c.style.visibility="hidden",s.offsetNode=null,s.offset=-1)}while(!s.offsetNode)}finally{const e=a.length;for(let t=0;t<e;++t)a[t].style.visibility=i[t]}return s}}class o extends t.ParagraphIterator{mParaMatchString="p.Paragraph";mDelegate=null;constructor(e){super("paraid"),this.mDelegate=e}getParagraphForNode(e){return e?(e.nodeType===Node.ELEMENT_NODE?e:e.parentElement).closest(this.mParaMatchString):null}getAllParagraphs(e){return this.mDelegate.getRootNode(e).querySelectorAll(this.mParaMatchString)}getCurrentParagraph(e){return this.mDelegate.getRootNode(e).querySelector('div#WACViewPanel_EditingElement[contenteditable="true"]')}nodeIsParagraph(e){return e.nodeType===Node.ELEMENT_NODE&&e.matches(this.mParaMatchString)}getClosestParagraph(e){return e.querySelector(this.mParaMatchString)}}class r extends t.DocumentTextMapperDelegate{constructor(){super({type:"ms-office-word",exclusionSelectors:["div.HiddenParagraph","div.HiddenParagraph *","div#textareaCaretTracker","div#textareaCaretTracker *","div#predictionFeedbackTooltip *","div.ContentControlAcetateRootContainer","div.ContentControlAcetateRootContainer *","div.ClientPaginationPageAdornmentContainer","div.ClientPaginationPageAdornmentContainer *"]})}getRootNode(e){return this.getViewPanel(e.document||document)}createCaretPositioner(){return new n(this)}createParagraphIterator(){return new o(this)}createTextHighlighter(){return new t.MarkTextHighlighter}acceptNodeForMapping(e,t,n){const o=super.acceptNodeForMapping(e,t,n);if(e.nodeType!==Node.ELEMENT_NODE||o===NodeFilter.FILTER_REJECT)return o;const r=e;if(o===NodeFilter.FILTER_SKIP){if(r.matches("div.WordSectionBreakContainer")||r.matches("div.PageAdornmentContainer")||r.matches("div.ContentControlAcetateRootContainer"))return NodeFilter.FILTER_REJECT;if(r.matches("div.OutlineElement")&&r.querySelector("div.ParaWrappingDiv.HiddenParagraph"))return NodeFilter.FILTER_REJECT;if(r.matches("div.ClientPaginationPageAdornmentContainer"))return NodeFilter.FILTER_REJECT}if(n){const o=super.paragraphIterator;let i=o.nodeIsParagraph(e)?e:o.getParagraphForNode(e);if(!i&&r.matches("div.OutlineElement")&&(i=o.getClosestParagraph(r)),i){const e=t.document||document,r=o.getParagraphForNode(n);if(r!==i&&r.parentElement===this.getParagraphEditingElement(e)){const t=this.getHiddenParagraph(e);if(t&&i.compareDocumentPosition(t)&Node.DOCUMENT_POSITION_FOLLOWING)return NodeFilter.FILTER_REJECT}}}return o}getContentEditableForNode(e){if(!e)return null;let t=e.parentElement;for(;t;){if(t.getAttribute&&"true"===t.getAttribute("contenteditable"))return t;t=t.parentElement}return null}getParagraphEditingElement(e){return e.querySelector("div#WACViewPanel_EditingElement")}getViewPanel(e){return e.querySelector("div#WACViewPanel")}getHiddenParagraph(e){return e.querySelector("div.ParaWrappingDiv.HiddenParagraph")}}let i;let a;const s={active:!1,trueKeyMode:!1,state:0};let c,d,l,u,f,p;const m=/^(Digit|Numpad)([\d]{1})$/;let h,g,y,w=0;function v(){return s.active}function E(){return l||(l=document.querySelector("#WACViewPanel_EditingElement_WrappingDiv #WACViewPanel_EditingElement[contenteditable]")),l}function C(){const e=i.getContext();w+=1,h=e}function x(e){if(h){if(e)return w+=1,h={selection:{start:0,length:0},text:"",extended:{text:"",selection:{start:0,length:0}}},void(h.timestamp=Date.now());f&&(clearTimeout(f),f=void 0),p&&(clearTimeout(p),p=void 0),p=setTimeout(x,2e3,!0)}}function T(){const e={left:0,top:0,right:0,bottom:0},t=document.getSelection();let{focusNode:n}=t,o=!1;if(t.rangeCount>0){const n=t.getRangeAt(0).getClientRects();n.length>0&&(e.left=n[0].left,e.top=n[0].top,e.right=0,e.bottom=n[0].bottom-n[0].top,o=!0)}if(!o)if(t.focusOffset>0&&n.nodeType!==Node.TEXT_NODE){const o=n.childNodes[t.focusOffset-1];if(!o.getBoundingClientRect)return null;const r=o.getBoundingClientRect();e.left=r.right,e.top=r.top,e.right=0,e.bottom=r.bottom-r.top}else{if(!n)return null;{if(n.nodeType===Node.TEXT_NODE&&(n=n.parentElement),!n.getBoundingClientRect)return null;const t=document.defaultView.getComputedStyle(n,null),o=n.getBoundingClientRect(),r=parseFloat(t.getPropertyValue("padding-left")),i=parseFloat(t.getPropertyValue("padding-top")),a=parseFloat(t.getPropertyValue("font-size"));e.left=r+o.left,e.top=i+o.top,e.right=0,e.bottom=a+2}}return e.left+=window.pageXOffset,e.top+=window.pageYOffset,e.right=e.left+e.right,e.bottom=e.top+e.bottom,e}function N(){const e=T();e&&a.send("com.donjohnston.cwu.office365.word.cursor",void 0,e)}function P(e){C();const t={session:w,selection:h.selection,text:h.text,extended:h.extended};e?a.respond("com.donjohnston.cwu.office365.word.context",e,t):a.send("com.donjohnston.cwu.office365.word.context",void 0,t)}function k(){N(),P(void 0),f=void 0}function b(e){void 0===f&&(f=setTimeout(k,e||100))}function M(e){const t=Boolean(document.activeElement===E());u=void 0,e===t&&s.active&&(t?(a.send("com.donjohnston.cwu.office365.word.focus"),b(200)):(a.send("com.donjohnston.cwu.office365.word.blur"),x(void 0)))}function D(e){a.send(`com.donjohnston.cwu.office365.word.${e.type}`,void 0,{type:e.type,code:e.code,key:e.key,keyCode:e.keyCode,charCode:e.charCode,which:e.which,altKey:e.altKey,ctrlKey:e.ctrlKey,shiftKey:e.shiftKey,metaKey:e.metaKey,isComposing:e.isComposing,isTrusted:e.isTrusted,location:e.location,composed:e.composed,repeat:e.repeat,timeStamp:e.timeStamp})}function L(e){a.send("com.donjohnston.cwu.office365.word.event",void 0,{type:e.type,isTrusted:e.isTrusted})}function S(e){D(new KeyboardEvent("input",{key:e.text}))}function O(e){if(!v())return;const t=e instanceof KeyboardEvent;if(2===s.state)return L(e),void(t&&(e.preventDefault(),e.stopPropagation()));if(J(e),e.__isDjiSyntheticEvent||!t)return;if("Alt"===e.key||"Control"===e.key||"Shift"===e.key||"CapsLock"===e.key||"Meta"===e.key)return;let n=!1;"KeyN"===e.code?e.altKey&&!(e.ctrlKey||e.shiftKey||e.metaKey)&&(n=!0,a.send("com.donjohnston.cwu.office365.word.trueKeyMode",void 0)):!s.trueKeyMode&&m.test(e.code)?e.altKey||e.ctrlKey||e.shiftKey||e.metaKey||(n=!0,function(e){const t=Number.parseInt(e,10);Number.isNaN(t)||a.send("com.donjohnston.cwu.office365.word.digitKey",void 0,t)}(e.key)):(D(e),N()),n&&(e.preventDefault(),e.stopPropagation())}function A(e){if(!v())return;const t=e instanceof KeyboardEvent;2!==s.state?(J(e),!e.__isDjiSyntheticEvent&&t&&(function(e){if(!e)return!1;const t={};return!(!function(e,t){if(null==e||e.length<=0||!h)return!1;if(c.features&&!c.features.allowTogglePrediction)return!1;if(!Boolean(!c.features||c.features.allowTextProcessing))return!1;C();const n=Boolean(!c.features||c.features.allowAutoCapitalization);let o=h.selection.start,r=h.selection.length;const i=o+r,{text:a}=h;let s="",d=null,l=null,u=null,f=0;for(d=e.charAt(0),f=o-1;f>=0;f--)if(u=a.charAt(f)," "!==u){l=u;break}return!n||"\n"===d||"\r"===d||null!==l&&"."!==l&&"?"!==l&&"!"!==l&&";"!==l&&"\n"!==l&&"\r"!==l?("."===d||"?"===d||"!"===d||";"===l||","===d)&&(s=d,s+=" ",o=f+1,r=i-o,t.text=s,t.selection={start:o,end:o+r},!0):(s=d.toUpperCase(),t.text=s+e.substring(1),t.selection={start:o,end:o+r},!0)}(e,t)||e===t.text)&&(W(t,S),!0)}(String.fromCharCode(e.charCode))?(e.stopPropagation(),e.preventDefault()):D(e))):t&&(e.preventDefault(),e.stopPropagation())}function j(e){if(!v())return;if(0===s.state)return;const t=e instanceof KeyboardEvent;if(2===s.state)return L(e),void(t&&(e.preventDefault(),e.stopPropagation()));if(J(e),e.__isDjiSyntheticEvent||!t)return;if("Alt"===e.key||"Control"===e.key||"Shift"===e.key||"CapsLock"===e.key||"Meta"===e.key)return;let n=!1;"KeyN"===e.code?e.altKey&&!(e.ctrlKey||e.shiftKey||e.metaKey)&&(n=!0):!s.trueKeyMode&&m.test(e.code)&&(e.altKey||e.ctrlKey||e.shiftKey||e.metaKey||(n=!0)),n?(e.preventDefault(),e.stopPropagation()):b()}function F(e){v()&&(1===s.state?b(200):(e.preventDefault(),e.stopPropagation()),L(e))}function K(e){v()&&(1===s.state?b(200):(e.preventDefault(),e.stopPropagation()),L(e))}function R(e){v()&&(1===s.state?b(200):(e.preventDefault(),e.stopPropagation()))}function _(){if(s.active){if(1!==s.state)return;u&&(clearTimeout(u),u=void 0),u=setTimeout(M,100,!0)}}function I(e){if(s.active){if(1!==s.state)return;u&&(clearTimeout(u),u=void 0),u=setTimeout(M,50,!1)}}function W(t,n){1===s.state||J(null)?(s.state=2,function(t,n){if(E()!==document.activeElement||!h)return n({success:!1});const o=document.getSelection();if("Caret"!==o.type){const e=Math.max(0,h.custom.selectionOffset+t.selection.start);return n({success:!0,deleteForward:Boolean("Range"===o.type&&e>0)})}if(t.selection.start<t.selection.end)try{const e=Math.max(0,h.custom.selectionOffset+t.selection.start);let o=Math.min(h.custom.selectionOffset+t.selection.end,h.custom.map.length-1);for(let t=o;t>=e;t--){const n=h.custom.map[t];if(n.embeded)if(n.image||n.emoji)o=t;else if(n.eop){const n=t>e?h.custom.map[t-1].text:void 0;o=n&&160===n.charCodeAt(0)?t-1:t}}if(e<o||e!==h.extended.selection.start){const t=0===h.selection.length?e-h.extended.selection.start:0,r=Math.max(0,o-e);B(t,r,(e=>{let t=document.getSelection()?.focusNode,o=!1;for(let e=0;!o&&t&&e<3;e++){if(t.nodeType===Node.ELEMENT_NODE&&t.classList.contains("EOP")){o=!0;break}t=t.parentElement}if(!o)return n({success:!0,deleteForward:r>0});B(0,-1,(e=>{n({success:!0,deleteForward:r>0})}))}))}else n({success:!0,deleteForward:!1})}catch(t){return e.Logger.error(o,t),n({success:!1})}else n({success:!0,deleteForward:!1})}(t,(e=>{if(!e.success)return s.state=1,b(),void(n instanceof Function&&n(t));!function(e,t){e?setTimeout(V,10,t):t()}(e.deleteForward,(()=>{setTimeout((()=>{!function(e,t){e&&e.length>0&&v()&&E()===document.activeElement?q("text",e,t):t()}(t.text,(()=>{b(0),s.state=1,n instanceof Function&&n(t)}))}),10)}))}))):n instanceof Function&&n(t)}function V(e){q("deleteForward",{repeats:1},e)}function B(e,t,n){const o=[];e<0?o.push({type:"keydown",key:"ArrowLeft",keyCode:37,repeats:Math.abs(e)},{type:"keyup",key:"ArrowLeft",keyCode:37}):e>0&&o.push({type:"keydown",key:"ArrowRight",keyCode:39,repeats:Math.abs(e)},{type:"keyup",key:"ArrowRight",keyCode:39}),t<0?o.push({type:"keydown",key:"Shift",keyCode:16,shiftKey:!0},{type:"keydown",key:"ArrowLeft",keyCode:37,shiftKey:!0,repeats:Math.abs(t)},{type:"keyup",key:"ArrowLeft",keyCode:37},{type:"keyup",key:"Shift",keyCode:16,shiftKey:!1}):t>0&&o.push({type:"keydown",key:"Shift",keyCode:16,shiftKey:!0},{type:"keydown",key:"ArrowRight",keyCode:39,shiftKey:!0,repeats:Math.abs(t)},{type:"keyup",key:"ArrowRight",keyCode:39},{type:"keyup",key:"Shift",keyCode:16,shiftKey:!1}),q("keyboardEvents",o,n)}function q(t,n,o){if(o&&"function"!=typeof o)throw new Error("Callback is not a function!");const r=q.session=(q.session||0)+1,i=o?`com.donjohnston.cwu.dispatch.session.${r}`:void 0,a=document.documentElement,s=new CustomEvent("com.donjohnston.cwu.dispatch",{detail:{command:t,params:n,callbackMessage:i,userData:r}});let c;o&&(c=function(t){t.preventDefault(),t.stopPropagation();try{a.removeEventListener(i,c,!0)}catch(t){e.Logger.error(t)}try{o(t.detail.params)}catch(t){e.Logger.error(t)}},a.addEventListener(i,c,!0));try{a.dispatchEvent(s)}catch(t){e.Logger.error(t),o&&a.removeEventListener(i,c,!0)}}function U(t,n,o){const r=function(t,n,o){const r=t.getSelection();if(r.rangeCount<=0)return{selection:{start:0,length:0},text:"",map:[]};const i=r.getRangeAt(0),a={selection:{start:0,length:0,offset:0},text:"",map:[],params:{startContainer:i.startContainer,startOffset:i.startOffset,endContainer:i.endContainer,endOffset:i.endOffset,selection:r,range:i,prevNode:null,stop:!1}};1===a.params.startContainer.nodeType&&a.params.startOffset>0&&(a.params.startContainer=a.params.startContainer.childNodes[a.params.startOffset-1]),1===a.params.endContainer.nodeType&&a.params.endOffset>0&&(a.params.endContainer=a.params.endContainer.childNodes[a.params.endOffset-1]),H(n,a);const s={selection:a.selection,text:e.Utils.htmlToUnicode(a.text),map:a.map};return s.selection.length=s.selection.length-s.selection.start,s}(t,n),i={selection:r.selection,text:r.text,custom:{map:r.map,selectionOffset:0},extended:{text:r.text,selection:{start:r.selection.start,length:r.selection.length},custom:{}}};if(i.text.length>0){let t=i.text.lastIndexOf("\n",i.selection.start-1),n=i.text.indexOf("\n",i.selection.start+i.selection.length);const o=Math.max(0,i.selection.start-160),r=Math.min(i.text.length,i.selection.start+i.selection.length+32);for(t=Math.max(t,i.selection.start-128);t>=o&&!e.CharSet.whiteSpace.characterIsMember(i.text.charAt(t));t--);for(t++,n=Math.min(i.text.length,Math.max(n,i.selection.start+i.selection.length+10));n<r&&!e.CharSet.whiteSpace.characterIsMember(i.text.charAt(n));n++);i.text=t<n?i.text.slice(t,n):"",i.selection.start-=t,i.custom.selectionOffset=t,t=Math.max(0,i.text.lastIndexOf("\n",t-1)),n-t<i.text.length&&(i.extended.selection.start-=t,i.extended.custom.selectionOffset=t,i.extended.text=i.extended.text.slice(t,n))}return i}function H(e,t,n){const o=e.childNodes;for(let n=0;!t.params.stop&&n<o.length;n++){const r=o[n],{tagName:i}=r,{nodeType:a}=r;if("STYLE"!==i&&"SCRIPT"!==i)if("SPAN"===i&&r.classList.contains("EOP"))t.map.push({element:r,offset:0,text:" ",embeded:!0,eop:!0});else{if(null!==t.params.prevNode&&(X(i)||a===Node.TEXT_NODE&&X(t.params.prevNode.tagName))&&(t.text+="\n",t.map.push({element:t.params.prevNode,offset:t.params.prevNode.childNodes.length,text:"\n",embeded:!0}),null!=t.params.startContainer&&(t.selection.start+=1),null!=t.params.endContainer&&(t.selection.length+=1)),t.params.startContainer&&t.params.startContainer===r||t.params.endContainer&&t.params.endContainer===r){const o=a===Node.TEXT_NODE?r.textContent:" ",i=a===Node.TEXT_NODE?t.params.startOffset:1,s=a===Node.TEXT_NODE?t.params.endOffset:1;g.selectNode(r);const c=g.getBoundingClientRect();if(a===Node.TEXT_NODE)for(let e=0;e<o.length;e++){const n=o.charCodeAt(e)>32767,i={element:r,offset:e,text:o.charAt(e),embeded:n,bcr:c,emoji:void 0};n&&(i.emoji=!0),t.map.push(i)}else t.map.push({element:e,offset:n+1,text:" ",embeded:!0});t.text+=o,t.params.startContainer===r&&(t.selection.start+=i,t.params.startContainer=null,t.selection.offset=t.map.length-(o.length-i)),t.params.endContainer===r?(t.selection.length+=s,t.params.endContainer=null):t.params.endContainer&&(t.selection.length+=o.length)}else if(a===Node.TEXT_NODE){const{textContent:e}=r;t.text+=e,g.selectNode(r);const n=g.getBoundingClientRect();for(let o=0;o<e.length;o++){const i=e.charCodeAt(o)>32767,a={element:r,offset:o,text:e.charAt(o),embeded:i,bcr:n,emoji:void 0};i&&(a.emoji=!0),t.map.push(a)}null!=t.params.startContainer&&(t.selection.start+=e.length),null!=t.params.endContainer&&(t.selection.length+=e.length)}else a===Node.ELEMENT_NODE&&("IMG"===i?(t.text+=" ",t.map.push({element:e,offset:n+1,text:" ",embeded:!0,image:!0}),null!=t.params.startContainer&&(t.selection.start+=1),null!=t.params.endContainer&&(t.selection.length+=1)):H(r,t));t.params.prevNode=r}}}function X(e){return"P"===e||"DIV"===e||"LI"===e||"TD"===e}function J(e){return!(e&&!e.isTrusted||3!==s.state||!window.dji.frameManager||"function"!=typeof window.dji.frameManager.resetHighlighterAsync||(window.dji.frameManager.resetHighlighter(y),s.state=1,0))}e.Utils.registerService("ms-office-word-editor","cwe-word-proxy",!0,(e=>{if(e.success){if(g=document.createRange(),!document.getElementById("dji-office365-word-dispatcher")){const e=document.createElement("script");e.setAttribute("id","dji-office365-word-dispatcher"),e.async=!0,e.src=chrome.extension.getURL("libs/cwe-event-dispatcher.js"),document.documentElement.insertBefore(e,document.documentElement.firstElementChild)}a=e.messageProxy,a.on("com.donjohnston.cwu.office365.word.activate",((e,t)=>{if(s.active=t,function(){const e=E(),t=(d||(d=document.querySelector("#application #WACViewPanel")),d);v()?(e.addEventListener("focus",_,!0),e.addEventListener("blur",I,!0),e.addEventListener("keydown",O,!0),e.addEventListener("keypress",A,!0),e.addEventListener("keyup",j,!0),e.addEventListener("mousedown",F,!0),e.addEventListener("mouseup",K,!0),e.addEventListener("paste",R,!0),t.addEventListener("mousedown",F,!0),t.addEventListener("mouseup",K,!0)):(e.removeEventListener("focus",_,!0),e.removeEventListener("blur",I,!0),e.removeEventListener("keydown",O,!0),e.removeEventListener("keypress",A,!0),e.removeEventListener("keyup",j,!0),e.removeEventListener("mousedown",F,!0),e.removeEventListener("mouseup",K,!0),e.removeEventListener("paste",R,!0),t.removeEventListener("mousedown",F,!0),t.removeEventListener("mouseup",K,!0))}(),s.active){const e=T();a.send("com.donjohnston.cwu.office365.word.cursor",void 0,e),a.send("com.donjohnston.cwu.office365.word.ready"),P(void 0),E()===document.activeElement&&a.send("com.donjohnston.cwu.office365.word.focus")}else a.send("com.donjohnston.cwu.office365.word.blur")})),a.on("com.donjohnston.cwu.office365.word.trueKeyMode",((e,t)=>{s.trueKeyMode=t})),a.on("com.donjohnston.cwu.office365.word.highlightMode",((e,t,n)=>{if(y=t,s.state=n?3:1,!n){const e=T();a.send("com.donjohnston.cwu.office365.word.cursor",void 0,e),P(void 0)}})),a.on("com.donjohnston.cwu.office365.word.options",((e,t)=>{c=t})),a.on("com.donjohnston.cwu.office365.word.text",((e,t)=>{const n="selection"===t?E()===document.activeElement?document.getSelection().toString():null:function(){let e="";const t=document.querySelectorAll("#application .WACDocumentPanel #WACDocumentPanelContent #WACViewPanelContainer #WACViewPanel #PageContentContainer .PageContent .OutlineElement .ParaWrappingDiv");for(let n=0;n<t.length;n++){const o=t[n].querySelectorAll(".TextRun:not(.EmptyTextRun)");for(let t=0;t<o.length;t++)e+=o[t].textContent;e+="\n"}return e}();a.respond("com.donjohnston.cwu.office365.word.text",e,n)})),a.on("com.donjohnston.cwu.office365.word.cursor",N),a.on("com.donjohnston.cwu.office365.word.context",(e=>{P(e)})),a.on("com.donjohnston.cwu.office365.word.replaceText",((e,t)=>{t.session===w&&h?W(t,(()=>a.respond("com.donjohnston.cwu.office365.word.replaceText",e,t))):a.respond("com.donjohnston.cwu.office365.word.replaceText",e,null)})),a.enable(!0),a.ping(),s.state=1}})),i={getContext:function(){let e;try{const t=E();e=U(document,t)}catch(t){e={selection:{start:0,length:0},text:"",extended:{text:"",selection:{start:0,length:0}}}}return e.timestamp=Date.now(),e},extendSelection:function(t,n,o,r){return function(t,n){const o=document.getSelection(),r=t.count||1;return e.Utils.extendSelection(o,t.direction,t.granularity,r),n(!0)}({direction:t,granularity:n,count:o},r)},clearSelection:function(t){!function(t){const n=document.getSelection();n&&"None"!==n.type&&n.collapseToEnd();const o={repeats:1};!function(e,t){q("moveBackward",{repeats:e.repeats},(()=>{b(),s.state=1,t instanceof Function&&t()}))}(o,(()=>{!function(e,t){q("moveForward",{repeats:e.repeats},(()=>{b(),s.state=1,t instanceof Function&&t()}))}(o,(()=>{e.Utils.callMethod(t)}))}))}(t)},getTextMapperDelegate:function(){return new r}};var $=i;class Y extends t.TextMapperDelegateFactory{doCreateDelegate(t=null){return t&&e.Utils.isOcrRewordifyPopupElement(t)?null:e.Utils.isMicrosoftOffice()?new r:null}}window.cwe=window.cwe||{},async function(){e.Logger.warn(`DJI Office365 Word Proxy loading into: ${window.location}`),window.cwe.msWordProxy=$,t.TextMapperDelegateFactory.registerFactory(new Y),e.Logger.warn(`DJI Office365 Word Proxy loaded into: ${window.location}`)}()}));
