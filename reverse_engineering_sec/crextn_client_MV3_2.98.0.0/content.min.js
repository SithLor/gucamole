window.lastResponse=null,window.youtubeLastCheck=null;var lastVideoUrl="",lastVideoNextUrl="",lastChannelUrl="",port=chrome.runtime.connect({name:"yt"}),haveFetchResponse=!1,youtubeData={};function onWindowLoad(){if(haveFetchResponse)return void(haveFetchResponse=!1);window.onscroll=function(){onWindowScroll()},window.youtubeLastCheck=null,sendOptionsRequest();let e=document.documentElement.innerHTML.indexOf("ytp-embed")>=0;if(e){let t=null,n=null,o=/\/watch\?v=([a-zA-Z0-9-_]{1,})">/,a=document.documentElement.innerHTML.match(o);null!==a&&2==a.length&&(t=a[1]);let d=/\/channel\/([a-zA-Z0-9-_]{1,})"/;null!==(a=document.documentElement.innerHTML.match(d))&&2==a.length&&(n=a[1]);let l={channelId:n,videoId:t,category:null,embedded:e};if(null!=l.channelId||null!=l.videoId)return sendData(l),!0}if(-1==document.documentElement.innerHTML.indexOf('window["ytInitialPlayerResponse"] = null')){sendData(fetchPageInfo(!0,document.documentElement.innerHTML))}if(document.documentElement.innerHTML.indexOf('itemprop="channelId"')>-1){sendData(fetchPageInfo(!1))}}function titleObserver(){var e=document.title.toString(),t=document.querySelector("title");(new MutationObserver(function(t){t.some(function(t){var n=t.target.textContent.toString();if((n=(n=n.replace(/^\([0-9]{0,}\)\s/,"")).replace(/ +/g," "))!=e)return e=n,-1==document.URL.indexOf("results?search_query")&&setTimeout(onWindowLoad,2e3),!0})}).observe(t,{subtree:!0,characterData:!0,childList:!0}),null!=document.querySelector("ytd-browse"))&&(window.ytdBrowse=document.querySelector("ytd-browse"),window.lastUpdateBrowse=null,new MutationObserver(function(e){e.some(function(){if(null==window.lastUpdateBrowse||Math.floor(Date.now()/1e3)-window.lastUpdateBrowse>5){return window.lastUpdateBrowse=Math.floor(Date.now()/1e3),sendData(fetchPageInfo(!1)),processActions(window.lastResponse),!0}})}).observe(ytdBrowse,{subtree:!0,characterData:!0,childList:!0}))}function fetchPageInfo(e,t=""){if(e&&t.indexOf("var ytInitialPlayerResponse = ")>-1){let e=t.indexOf("var ytInitialPlayerResponse = ")+30;var n=null,o=null,a=null;let d=t.indexOf("ytp-embed")>=0;try{let d=JSON.parse(t.substring(e,t.indexOf("};",e)+1));n=d.videoDetails.channelId,o=d.videoDetails.videoId,a=d.microformat.playerMicroformatRenderer.category}catch(e){}return{channelId:n,videoId:o,category:a,embedded:d}}if(!1===e&&null!=document.querySelector("meta[itemprop='channelId']")){return{channelId:document.querySelector("meta[itemprop='channelId']").getAttribute("content"),videoId:null,category:null,embedded:t.indexOf("ytp-embed")>=0}}}function sendData(e,t="getSourceYoutube"){void 0!=e&&("getSourceYoutube"===t?port.postMessage({action:t,channelId:"undefined"!=e.channelId?e.channelId:null,videoId:"undefined"!=e.videoId?e.videoId:null,category:"undefined"!=e.category?e.category:null,embedded:e.embedded}):port.postMessage({action:t,data:e}))}function sendOptionsRequest(){port.postMessage({action:"getYoutubeOptions"})}function processActions(e){window.lastResponse!=e&&(window.lastResponse=e),e&&e.hasOwnProperty("hideComments")&&e.hideComments&&hideComment(),e&&e.hasOwnProperty("hideThumbnails")&&e.hideThumbnails&&hideThumbnails(),e&&e.hasOwnProperty("hideSidebar")&&e.hideSidebar&&hideSidebar(),e&&e.hasOwnProperty("hideRecommended")&&e.hideRecommended&&hideRecommended(),e&&e.hasOwnProperty("action")&&void 0!==e.action&&"deny"===e.action&&(self.location=e.url)}function hideComment(){null!==document.querySelector("ytd-comments")&&document.querySelector("ytd-comments").remove()}function hideThumbnails(){[...document.querySelectorAll("ytd-thumbnail")].forEach(e=>{e.remove()}),[...document.querySelectorAll("ytd-playlist-thumbnail")].forEach(e=>{e.remove()})}function hideSidebar(){null!==document.querySelector("div[id='related']")&&document.querySelector("div[id='related']").remove()}function hideRecommended(){}function onWindowScroll(){processActions(window.lastResponse)}function callWindowLoadWithTimeOut(){setTimeout(onWindowLoad,2e3)}port.onMessage.addListener(function(e){processActions(e)}),window.addEventListener("message",function(e){if(sendOptionsRequest(),"https://www.youtube.com"===e.origin||"https://youtube.com"===e.origin||"https://www.youtube-nocookie.com"===e.origin||"https://youtube-nocookie.com"===e.origin)if(e.data.type&&"YOUTUBE_PLAYER_CALL"==e.data.type&&lastVideoUrl!==location.href)lastVideoUrl=location.href,"undefined"!=(youtubeData={responsebody:e.data.payload.responsebody,url:e.data.payload.url}).customChannelName&&youtubeData.customChannelName&&sendData(youtubeData,"getYoutubeJson"),haveFetchResponse=!0;else if(e.data.type&&"YOUTUBE_NEXT_CALL"==e.data.type&&lastVideoNextUrl!==location.href){lastVideoNextUrl=location.href;var t=JSON.parse(e.data.payload.responsebody);if(Object.keys(t.contents.twoColumnWatchNextResults.results.results.contents).length>1){let e=t.contents.twoColumnWatchNextResults.results.results.contents[1].videoSecondaryInfoRenderer.owner.videoOwnerRenderer.navigationEndpoint.browseEndpoint.canonicalBaseUrl;if("undefined"!=e){let t=/^((http[s]?):\/)?\/?([^:\/\s]+)((\/\w+)*\/)/i;youtubeData.customChannelName=e.replace(t,""),youtubeData.responsebody&&youtubeData.url&&sendData(youtubeData,"getYoutubeJson"),haveFetchResponse=!0}}}else if(e.data.type&&"YOUTUBE_BROWSE_CALL"==e.data.type&&lastChannelUrl!==location.href&&(location.href.indexOf("/c/")>-1||location.href.indexOf("/channel/")>-1)){if(lastChannelUrl=location.href,(t=JSON.parse(e.data.payload.responsebody)).context&&t.context.client){let n=t.context.client.mainAppWebInfo.graftUrl;if("undefined"!=n){let t=/^((http[s]?):\/)?\/?([^:\/\s]+)((\/\w+)*\/)/i;sendData(youtubeData={responsebody:e.data.payload.responsebody,url:e.data.payload.url,customChannelName:n[0].replace(t,"")},"getYoutubeJson"),haveFetchResponse=!0}}else if(t.metadata&&t.metadata.channelMetadataRenderer){let n=t.metadata.channelMetadataRenderer.ownerUrls;if("undefined"!=n){let t=/^((http[s]?):\/)?\/?([^:\/\s]+)((\/\w+)*\/)/i;sendData(youtubeData={responsebody:e.data.payload.responsebody,url:e.data.payload.url,customChannelName:n[0].replace(t,"")},"getYoutubeJson"),haveFetchResponse=!0}}}},!1),window.addEventListener?window.addEventListener("load",callWindowLoadWithTimeOut,!1):window.attachEvent&&window.attachEvent("onload",callWindowLoadWithTimeOut);