/*!************************************************************************
 **
 ** Copyright (c) 2022-2023 Don Johnston, Inc. All rights reserved.
 **
 **************************************************************************/
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("core-lib-text-mapper"),require("core-lib-utils")):"function"==typeof define&&define.amd?define(["exports","core-lib-text-mapper","core-lib-utils"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).GoogleDocsApiDjiWrapper={},e.__DjiTextMapper,e.__DjiCoreLibUtils)}(this,(function(e,t,n){"use strict";class r{static findCaretPosition(e){const n=e.document.querySelector("div#kix-current-user-cursor-caret");if(!n)return null;const o=n.getBoundingClientRect();if(0===o.width||0===o.height){const t=e.document.getSelection();if("none"===t.type)return null;if(null===t.focusNode||void 0===t.focusNode)return null;const n=new Range;return n.setStart(t.focusNode,t.focusOffset),n.setEnd(t.focusNode,t.focusOffset),{offsetNode:t.focusNode,offset:t.focusOffset,bcr:n.getBoundingClientRect()}}const s=o.left+o.width/2,i=o.top+o.height/2,a=r.getCaretPositionFromPoint(e,s,i);return a?(a.bcr=o,a.normalized||t.DocumentTextMapperUtils.normalizeCaretPositionInfo(a),a):null}static elementFromPoint(e,t,n){let r=null;const o=window.dji.gdocsCanvasProjectionTagName||"dji-canvas";let s=e.querySelector(o);s&&(s.style.pointerEvents="");const i=e.elementsFromPoint(t,n);if(s&&(s.style.pointerEvents="none"),s=i.find((e=>e.matches(o))),s){let e=!0;for(r=s.shadowRoot.getElementById("dji-canvas-annotations");e&&r;){e=!1;for(let o=0;o<r.children.length;o+=1){const s=r.children[o],i=s.getBoundingClientRect();if(i.left<=t&&t<=i.right&&i.top<=n&&n<=i.bottom){r=s,e=!0;break}}}}else r=i.find((e=>!e.matches(".kix-cursor")&&!e.matches(".kix-cursor-caret")&&!e.matches(".kix-spell-bubble-suggestion-text")&&e.closest(".kix-page")));return r}static paragraphFromPoint(e,t,n){const o=r.elementFromPoint(e,t,n);if(!o)return o;let s=null;if(o.classList.contains("dji-canvas-content")){const e=new DOMRect(t,n,1,1),i=e.left+e.width/2,a=e.top+e.height/2;s=r.getProximityParagraph(o,i,a)}else{if(!o.matches||!o.matches("div.dji-canvas-para"))return o;s=o}return s||o}static getCaretPositionFromPoint(e,n,o){const s=r.elementFromPoint(e.document,n,o);if(!s)return null;let i={offsetNode:s,offset:0,bcr:new DOMRect(n,o,0,1)};return i.offsetNode&&(i.offsetNode.classList.contains("dji-canvas-content")?i=r.getCaretPositionFromCanvasContent(i.offsetNode,i.bcr):i.offsetNode.matches&&i.offsetNode.matches("div.dji-canvas-para")?i=r.getCaretPositionFromCanvasParagraph(i.offsetNode,i.bcr):(i.offsetNode.classList.contains("dji-canvas-word")&&i.offsetNode.firstChild&&(i.offsetNode=i.offsetNode.firstChild),t.DocumentTextMapperUtils.normalizeCaretPositionInfo(i))),i.offsetNode?i:null}static getProximityParagraph(e,t,n){let r=Number.MAX_SAFE_INTEGER,o=Number.MAX_SAFE_INTEGER,s=Number.MAX_SAFE_INTEGER,i=null,a=null;const l=e.querySelectorAll("div.dji-canvas-para"),c=l.length;for(let e=0;e<c;e+=1){const c=l[e],u=c.getBoundingClientRect(),d=n>u.top&&n<u.bottom?0:Math.min(Math.abs(u.top-n),Math.abs(u.bottom-n));if(d<=r){r=d;const e=t>u.left&&t<u.right?0:Math.min(Math.abs(u.left-t),Math.abs(u.right-t));if(0===d){if(0===e){i=c,a=null;break}s>e&&(s=e,a=c)}e<o&&(o=e,i=c)}}return a&&(i=a),i}static getProximityNodeInCanvasParaRect(e,t){const n={offsetNode:null,offset:-1,bcr:null};let r=Number.MAX_SAFE_INTEGER,o=null,s=Number.MAX_SAFE_INTEGER,i=null;const a=e.querySelectorAll("span.dji-canvas-word"),l=a.length;for(let e=0;e<l;e+=1){const l=a[e],c=l.getBoundingClientRect();if(!(t.top>c.bottom||t.bottom<c.top)){if(t.x>=c.left&&t.x<=c.right)return n.offsetNode=l.firstChild,n.offset=0,n;const e=Math.min(Math.abs(t.x-c.left),Math.abs(t.x-c.right));e<r&&(r=e,o=l.firstChild)}const u=Math.min(Math.abs(t.top-c.top),Math.abs(t.bottom-c.bottom));u<s&&(s=u,i=l.firstChild)}return o?n.offsetNode=o:i&&(n.offsetNode=i),n}static getProximityNodeInCanvasParagraph(e,t,n,o=1,s=1){return r.getProximityNodeInCanvasParaRect(e,new DOMRectReadOnly(t,n,o,s))}static getTrailingWhitespaceCountForProximityNode(e,t){const n=function(e){let t=(e.dataset||e.parentElement.dataset).spacewidth;return"string"==typeof t&&(t=Number.parseFloat(t)),"number"!=typeof t?null:t}(e);if(!n)return 0;const r=document.createRange();r.selectNodeContents(e);const o=t-r.getBoundingClientRect().right,s=Math.trunc(o/n+.4);return o>0?Math.max(s,0):0}static getTrailingWhitespaceCountForNode(e,t,n){const o=e.nodeType===Node.TEXT_NODE?e.parentElement:e,s=r.getProximityParagraph(o.closest("div.dji-canvas-content"),t,n),i=o.closest("div.dji-canvas-para");return s!==i||r.getProximityNodeInCanvasParagraph(i,t,n).offsetNode!==e?0:r.getTrailingWhitespaceCountForProximityNode(e,t)}static getCaretPositionFromCanvasContent(e,t){const n=t.left+t.width/4,o=t.top+t.height/4,s=r.getProximityParagraph(e,n,o);return s?r.getCaretPositionFromCanvasParagraph(s,t):{offsetNode:null,offset:-1,bcr:null}}static getCaretPositionFromCanvasParagraph(e,t){const n=r.getProximityNodeInCanvasParagraph(e,t.left,t.top,1,t.height);if(!n.offsetNode)return n;const o=r.getTrailingWhitespaceCountForProximityNode(n.offsetNode,t.left);return n.offset=n.offsetNode.textContent.length+o,n}}class o extends t.CaretPositioner{getCaretPosition(e){e.canvasAnnoTagName=super.delegate.mCanvasAnnoTagName;const t=r.findCaretPosition(e);return{anchorNode:t?t.offsetNode:null,anchorOffset:t?t.offset:-1}}getCaretPositionFromPoint(e,t,n){return r.getCaretPositionFromPoint({document:n,canvasAnnoTagName:this.delegate.mCanvasAnnoTagName},e,t)||super.getCaretPositionFromPoint(e,t,n)}onMoveCaret(e,t){super.onMoveCaret(e,t);const r=e.ownerDocument;let o=r.querySelector("div#kix-current-user-cursor-caret");if(!o)return;o=o.parentElement;const s=o.offsetParent?o.offsetParent:r.querySelector("div.kix-appview-editor");if(s)try{const n=r.createRange();n.setStart(e,t),n.setEnd(e,t);const o=n.getBoundingClientRect(),i=o.left,a=o.top+4,l={bubbles:!0,cancelable:!0,view:window,clientX:i,clientY:a},c=new MouseEvent("mousedown",l),u=new MouseEvent("mouseup",l);s.dispatchEvent(c),s.dispatchEvent(u)}catch(e){n.Logger.error(e)}}getCursorBoundingClientRect(e){const t=e.document.querySelector("div#kix-current-user-cursor-caret");return t?t.getBoundingClientRect():null}}function s(e,t){if(e.nextSibling)return e.nextSibling;if(e.nextElementSibling)return e.nextElementSibling;let n=e.parentElement;for(;n&&n!==t;){if(n.nextElementSibling)return n.nextElementSibling;n=n.parentElement}return null}class i extends t.ParagraphIterator{constructor(){super(""),this.m_paragraphDivMatch="div.kix-paragraphrenderer",this.m_canvasModeParaDivMatch="div.dji-canvas-para"}getParagraphForNode(e){if(!e)return null;const t=e.nodeType===Node.ELEMENT_NODE?e:e.parentElement;return t.closest(this.m_paragraphDivMatch)||t.closest(this.m_canvasModeParaDivMatch)}getNextParagraphForNode(e,t=!1){const n=this.getParagraphForNode(e);if(!n)return null;const r=t?n.previousElementSibling:n.nextElementSibling;return r&&this.nodeIsParagraph(r)?r:null}nodeIsParagraph(e){return Boolean(e&&e.matches&&(e.matches(this.m_paragraphDivMatch)||e.matches(this.m_canvasModeParaDivMatch)))}nodeIsLastInParagraph(e){const t=this.getParagraphForNode(e);if(!t)return!1;let r=e.nodeValue;if(!r||0===r.length)return!1;if(0===n.Utils.normalizedText(r).length)return!1;let o=s(e,t);for(;o;)if(o.classList&&o.classList.contains("goog-inline-block"))o=s(o,t);else{if(this.nodeIsParagraph(o))return!0;if(this.getParagraphForNode(o)!==t)return!0;if(r=n.Utils.normalizedText(o.textContent),r.length>0)return!1;o=s(o,t)}return!0}}class a extends t.SelectionHandler{constructor(e){super(),this.m_delegate=e}getSelectionContext(e){const t=e.activeElemInfo||e,n={text:null,offset:-1},r=this.getSelectionArray(t);if(!(r&&r.length>0))return null;n.offset=0;const o=new Range;return r.forEach((e=>{try{if(e.anchorNode&&e.focusNode){const t=e.anchorNode.textContent.length,r=e.focusNode.textContent.length;if(t>0&&r>0){o.setStart(e.anchorNode,Math.max(0,Math.min(e.anchorOffset,t))),o.setEnd(e.focusNode,Math.max(0,Math.min(e.focusOffset,r)));const s=o.toString();s&&s.length>0&&(n.text?n.text=n.text.concat(" ",o.toString()):n.text=s)}}}catch(e){console.warn(e)}})),n}getSelection(e){const t=this.getSelectionArray(e);return t&&t.length>0?t[0]:null}getSelectionArray(e){const t=[];if(!e.element.matches("div.kix-appview-editor")&&!this.m_delegate.getRootNode(e).contains(e.element))return t.push(e.element.ownerDocument.getSelection()),t;const n=e.document.querySelectorAll("div.kix-canvas-tile-selection > svg"),r=n.length;for(let o=0;o<r;o+=1)n[o].querySelectorAll("rect").forEach((n=>{const r=n.getBoundingClientRect(),o=this.getRangeForRect(e,r);o&&a.isValidNodeForSelection(o.anchorNode)&&a.isValidNodeForSelection(o.focusNode)&&t.push({anchorNode:o.anchorNode,focusNode:o.focusNode,anchorOffset:o.anchorOffset,focusOffset:o.focusOffset})}));if(0===t.length){const n=this.m_delegate.caretPositioner.getCaretPosition(e);n&&t.push({anchorNode:n.anchorNode,focusNode:n.anchorNode,anchorOffset:n.anchorOffset,focusOffset:n.anchorOffset})}return t}getRangeForRect(e,t){const n={anchorNode:null,anchorOffset:-1,focusNode:null,focusOffset:-1},r=(t.top+t.bottom)/2;let o=this.m_delegate.caretPositioner.getCaretPositionFromPoint(t.left,r,e.document),s=2;for(;o&&!a.isValidNodeForSelection(o.offsetNode)&&s<8;){const n=t.top+(r-t.top)/s;o=this.m_delegate.caretPositioner.getCaretPositionFromPoint(t.left+s,n,e.document),s+=1}s=2;let i=this.m_delegate.caretPositioner.getCaretPositionFromPoint(t.right,r,e.document);for(;i&&!a.isValidNodeForSelection(i.offsetNode)&&s<8;){const n=t.top+(r-t.top)/s;i=this.m_delegate.caretPositioner.getCaretPositionFromPoint(t.right-s,n,e.document),s+=1}return o&&i&&a.isValidNodeForSelection(o.offsetNode)&&a.isValidNodeForSelection(i.offsetNode)&&(n.anchorNode=o.offsetNode,n.anchorOffset=o.offset,n.focusNode=i.offsetNode,n.focusOffset=i.offset),n}static isValidNodeForSelection(e){return!!e&&e.parentElement&&e.parentElement.matches("span.dji-canvas-word")}}class l extends t.SelectionTextHighlighter{getHighlightedBoundingClientRect(e,t){if(!(e&&e.activeElementInfo&&e.activeElementInfo.document))return null;const n=e.activeElementInfo.document.querySelector(e.activeElementInfo.canvasAnnoTagName)?.shadowRoot;if(!n)return null;const r=n.getSelection();return r&&"Range"===r.type?r.getRangeAt(0).getBoundingClientRect():null}}function c(e){const t=e.document||e.activeElemInfo?.document;if(!t)return null;const n=t.querySelector(e.canvasAnnoTagName);if(n&&n.shadowRoot){const e=n.shadowRoot.querySelector("div#dji-canvas-annotations");if(e)return e}return null}class u extends t.DocumentTextMapperDelegate{constructor(){super({type:"google.docs",markNodeValueSeparatorAsEmbedded:!0,isEditor:!0,clearSelectionAtEnd:!0}),this.mCanvasAnnoTagName=window.dji.gdocsCanvasProjectionTagName||"dji-canvas"}get isLayered(){return!0}get canvasAnnoTagName(){return this.mCanvasAnnoTagName}get updateInProgress(){const e=c({document:document,canvasAnnoTagName:this.mCanvasAnnoTagName});return!(!e||!e.hasAttribute("data-update-inprogress"))}get updatedAt(){const e=c({document:document,canvasAnnoTagName:this.mCanvasAnnoTagName}),t=e&&e.getAttribute("data-updated-at");return t&&parseInt(t,10)||void 0}getRootNode(e){e.canvasAnnoTagName=this.mCanvasAnnoTagName;const t=c(e);if(t)return t;const n=e.document.querySelector("div.kix-appview-editor");if(n){return n.querySelector("div.kix-paginateddocumentplugin")||n}return super.getRootNode(e)}createCaretPositioner(){return new o(this)}createParagraphIterator(){return new i}createSelectionHandler(){return new a(this)}createTextHighlighter(){return new l}getTextContentForNode(e,t=!0){const n=e.classList?e:e.parentElement;return n.classList.contains("goog-inline-block")?this.getTextContentForGoogInlineBlock(n):super.getTextContentForNode(e,t)}getValueForNode(e,t=!0){return e.nodeType!==Node.TEXT_NODE?super.getValueForNode(e,t):this.getTextContentForNode(e,t)}getValueSeparatorForNode(e){if((e.classList?e:e.parentElement).classList.contains("dji-canvas-word"))return this.getSeparatorForWordInCanvasLine(e);const t=this.paragraphIterator;if(t&&t.nodeIsLastInParagraph(e)){const r=t.getParagraphForNode(e).textContent;for(let e=r.length-1;e>=0;e-=1){const t=n.Utils.normalizedChar(r[e]);if(""!==t&&!n.CharSet.sentenceSeparator.characterIsMember(t)){if(n.CharSet.wordSeparator.characterIsMember(t)||n.CharSet.invisibleWhiteSpace.characterIsMember(t))continue;return"\n"}}}return super.getValueSeparatorForNode(e)}getTextContentForGoogInlineBlock(e){const t=e.textContent;if(1===t.length&&160===t.charCodeAt(0)){const n=e.parentElement.querySelectorAll("span.goog-inline-block");let r=0,o=Number.MAX_VALUE;const s=n.length;for(let e=0;e<s;e+=1){const t=n[e],s=t.textContent;if(1===s.length&&160===s.charCodeAt(0)){const e=Number.parseFloat(t.style.width);r=Math.max(r,e),o=Math.min(o,e)}}const i=Number.parseFloat(e.style.width),a=Math.abs(i-o)<=.001?1:Math.floor(Math.max(r/i,2));return a<=1?t:t[0].repeat(a)}return super.getTextContentForNode(e)}static containsY(e,t){return e.y<=t&&t<=e.y+e.height}static getClientRectForNode(e){const t=document.createRange();return t.selectNodeContents(e),t.getBoundingClientRect()}getSeparatorForWordInCanvasLine(e){let t=0;const n=e.nodeType===Node.TEXT_NODE?e:e.firstChild||e,o=this.caretPositioner.getCursorBoundingClientRect({document:e.ownerDocument});if(o){const s=u.getClientRectForNode(e),i=(o.top+o.bottom)/2;u.containsY(s,i)&&s.right<o.x&&(t=r.getTrailingWhitespaceCountForNode(n,(o.left+o.right)/2,(o.top+o.bottom)/2))}const s=e.nodeType===Node.TEXT_NODE?e.parentElement:e;if(null!==s.nextSibling){const e=s.nextSibling.nodeType===Node.TEXT_NODE?s.nextSibling:s.nextSibling.firstChild||s.nextSibling;if(e){const o=s.dataset.lineno,i=s.nextElementSibling;if(o!==(i.dataset?i.dataset.lineno:-1))t+=1;else{const o=u.getClientRectForNode(e);t+=r.getTrailingWhitespaceCountForProximityNode(n,o.left)}}}let i=t>0?String(" ").repeat(t):"";return null===s.nextSibling&&(i=i.concat("\n")),i}}const d={editorIdRegEx:/^(?:editor|speakernotes)(?:[-_](?!paragraph|bg|workspace)\w+)+$/,paragraphIdRegEx:/^(?:editor|speakernotes)(?:[-_](?!paragraph|bg|workspace)\w+)+(?:[-_]paragraph)(?:[-_]\w+)*$/,blinkCursorClassName:"docs-text-ui-cursor-blink",workspaceId:"workspace",slidesViewId:"slides-view",speakerNotesId:"speakernotes",selectionClass:"sketchy-text-selection-overlay"};class h extends t.CaretPositioner{mHook=null;constructor(e,t){super(e),this.mHook=t}getCaretPosition(e){this.mHook.resetCaretPosition();const t=this.mHook.getCaret();if(!t)return null;const n=(t.left+t.right)/2,r=(t.top+t.bottom)/2;return this.getCaretPositionFromPoint(n,r,e.document)}getCaretPositionFromPoint(e,t,r){const o=[],s=[];let i=null,a=null;try{do{if(i=n.Utils.caretPositionFromPoint(e,t,r),i.offsetNode===a){i.offsetNode=null,i.offset=-1;break}a=i.offsetNode,i.offsetNode&&null===i.offsetNode.nodeValue&&(o.push(i.offsetNode.getAttribute("visibility")),s.push(i.offsetNode),i.offsetNode.setAttribute("visibility","hidden"),i.offsetNode=null,i.offset=-1)}while(!i.offsetNode)}finally{const e=s.length;for(let t=0;t<e;t+=1)s[t].setAttribute("visibility",o[t])}return{offsetNode:i.offsetNode,offset:i.offset,anchorNode:i.offsetNode,anchorOffset:i.offset}}onMoveCaret(e,t){super.onMoveCaret(e,t);const r=e.ownerDocument,o=r.getElementsByClassName(d.blinkCursorClassName);if(null!==o&&0!==o.length)try{const s=r.createRange();s.setStart(e,t),s.setEnd(e,Math.min(t+1,e.textContent.length));const i=s.getBoundingClientRect(),a=n.Utils.computeCommonAncestor(e,o[0]);let l=null;const c=i.right;let u=i.top;if(a.hasAttribute("id")&&a.getAttribute("id")===d.slidesViewId){const e=r.getElementById(d.speakerNotesId);if(!e)return;if(l=e.querySelector("svg"),!l)return}else u=i.top+i.height/2,l=r.elementFromPoint(c,u);const h={bubbles:!0,cancelable:!0,clientX:c,clientY:u},g=new MouseEvent("mousedown",h),m=new MouseEvent("mouseup",h);window.requestIdleCallback((()=>{l.dispatchEvent(g),l.isConnected||(l=r.elementFromPoint(c,u)),l.dispatchEvent(m)}))}catch(e){n.Logger.error(e)}}}class g extends t.ParagraphIterator{constructor(){super("")}getParagraphForNode(e){return this.getParentForNode(e,d.paragraphIdRegEx)}getParentForNode(e,t){if(!e)return null;let n=e.nodeType===Node.ELEMENT_NODE?e:e.parentElement;for(;n;){if(n.hasAttribute("id")){const e=n.getAttribute("id");if(t.test(e))return n}n=n.parentElement}return null}nodeIsParagraph(e){const t=e.nodeType===Node.ELEMENT_NODE?e:null;return Boolean(t&&t.hasAttribute("id")&&d.paragraphIdRegEx.test(t.getAttribute("id")))}}class m extends t.SelectionHandler{mDelegate=null;constructor(e){super(),this.mDelegate=e}getSelection(e){if(!Boolean("IFRAME"===e.element.tagName.toUpperCase()&&e.element.classList.contains("docs-texteventtarget-iframe"))&&!this.mDelegate.getRootNode(e).contains(e.element))return e.element.ownerDocument.getSelection();const t=e.document.querySelectorAll(`rect.${d.selectionClass}`);if(!t||0===t.length)return e.element.ownerDocument.getSelection();const n={anchorNode:null,anchorOffset:0,focusNode:null,focusOffset:0},r=t[0],o=t[t.length-1];let s=r.getBoundingClientRect(),i=(s.top+s.bottom)/2;const a=this.mDelegate.caretPositioner.getCaretPositionFromPoint(s.left+5,i,e.document);if(!a)return n;r!==o&&(s=o.getBoundingClientRect(),i=(s.top+s.bottom)/2);const l=this.mDelegate.caretPositioner.getCaretPositionFromPoint(s.right,i,e.document);return l?(n.anchorNode=a.anchorNode,n.anchorOffset=a.anchorOffset,n.focusNode=l.anchorNode,n.focusOffset=l.anchorOffset,n):n}}class p extends t.DocumentTextMapperDelegate{mHook=null;constructor(e){super({type:"google.slides",markNodeValueSeparatorAsEmbedded:!1,isEditor:!0}),this.mHook=e}getRootNode(e){return e.document.querySelector("div#slides-view")||super.getRootNode(e)}acceptNodeForMapping(e,t,n){if(super.acceptNodeForMapping(e,t,n)===NodeFilter.FILTER_ACCEPT)return NodeFilter.FILTER_ACCEPT;if(e.nodeType===Node.ELEMENT_NODE){const n=e;if(n.matches("div[aria-hidden='true']")||n.matches("div.docs-ui-unprintable")||n.matches("div.docos-show-more")||n.matches("div.docos-show-less"))return NodeFilter.FILTER_REJECT;if(n.matches("div.sketchy-comment-anchor"))return"rewordify"===t.requestFor?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_SKIP;const{style:r}=n;return r&&"none"===r.getPropertyValue("display")?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_SKIP}return NodeFilter.FILTER_ACCEPT}createCaretPositioner(){return new h(this,this.mHook)}createParagraphIterator(){return new g}createSelectionHandler(){return new m(this)}getValueSeparatorForNode(e){return" "}getWorkspaceElement(){return document.getElementById(d.workspaceId)}}class f{static sSvgNamespaceUri=null;static elementIdMatchesRegExp(e,t){return null!==e&&e.hasAttribute("id")&&!0===t.test(e.getAttribute("id"))}static isEditor(e){return this.elementIdMatchesRegExp(e,d.editorIdRegEx)||this.isSpeakernotes(e)}static isParagraph(e){return this.elementIdMatchesRegExp(e,d.paragraphIdRegEx)}static isSpeakernotes(e){return e.hasAttribute("id")&&e.getAttribute("id")===d.speakerNotesId}static getCurrentPageElement(){const e=document.getElementById("pages");if(null===e)return null;const t=e.querySelectorAll("svg:not([style*='display: none;'])");return null===t||0===t.length?null:t[0]}static getParentEditor(e){let t=e.parentNode;for(;null!==t&&f.isElement(t);){if(this.isEditor(t)||this.isSpeakernotes(t))return t;if(t.hasAttribute("id")){const e=t.getAttribute("id");if("pages"===e||"filmstrip"===e)break}t=t.parentNode}return null}static svgNamespaceUri(){if(!f.sSvgNamespaceUri){const e=document.querySelector("svg");f.sSvgNamespaceUri=e?e.namespaceURI:null}return f.sSvgNamespaceUri}static isElement(e){return e&&e.nodeType===Node.ELEMENT_NODE}static isSVGElement(e){return e&&e.ownerSVGElement}}class E extends t.ParaLineGuideImpl{static sOverlayParaFilterId="dji-overlay-para-filter";static sOverlayLineFilterId="dji-overlay-line-filter";static sDefsElemId="dji-defs";setColors(e){}paragraphAtPoint(e,t,n){return E.ensureOverlayFilters(),E.getParagraphAtPoint(e,t,null)}lineAtPoint(e,t,n){return E.ensureOverlayFilters(),E.getLineAtPoint(e,t,null)}highlightParagraphAt(e,t,n){return!1}clearHighlights(e){return!1}static ensureOverlayFilters(){if(document.getElementById(E.sOverlayLineFilterId))return;const e=E.ensureDjiDefsElem(),t=E.createFilterElement("var(--dji-paracolor)",this.sOverlayParaFilterId,"",!1);e.appendChild(t);const n=E.createFilterElement("var(--dji-linecolor)",this.sOverlayLineFilterId,"",!0);e.appendChild(n)}static createFilterElement(e,t,n,r){const o=document.createElementNS(f.svgNamespaceUri(),"filter");o.setAttribute("id",t),o.setAttribute("x","-2%"),o.setAttribute("y",r?"-1%":"-2%"),o.setAttribute("width","104%"),o.setAttribute("height",r?"102%":"104%"),o.setAttribute("filterUnits","objectBoundingBox");const s=document.createElementNS(f.svgNamespaceUri(),"feFlood");s.setAttribute("id",n),s.setAttribute("flood-color",e),s.setAttribute("flood-opacity","1");const i=document.createElementNS(f.svgNamespaceUri(),"feComposite");return i.setAttribute("in","SourceGraphic"),o.appendChild(s),o.appendChild(i),o}static ensureDjiDefsElem(){const e=document.getElementById(E.sDefsElemId);if(e)return e;const t=document.createElementNS(f.svgNamespaceUri(),"defs");t.setAttribute("id",E.sDefsElemId);const n=document.createElementNS(f.svgNamespaceUri(),"svg");return n.setAttribute("id","dji-svg"),n.setAttribute("visibility","hidden"),n.appendChild(t),document.body.appendChild(n),t}static getParagraphAtPoint(e,t,n){let r=E.getParagraphAtPointFromEditor(e,t,n||E.getEditorAtPoint(e,t));if(r)return r;const o=E.getAllEditorsAtPoint(e,t);if(!o||0===o.length)return null;const s=o.length;for(let n=0;n<s;n+=1){const s=o[n];if(r=E.getParagraphAtPointFromEditor(e,t,s),r)return r}return null}static getLineAtPoint(e,t,n){const r=n||E.getParagraphAtPoint(e,t,null);if(!f.isSVGElement(r))return null;const o=r.ownerSVGElement.createSVGPoint();o.x=e,o.y=t;const s=r.getElementsByClassName("sketchy-text-content-text"),i=s.length;for(let e=0;e<i;e+=1){const t=s[e];if(this.elementContainsPoint(t,o))return t}return this.getProximityElement(s,o)}static getEditorAtPoint(e,t){const n=document.elementFromPoint(e,t);return n?f.getParentEditor(n):null}static getParagraphAtPointFromEditor(e,t,n){if(!n)return null;const r=n.ownerSVGElement?n.ownerSVGElement:n.querySelector("svg");if(!r)return null;const o=r.createSVGPoint();o.x=e,o.y=t;const s=n.querySelectorAll("g[id*='-paragraph-']"),i=s.length;for(let e=0;e<i;e+=1){const t=s[e];if(this.elementContainsPoint(t,o))return t}return this.getProximityElement(s,o)}static getAllEditorsAtPoint(e,t){const n=f.getCurrentPageElement();if(!n)return null;const r=[],o=n.querySelectorAll("g[id^='editor']"),s=o.length;for(let n=0;n<s;n+=1){const s=o[n];if(!f.isEditor(s))continue;const i=s.ownerSVGElement?s.ownerSVGElement:s.querySelector("svg");if(!i)continue;const a=i.createSVGPoint();a.x=e,a.y=t,E.elementContainsPoint(s,a)&&r.push(s)}return r}static elementContainsPoint(e,t){const r=E.mapPointToElement(t,e),o=e.getBBox();return n.DOMRectExtensions.contains(o,r.x,r.y)}static getProximityElement(e,t){let n=null,r=Number.MAX_SAFE_INTEGER;const o=e.length;for(let s=0;s<o;s+=1){const o=e[s],i=E.getVerticalVicinityAndHorizontalDisplacementOfElement(o,t);i.inVerticalVicinity&&r>i.horizontalDisplacement&&(n=o,r=i.horizontalDisplacement)}return n}static getVerticalVicinityAndHorizontalDisplacementOfElement(e,t){const n=E.mapPointToElement(t,e),r=e.getBBox();return{inVerticalVicinity:r.y<=n.y&&r.y+r.height>=n.y,horizontalDisplacement:Math.abs(r.x+r.width-n.x)}}static mapPointToElement(e,t){const n=t.getScreenCTM().inverse();return e.matrixTransform(n)}}class y{m_ime=null;m_mainObserver=null;m_svgObserver=null;m_currentEditorElement=null;m_currentParagraphElement=null;m_currentLineElement=null;m_currentTextElement=null;m_lastClickedSvgElement=null;m_cursorElement=null;m_cursorRect=null;m_installed=!1;m_dispatchingEvents=!1;m_lastState=null;m_mouseDownEventListener=e=>{this.onWorkspaceMouseDown(e)};m_mouseUpEditorListener=e=>{this.onWorkspaceMouseUp(e)};m_contentEditableOnFocusListener=e=>{this.onFocus(e)};m_contentEditableOnBlurListener=e=>{this.onBlur(e)};m_contentEditableOnKeyDownListener=e=>{this.onKeyDown(e)};m_contentEditableOnKeyUpListener=e=>{this.onKeyUp(e)};m_contentEditableOnKeyPressListener=e=>{this.onKeyPress(e)};m_caretEventTarget=null;m_windowProxy=null;constructor(e,t,n){this.m_ime=e,this.m_windowProxy=n,this.initialize(t)}install(){this.installMainObserver()}uninstall(){this.unistallMainObserver(),this.uninstallSvgListeners(),this.removeEventListenersForEditableContent(),this.uninstallSvgObserver(),this.m_installed=!1,this.resetCurrentElements(!0)}reload(){}getState(){const e=this.m_installed&&this.hasFocus();return{installed:this.m_installed,cursorRect:this.cursorRect(),selectionRects:this.currentSelection(),active:e,hook:e?this:null,editor:e?this.getContentEditableElement():null}}isInstalled(){return this.m_installed}resetCaretPosition(){this.m_cursorRect=null}getCaret(){const e=this.cursorRect();return null===e?null:{left:e.x,top:e.y,right:e.x+e.width,bottom:e.y+e.height}}setTrueKeyMode(){}getContext(e,t,r,o){this.resetCacheIfStatic();let s="",i=0,a=0,l=0,c=!1,u=this.currentTextElement();const d=this.currentParagraphElement();let h=!r&&(void 0===o||Boolean(!o)),g=!r;const m={},p=t?[f.getCurrentPageElement(),this.getSpeakerNotesElement()]:[this.currentEditorElement()],E=p.length;for(let e=0;e<E;e+=1){const t=p[e];if(t){const e=t.querySelectorAll("g[id*='-paragraph-']"),r=e.length;for(let t=0;t<r;t+=1){let r=e[t];if(f.isParagraph(r)){const e=r;if(h=h||r===d,!h)continue;let t=e.ownerSVGElement.createSVGPoint();const o=r.getElementsByClassName("sketchy-text-content-text"),p=o.length;for(let e=0;e<p;e+=1){const d=o[e],h=this.selectionRectForLine(d),p=d.querySelectorAll("text"),f=p.length;let E=!0;for(let e=0;e<f;e+=1){const o=p[e];if(g=g||o===u,!g)continue;E&&(E=!1,s.length>0&&(s+="\n",l+=1,m[s.length]="\n",c&&(a+=1))),0!==l&&" "!==s[s.length-1]&&(s+=" ",l+=1,c&&(a+=1));const d=o.textContent;if(s+=d,null!==h&&this.nodeIntersectsRect(o,h,null)){const e=o.getScreenCTM(),r=o.getNumberOfChars();for(let s=0;s<r;s+=1){const r=o.getExtentOfChar(s);t.x=r.x,t.y=r.y,t=t.matrixTransform(e),n.DOMRectExtensions.contains(h,t.x,t.y)?(a+=1,i=1===a?l:i,c=!0):c=!1,l+=1}}else{if(null===u&&(u=this.currentTextElement()),o===u){const e=this.cursorPosition();let t=0;if(null!==e){const n=o.getNumberOfChars();for(;t<n;t+=1){const n=this.mapRectToElement(o.getExtentOfChar(t),o,r);if(e.midLeft<n.x+n.width/2)break}}i=l+t,this.caretIsPastCurrentWord()&&(s+=" ",l+=1,i+=1)}l+=d.length,c=!1}}}}}}}return{selection:{start:i,length:a},text:s,custom:{embeddedLocations:m,caretIsPastCurrentWord:this.caretIsPastCurrentWord()},extended:{text:s,selection:{start:i,length:a}}}}getContextWithParams(e){if(this.resetCacheIfStatic(),Boolean(e&&e.fillMappings))return this.getContextWithMappings(e);const t=Boolean(e&&e.entireDocument),n=Boolean(e&&e.fromCaretToEnd);return t||n?this.getContext(null,t,n,!1):this.getContextFromSelection(Boolean(e&&e.completePartiallySelectedWords),!1)}getSelectionRects(){if(this.resetCacheIfStatic(),!this.hasSelection())return null;const e=this.currentEditorElement();if(!e)return null;const t=[],n=e.querySelectorAll("g[id*='-paragraph-']"),r=n.length;for(let e=0;e<r;e+=1){const r=n[e];if(f.isParagraph(r)){const e=r.getElementsByClassName("sketchy-text-content-text"),n=e.length;for(let r=0;r<n;r+=1){const n=e[r],o=this.selectionForLine(n);if(o){let e=o.getScreenCTM();e=e.translate(o.x.baseVal.value,o.y.baseVal.value);const n=e?new DOMMatrix([e.a,e.b,e.c,e.d,e.e,e.f]):null;t.push({rect:o.getBoundingClientRect(),bbox:o.getBBox(),matrix:n})}}}}return t}getSelectedText(){this.resetCacheIfStatic();const e=this.getContextFromSelection(!1,!1);return e?e.text.trim():""}clearSelection(){document.getSelection().empty()}getAllText(){let e="";const t=document.getElementById("pages");if(null===t)return e;const n=t.querySelectorAll("svg");if(null===n||0===n.length)return e;const r=n.length;for(let t=0;t<r;t+=1){const r=n[t];e+=this.getPageText(r),e+="\r\n"}return e}getCurrentPageText(){return this.getPageText(f.getCurrentPageElement())}getPageText(e){let t="";if(null===e)return t;const n=e.querySelectorAll("g[id*='-paragraph-']"),r=n.length;for(let e=0;e<r;e+=1){const r=n[e];f.isParagraph(r)&&(t+=this.getParagraphText(r),t+="\r\n")}return t}getContextForMomentaryTopic(e,t){t(this.getAllText())}async replaceText(e,t,r){if(this.m_dispatchingEvents)return void n.Logger.warn("Ignoring replaceText() request while dispatching! ",t);if(0===r.selection.length&&r.selection.start<t.selection.end)for(let e=t.selection.end;e>t.selection.start;e-=1)e in r.custom.embeddedLocations&&(t.selection.end=e-1);const o=void 0!==t.removeLeadingSpaces&&!!t.removeLeadingSpaces;o&&await this.removeLeadingSpacesAsync();const s=r.custom.caretIsPastCurrentWord?1:0;t.extended={rightKey:Math.max(0,0!==r.selection.length||o?0:t.selection.end-r.selection.start-s),backspaceKey:Math.max(0,0!==r.selection.length||o?0:t.selection.end-t.selection.start-s)},this.dispatchEvent("text",t)}async acquireTextForTopicAsync(e){let t=null;return"selection"===e?t=this.getSelectedText():"page"===e&&(t=this.getCurrentPageText()),t}shouldIgnoreMutations(){return!0}getActiveElement(){return this.getContentEditableElement()}resetCacheIfStatic(){this.m_ime||this.resetCurrentElements()}getContextWithMappingsFromCaretToEnd(){if(!this.cursorPosition())return null;const e=this.currentTextElement();if(!e)return null;const t=this.currentParagraphElement();return t?this.getContextWithMappingsFromStartingElements(e,t):null}getContextWithMappingsForEntireDocument(){if(!this.cursorPosition())return null;let e=this.currentEditorElement();if(!e)return null;const t=[e.previousElementSibling,e];for(e=e.nextElementSibling;e;)t.push(e),e=e.nextElementSibling;return t.push(this.getSpeakerNotesElement()),this.getContextWithMappingsForEditors(t)}getContextWithMappingsForCurrentEditor(){if(!this.cursorPosition())return null;const e=this.currentEditorElement();return e?this.getContextWithMappingsForEditors([e]):null}getContextWithMappingsForEditors(e){let t=[];const n=e.length;for(let r=0;r<n;r+=1){const n=e[r];if(!n)continue;const o=n.querySelectorAll("g[id*='-paragraph-']");0!==o.length&&(t=t.concat([...o]))}const r=[];let o="",s=0,i=0;const a=" ",l=this.currentTextElement(),c=t.length;for(let e=0;e<c;e+=1){const n=t[e];if(!f.isParagraph(n))continue;const c=n.querySelectorAll("text");let u=null;const d=c.length;for(let e=0;e<d;e+=1){const t=c[e];if(i=0,r.length>0&&o[o.length-1]!==a&&(this.updateMappings(a,i,!0,r,u||t),o+=a),t===l){const e=this.cursorOrSelection();let l=0;if(e){const r=this.consolidatedPositionForNode(e),o=t.getNumberOfChars();for(;l<o;l+=1){const e=this.mapRectToElement(t.getExtentOfChar(l),t,n);if(r.midLeft<e.x+e.width/2)break}}s=r.length+l,this.caretIsPastElement(t)&&(this.updateMappings(a,i,!0,r,t),o+=a,s+=1)}if(t.children&&t.children.length>0){const e=t.children.length;for(let n=0;n<e;n+=1){const e=t.children[n],s=this.updateMappingsFromNode(e,i,r);o+=s,i+=s.length}}else{const e=this.updateMappingsFromNode(t,i,r);o+=e,i+=e.length}u=t}}return{selection:{start:s,length:0},text:o,custom:{embeddedLocations:{},caretIsPastCurrentWord:this.caretIsPastCurrentWord(),map:r,selectionOffset:s},extended:{text:o,selection:{start:s,length:0}}}}getContextWithMappingsFromStartingElements(e,t){const n=[];let r="",o=0,s=0;const i=" ";let a=null===e,l=null===t;const c=[f.getCurrentPageElement(),this.getSpeakerNotesElement()],u=c.length;for(let d=0;d<u;d+=1){const u=c[d].querySelectorAll("g[id*='-paragraph-']"),h=u.length;for(let c=0;c<h;c+=1){const d=u[c];if(!f.isParagraph(d))continue;if(l=l||d===t,!l)continue;const h=d.querySelectorAll("text"),g=h.length;for(let l=0;l<g;l+=1){const c=h[l];if(a=a||c===e,a){if(s=0,n.length>0&&r[r.length-1]!==i&&(this.updateMappings(i,s,!0,n,c),r+=i),c===e){const e=this.cursorOrSelection();let a=0;if(e){const n=this.consolidatedPositionForNode(e),r=c.getNumberOfChars();for(;a<r;a+=1){const e=this.mapRectToElement(c.getExtentOfChar(a),c,t);if(n.midLeft<e.x+e.width/2)break}}o=n.length+a,this.caretIsPastCurrentWord()&&(this.updateMappings(i,s,!0,n,c),r+=i)}if(c.children&&c.children.length>0){const{children:e}=c,t=e.length;for(let o=0;o<t;o+=1){const t=e[o],i=this.updateMappingsFromNode(t,s,n);r+=i,s+=i.length}}else{const e=this.updateMappingsFromNode(c,s,n);r+=e,s+=e.length}}}}}return{selection:{start:o,length:0},text:r,custom:{embeddedLocations:{},caretIsPastCurrentWord:this.caretIsPastCurrentWord(),map:n},extended:{text:r,selection:{start:o,length:0}}}}updateMappingsFromNode(e,t,n){const r=e.textContent.replace(/\u200B/g,""),o=r.length;for(let s=0;s<o;s+=1)this.updateMappings(r.charAt(s),t+s,!1,n,e);return t+=o,r}getContextFromSelection(e,t){const r=this.currentEditorElement();if(!r)return null;const o=t?[]:void 0;let s="",i=0,a=0,l=0,c=!1,u=!1;const d=r.querySelectorAll("g[id*='-paragraph-']"),h=d.length;for(let r=0;r<h;r+=1){const h=d[r];if(!f.isParagraph(h))continue;const g=h.getElementsByClassName("sketchy-text-content-text"),m=g.length;for(let r=0;r<m;r+=1){const d=g[r],m=this.selectionForLine(d);if(!m)continue;const p=this.mapToElement(m,h),f=d.querySelectorAll("text"),E=f.length;for(let r=0;r<E;r+=1){const d=f[r];if(!this.nodeIntersectsRect(d,p,h))continue;0!==l&&" "!==s[s.length-1]&&(t&&this.updateMappings(" ",l,!0,o,d),s+=" ",l+=1,c&&(a+=1));const g=d.children&&d.children.length>0?d.children:[d],m=g.length;for(let r=0;r<m;r+=1){const d=g[r],m=this.nodeIntersectsRect(d,p,h),f=d.textContent,E=d.getNumberOfChars();let y=0;for(let r=0;r<E;r+=1){let g=!1;if(m&&e)g=!0;else{const e=this.mapRectToElement(d.getExtentOfChar(r),d,h);g=n.DOMRectExtensions.contains(p,e.x+e.width/2,e.y+e.height/2)}if(g){const e=f.charAt(r);if("​"===e){y+=1;continue}a+=1,i=1===a?l:i,c=!0,t&&this.updateMappings(e,l+r-y,!1,o,d),s+=e,l+=1}else u=c,c=!1;if(u)break}}if(u)break}if(u)break}if(u)break}return{selection:{start:i,length:a},text:s,custom:{embeddedLocations:{},caretIsPastCurrentWord:this.caretIsPastCurrentWord(),map:o},extended:{text:s,selection:{start:i,length:a}}}}getContextWithMappings(e){return e&&e.fromCaretToEnd?this.getContextWithMappingsFromCaretToEnd():e&&e.entireDocument?this.getContextWithMappingsForEntireDocument():this.getContextFromSelection(Boolean(e&&e.completePartiallySelectedWords),!0)}updateMappings(e,t,n,r,o){r&&r.push({index:r.length,element:o,offset:t,text:e,embedded:n})}nodeIntersectsRect(e,t,n){const r=n?this.mapToElement(e,n):e.getBoundingClientRect();return r.x<t.x?r.x+r.width>t.x:r.x<t.x+t.width}lineHasSelection(e){return e&&this.selectionForLine(e)}selectionForLine(e){let t=e;for(;t&&t.parentNode&&!f.isParagraph(t.parentNode);)t=t.parentNode;const n=t.getElementsByClassName(d.selectionClass);return n&&n.length>0?n[0]:null}selectionRectForLine(e){const t=this.selectionForLine(e);return t?t.getBoundingClientRect():null}caretIsPastCurrentWord(){return this.caretIsPastElement(this.currentTextElement())}caretIsPastElement(e){if(null===e)return!1;const{textContent:t}=e;if(null===t||0===t.length)return!1;const n=this.cursorElement();if(null===n)return!1;const r=this.mapToElement(e,this.currentParagraphElement()),o=n.getBBox();return o.x>r.x+r.width+o.width/2}caretIsAfterWhitespace(){if(null===this.cursorElement())return!1;const e=this.currentTextElement();if(null===e)return!1;const{textContent:t}=e;if(null===t||0===t.length)return!1;const n=this.currentParagraphElement(),r=this.mapToElement(e,n),o=this.cursorElement().getBBox();if(o.x-o.width/2<r.x){const t=e.previousSibling;if(null===t)return!1;const r=this.mapToElement(t,n);return r.x+r.width+o.width<o.x}return o.x>r.x+r.width+o.width/2}mapToElement(e,t){const n=e.getBBox();return this.mapRectToElement(n,e,t)}mapRectToElement(e,t,n){const r=t.ownerSVGElement.createSVGPoint(),o=new DOMRect(e.x,e.y,e.width,e.height);let s=t;for(;null!==s&&1===s.nodeType;){const e=s.hasAttribute("transform")?s.transform.baseVal.consolidate():null;if(null!==e){r.x=o.x,r.y=o.y;const t=r.matrixTransform(e.matrix);r.x+=o.width,r.y+=o.height;const n=r.matrixTransform(e.matrix);o.x=t.x,o.y=t.y,o.width=n.x-t.x,o.height=n.y-t.y}if(s===n)break;s=s.parentNode}return o}async removeLeadingSpacesAsync(){const e=this;return new Promise((t=>{e.caretIsAfterWhitespace()?(e.m_caretEventTarget=new EventTarget,e.m_caretEventTarget.addEventListener("com.donjohnston.cwu.caretPositionChanged",(n=>{if(!e.caretIsAfterWhitespace())return e.m_caretEventTarget=null,void t();!e.dispatchEvent("deleteBackward",null)&&(e.m_caretEventTarget=null,t())})),!e.dispatchEvent("deleteBackward",null)&&(e.m_caretEventTarget=null,t())):t()}))}getSlidesViewElement(){return document.getElementById(d.slidesViewId)}getSpeakerNotesElement(){return document.getElementById(d.speakerNotesId)}getParagraphText(e){let t="";if(null!==e){const n=e.getElementsByClassName("sketchy-text-content"),r=n.length;for(let e=0;e<r;e+=1){const r=n[e].querySelectorAll("text"),o=r.length;for(let e=0;e<o;e+=1)t+=r[e].textContent,t+=" "}}return t}dispatchEvent(e,t){if(!this.m_windowProxy)return!1;const r=new CustomEvent("com.donjohnston.cwu.dispatch",{detail:{command:e,params:t}});let o=!1;try{this.m_dispatchingEvents=!0,o=this.m_windowProxy.dispatchEvent(r)}catch(e){n.Logger.error(e)}finally{this.m_dispatchingEvents=!1}return o}initialize(e){if(!this.m_ime)return;const t=(e=e||document.documentElement).getRootNode(),{ownerDocument:r}=t,o=r.createElement("script");o.type="text/javascript",o.async=!0,o.src=chrome.extension.getURL("WebExtensions/selection/cweEventDispatcherGS.js"),o.onload=function(){n.Logger.log("Javascript for Google Slides downloaded!")},e.appendChild(o)}installMainObserver(){this.m_mainObserver=new MutationObserver((e=>{this.checkIsDocumentLoadedAndContinue()})),this.m_mainObserver.observe(document,{subtree:!0,childList:!0}),this.checkIsDocumentLoadedAndContinue()}unistallMainObserver(){null!==this.m_mainObserver&&(this.m_mainObserver.disconnect(),this.m_mainObserver=null)}checkIsDocumentLoadedAndContinue(){this.isDocumentLoaded()&&(!this.m_installed&&this.m_ime&&this.installSvgListeners(),this.unistallMainObserver(),this.m_installed=!0,this.updatePredictionState())}isDocumentLoaded(){return!!document.getElementById(d.workspaceId)&&(!!document.getElementById("pages")&&(!!document.getElementById(d.speakerNotesId)&&0!==document.getElementsByClassName("docs-texteventtarget-iframe").length))}installSvgListeners(){const e=document.getElementById("pages"),t=document.getElementById(d.speakerNotesId);this.addEventListenersForElement(e),this.addEventListenersForElement(t),this.addEventListenersForEditableContent(),this.installSvgObserver()}uninstallSvgListeners(){const e=document.getElementById("pages");null!==e&&this.removeEventListenersForElement(e);const t=document.getElementById(d.speakerNotesId);null!==t&&this.removeEventListenersForElement(t)}installSvgObserver(){const e=document.getElementById(d.workspaceId),t=document.getElementById(d.speakerNotesId),n={subtree:!0,childList:!0,attributes:!0,attributeFilter:["style","x","y","class"],attributeOldFilter:!1};this.m_svgObserver=new MutationObserver((e=>{this.onDOMSubtreeModified(e)})),this.m_svgObserver.observe(e,n),this.m_svgObserver.observe(t,n)}uninstallSvgObserver(){null!==this.m_svgObserver&&(this.m_svgObserver.disconnect(),this.m_svgObserver=null)}onDOMSubtreeModified(e){let t=!1;if(this.m_cursorElement=null,this.hasFocus()&&e){const n=e.length;for(let r=0;r<n;r+=1){const n=e[r];if("childList"===n.type){if(e.removedNodes){const n=e.removedNodes.length;for(let r=0;r<n;r+=1){const n=e.removedNodes[r];this.isSelectionMarker(n)&&(t=!0)}}if(e.addedNodes){const n=e.addedNodes.length;for(let r=0;r<n;r+=1){const n=e.addedNodes[r];this.isSelectionMarker(n)&&(t=!0)}}continue}if("attributes"!==n.type)continue;const o=n.target;this.isSelectionMarker(o)?t=!0:this.isCursor(o)&&(this.m_cursorElement=o)}}(this.m_cursorElement||t||!this.hasFocus())&&(this.m_cursorElement&&this.setCursorRect(this.m_cursorElement.getBoundingClientRect())||t||!this.hasFocus())&&this.updatePredictionState()}isCursor(e){if("rect"!==e.nodeName||"1"!==e.style.opacity||0===e.width.baseVal.value||0===e.height.baseVal.value)return!1;if(e.hasAttribute("class")&&e.getAttribute("class")===d.blinkCursorClassName)return!0;let{parentNode:t}=e;for(;null!==t;){if(t===this.m_currentLineElement||t===this.m_lastClickedSvgElement)return!0;t=t.parentNode}return!1}isSelectionMarker(e){return"rect"===e.nodeName&&e.hasAttribute("class")&&e.getAttribute("class")===d.selectionClass}onWorkspaceMouseDown(e){const t=e.composedPath()[0];f.isSVGElement(t)&&(this.setLastClickedSvgElement(t),this.resetCurrentElements(!0),this.m_ime.onEditorEvent(this,null,e),this.m_ime.onMouseDown(this,e))}onWorkspaceMouseUp(e){const t=e.composedPath()[0];f.isSVGElement(t)&&(this.setLastClickedSvgElement(t),this.hasSelection()||this.resetCurrentElements(!0),this.m_ime.onEditorEvent(this,null,e),this.m_ime.onMouseUp(this,e))}resetCurrentElements(e=!1){this.m_currentEditorElement=null,this.m_currentParagraphElement=null,this.m_currentLineElement=null,this.m_currentTextElement=null,this.m_cursorElement=null,e&&(this.m_cursorRect=null)}currentEditorElement(){return null!==this.m_currentEditorElement&&null!==this.m_currentEditorElement.ownerSVGElement||(this.m_currentEditorElement=this.computeCurrentEditorElement()),this.m_currentEditorElement}currentParagraphElement(){return null!==this.m_currentParagraphElement&&null!==this.m_currentParagraphElement.ownerSVGElement||(this.m_currentParagraphElement=this.computeCurrentParagraphElement()),this.m_currentParagraphElement}currentLineElement(){return null!==this.m_currentLineElement&&null!==this.m_currentLineElement.ownerSVGElement||(this.m_currentLineElement=this.computeCurrentLineElement()),this.m_currentLineElement}currentTextElement(){return null!==this.m_currentTextElement&&null!==this.m_currentTextElement.ownerSVGElement||(this.m_currentTextElement=this.computeCurrentTextElement()),this.m_currentTextElement}currentSelectionElements(){const e=document.getElementById(d.slidesViewId);return null===e?null:e.getElementsByClassName(d.selectionClass)}hasSelection(){const e=this.currentSelectionElements();return e&&e.length>0}currentSelection(){const e=this.currentSelectionElements(),t=[],n=e.length;for(let r=0;r<n;r+=1){const n=e[r];t.push(n.getBoundingClientRect())}return t}computeCurrentTextElement(){const e=this.currentLineElement();if(null===e)return null;const t=this.cursorOrSelection();if(null===t)return null;const r=t.getBBox(),o=new DOMRect(r.x,r.y,r.width,r.height);let s=null;const i=e.querySelectorAll("text"),a=i.length;for(let e=0;e<a;e+=1){const t=i[e],r=t.getBBox(),a=new DOMRect(r.x,r.y,r.width,r.height);if(n.DOMRectExtensions.intersectsRect(o,a))return t;o.x>a.x&&(s=t)}return null!==s?s:i.length>0?i[i.length-1]:null}computeCurrentEditorElement(){let e=this.cursorOrSelection();if(null===e)return null;for(e=e.parentNode;null!==e;){if(e.hasAttribute("id")){const t=e.getAttribute("id");if(!0===d.paragraphIdRegEx.test(t)){this.m_currentParagraphElement=e,e=e.parentNode;continue}if(!0===d.editorIdRegEx.test(t))return e;if("pages"===t)break;if(t===d.speakerNotesId)return e}e=e.parentNode}return null}computeCurrentParagraphElement(){const e=this.currentEditorElement();if(null===e)return null;if(this.m_currentParagraphElement)return this.m_currentParagraphElement;const t=this.cursorOrSelection();if(null===t)return null;const r=e.querySelectorAll("g[id*='-paragraph-']"),o=r.length;for(let e=0;e<o;e+=1){const o=r[e];if(n.Utils.computeCommonAncestor(t,o)===o)return o}const s=t.getBoundingClientRect();return E.getParagraphAtPoint(s.x,s.y+s.height/2,e)}computeCurrentLineElement(){const e=this.currentParagraphElement();if(null===e)return null;const t=this.cursorOrSelection();if(null===t)return null;const r=e.getElementsByClassName("sketchy-text-content-text"),o=r.length;for(let e=0;e<o;e+=1){const o=r[e],s=n.Utils.computeCommonAncestor(t,o);if(s===o.parentNode||s===o.parentNode.parentNode)return o}const s=t.getBoundingClientRect();return E.getLineAtPoint(s.x,s.y+s.height/2,e)||(r.length>0?r[r.length-1]:null)}cursorOrSelection(){let e=this.cursorElement();if(null===e){const t=this.currentSelectionElements();e=t&&t.length>0?t[0]:null}return e}cursorElement(){return null!==this.m_cursorElement&&null!==this.m_cursorElement.ownerSVGElement||(this.m_cursorElement=this.computeCurrentCursorElement()),this.m_cursorElement}computeCurrentCursorElement(){const e=this.computeCurrentCursorElementFromParent(this.m_lastClickedSvgElement);if(e)return e;const t=this.computeCurrentCursorElementFromParent(this.getSlidesViewElement());return t&&(this.m_lastClickedSvgElement=f.getParentEditor(t)),t}computeCurrentCursorElementFromParent(e){const t=e||document.documentElement;if(!t)return null;const n=t.getElementsByClassName(d.blinkCursorClassName);if(null!==n&&1===n.length)return n[0];const r=t.querySelectorAll("rect[style*='opacity: 1;']");if(null===r||0===r.length)return null;const o=r.length;for(let e=0;e<o;e+=1){const t=r[e];if(0!==t.width.baseVal.value&&0!==t.height.baseVal.value)return t}return null}cursorPosition(){const e=this.cursorElement();return null===e?null:this.consolidatedPositionForNode(e)}consolidatedPositionForNode(e){const t=e.ownerSVGElement.createSVGPoint(),n=e.getBBox(),r=e.transform.baseVal.consolidate();t.x=n.x,t.y=n.y;const o=null!==r?t.matrixTransform(r.matrix):{x:t.x,y:t.y};t.x+=n.width/2,t.y+=n.height/2;const s=null!==r?t.matrixTransform(r.matrix):{x:t.x,y:t.y},i=(o.x+s.x)/2,a=(o.y+s.y)/2;return{x:o.x,y:o.y,midLeft:i,midTop:a}}currentTextContent(){const e=this.currentTextElement();return null===e?null:e.textContent}cursorRect(){if(!this.m_cursorRect){const e=this.cursorElement();e&&this.setCursorRect(e.getBoundingClientRect())}return this.m_cursorRect}setCursorRect(e){const t=!this.m_cursorRect||!n.DOMRectExtensions.equalsTo(this.m_cursorRect,e);return this.m_cursorRect=e,t&&(this.resetCurrentElements(!1),null!==this.m_caretEventTarget&&this.dispatchCaretPositionChangedEvent()),t}dispatchCaretPositionChangedEvent(){const e=new CustomEvent("com.donjohnston.cwu.caretPositionChanged",null);try{this.m_caretEventTarget.dispatchEvent(e)}catch(e){n.Logger.error(e)}}updatePredictionState(){if(!this.m_ime)return;const e=this.m_lastState,t=this.getState();if(this.m_lastState=t,(!e||e.active!==t.active)&&this.m_ime.onEditorChanged(t.hook,t.editor),!t.active)return;const n=((e&&e.cursorRect?e.cursorRect.width:3)+(t.cursorRect?t.cursorRect.width:3))/2;(!e||!this.rectsAreWithinProximity(e.cursorRect,t.cursorRect,n)||!this.rectArrayAreEqual(e.selectionRects,t.selectionRects))&&this.m_ime.onContextChanged(this)}rectArrayAreEqual(e,t){if(e===t)return!0;if(e&&t){const n=e.length;if(n!==t.length)return!1;for(let r=0;r<n;r+=1)if(!this.rectsAreEqual(e[r],t[r]))return!1}return!0}rectsAreEqual(e,t){return Boolean(e===t||e&&n.DOMRectExtensions.equalsTo(e,t))}rectsAreWithinProximity(e,t,r){return Boolean(e===t||e&&n.DOMRectExtensions.isWithinProximityTo(e,t,r))}getContentEditableElement(){const e=document.getElementsByClassName("docs-texteventtarget-iframe");if(null===e||0===e.length)return null;const t=e[0],{contentDocument:n}=t;return null===n?null:n.querySelector("div[contenteditable='true'")}addEventListenersForElement(e){e.addEventListener("mousedown",this.m_mouseDownEventListener,!0),e.addEventListener("mouseup",this.m_mouseUpEditorListener,!0)}removeEventListenersForElement(e){e.removeEventListener("mousedown",this.m_mouseDownEventListener,!0),e.removeEventListener("mouseup",this.m_mouseUpEditorListener,!0)}addEventListenersForEditableContent(){const e=this.getContentEditableElement();null!==e&&(e.addEventListener("focus",this.m_contentEditableOnFocusListener,!0),e.addEventListener("blur",this.m_contentEditableOnBlurListener,!0),e.addEventListener("keydown",this.m_contentEditableOnKeyDownListener,!0),e.addEventListener("keyup",this.m_contentEditableOnKeyUpListener,!0),e.addEventListener("keypress",this.m_contentEditableOnKeyPressListener,!0))}removeEventListenersForEditableContent(){const e=this.getContentEditableElement();null!==e&&(e.removeEventListener("focus",this.m_contentEditableOnFocusListener,!0),e.removeEventListener("blur",this.m_contentEditableOnBlurListener,!0),e.removeEventListener("keydown",this.m_contentEditableOnKeyDownListener,!0),e.removeEventListener("keyup",this.m_contentEditableOnKeyUpListener,!0),e.removeEventListener("keypress",this.m_contentEditableOnKeyPressListener,!0))}onFocus(e){this.m_ime.onEditorEvent(this,null,e),this.updatePredictionState()}onBlur(e){this.m_ime.onEditorEvent(this,null,e),this.updatePredictionState()}onKeyDown(e){this.m_dispatchingEvents||(this.m_ime.onEditorEvent(this,null,e),this.m_ime.onKeyDown(this,e)&&(e.stopPropagation(),e.preventDefault()))}onKeyUp(e){this.m_dispatchingEvents||(this.m_ime.onEditorEvent(this,null,e),this.m_ime.onKeyUp(this,e)&&(e.stopPropagation(),e.preventDefault()))}onKeyPress(e){this.m_dispatchingEvents||(this.m_ime.onEditorEvent(this,null,e),this.m_ime.onKeyPress(this,e)&&(e.stopPropagation(),e.preventDefault()))}hasFocus(){return this.contentEditableHasFocus()&&null!==this.currentEditorElement()&&(null!==this.cursorElement()||this.hasSelection())}contentEditableHasFocus(){const e=document.activeElement;return e&&("docs-toolbar"===e.id||e.classList.contains("docs-texteventtarget-iframe")||e===this.getContentEditableElement())}setLastClickedSvgElement(e){let t=e;for(;null!==t;){if(f.isEditor(t))return void(this.m_lastClickedSvgElement=t);if(t=t.parentElement,null!==t&&t.hasAttribute("id")){const e=t.getAttribute("id");if("pages"===e)break;if(e===d.speakerNotesId)return void(this.m_lastClickedSvgElement=t)}}this.m_lastClickedSvgElement=e}getSelection(){const e=this.getContext(null,!1,!1,!0);return e?{anchorNode:null,anchorOffset:e.selection.start,focusNode:null,focusOffset:e.selection.start+e.selection.length}:null}}class C extends t.TextMapperDelegateFactory{mGoogleSlidesHook=null;constructor(){super(),n.Utils.isGoogleSlides()&&(this.mGoogleSlidesHook=new y(null,null,null),this.mGoogleSlidesHook.install())}doCreateDelegate(e=null){return e&&n.Utils.isOcrRewordifyPopupElement(e)?null:n.Utils.isGoogleDocs()?new u:n.Utils.isGoogleSlides()?new p(this.mGoogleSlidesHook):null}}var v,b=()=>([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,(e=>(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16)));!function(e){e.GetTextAtCursor="GET_TEXT_AT_CURSOR",e.InsertText="INSERT_TEXT",e.GetSelection="GET_SELECTION",e.GetSelectionRange="GET_SELECTION_RANGE",e.GetCursor="GET_CURSOR",e.GetRenderedRanges="GET_RENDERED_RANGES",e.GetRangeText="GET_RANGE_TEXT",e.GetAllText="GET_ALL_TEXT",e.SetHighlights="SET_HIGHLIGHTS",e.ClearHighlights="CLEAR_HIGHLIGHTS",e.SetSelection="SET_SELECTION",e.KeyboardEvent="TRIGGER_KEY_EVENT",e.GetParagraphStarts="GET_PARAGRAPH_STARTS",e.RemoveHighlightsById="REMOVE_HIGHLIGHTS_BY_ID",e.SetSpellCheckVisibility="SET_SPELL_CHECK_VISIBILITY",e.GetSpellCheckErrors="GET_SPELL_CHECK_ERRORS",e.GetStyle="GET_STYLE",e.GetRectsByRange="GET_RECTS_BY_RANGE",e.GetAllObjects="GET_ALL_OBJECTS",e.GetObjectById="GET_OBJECT_BY_ID",e.GetObjectByIndex="GET_OBJECT_BY_INDEX"}(v||(v={}));var x,S=v;function P(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function w(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?P(Object(n),!0).forEach((function(t){T(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):P(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function N(e,t,n,r,o,s,i){try{var a=e[s](i),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(r,o)}function k(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var s=e.apply(t,n);function i(e){N(s,r,o,i,a,"next",e)}function a(e){N(s,r,o,i,a,"throw",e)}i(void 0)}))}}function T(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},s=Object.keys(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function A(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function F(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return A(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?A(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,i=!0,a=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){a=!0,s=e},f:function(){try{i||null==n.return||n.return()}finally{if(a)throw s}}}}function R(e,t){return"string"==typeof t?x.TEXT+t:t}function L(e,t){if("string"!=typeof t)return t;const n=t.substring(0,1),r=t.substring(1);switch(n){case x.TEXT:return r;case x.HTML_ELEMENT:return null;default:throw new Error("Unknown identifier in beginning of text")}}!function(e){e.TEXT="",e.HTML_ELEMENT=""}(x||(x={}));for(var O="HvW5",I="AurK",M="wnZK",D="N+aV",B="L81W",G="ppV+",j="kQIP",H="2SZD",K="wdbv",V="6cLn",U="K37Y",q={ctrl:17,control:17,alt:18,option:18,shift:16,windows:91,command:91,esc:27,escape:27,"`":192,"-":189,"=":187,backspace:8,tab:9,"\\":220,"[":219,"]":221,";":186,"'":222,enter:13,return:13,",":188,".":190,"/":191,space:32,pause:19,break:19,insert:45,delete:46,home:36,end:35,pageup:33,pagedown:34,left:37,up:38,right:39,down:40,capslock:20,numlock:144,scrolllock:145},W=1;W<20;W++)q["f"+W]=111+W;for(var X=function(e){return"string"==typeof e?function(e){var t=q[e.toLowerCase()];return void 0!==t?t:1===e.length?e.toUpperCase().charCodeAt(0):void 0}(e):"number"==typeof e?function(e){for(var t in q)if(q.hasOwnProperty(t)&&q[t]===e)return t;return String.fromCharCode(e).toLowerCase()}(e):void 0},z=function(e){return null!==e&&!Array.isArray(e)&&"object"==typeof e},Y={3:"Cancel",6:"Help",8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",28:"Convert",29:"NonConvert",30:"Accept",31:"ModeChange",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",41:"Select",42:"Print",43:"Execute",44:"PrintScreen",45:"Insert",46:"Delete",48:["0",")"],49:["1","!"],50:["2","@"],51:["3","#"],52:["4","$"],53:["5","%"],54:["6","^"],55:["7","&"],56:["8","*"],57:["9","("],91:"OS",93:"ContextMenu",144:"NumLock",145:"ScrollLock",181:"VolumeMute",182:"VolumeDown",183:"VolumeUp",186:[";",":"],187:["=","+"],188:[",","<"],189:["-","_"],190:[".",">"],191:["/","?"],192:["`","~"],219:["[","{"],220:["\\","|"],221:["]","}"],222:["'",'"'],224:"Meta",225:"AltGraph",246:"Attn",247:"CrSel",248:"ExSel",249:"EraseEof",250:"Play",251:"ZoomOut"},J=0;J<24;J+=1)Y[112+J]="F"+(J+1);for(var Q=0;Q<26;Q+=1){var Z=Q+65;Y[Z]=[String.fromCharCode(Z+32),String.fromCharCode(Z)]}var $={codes:Y,getCode:function(e){return z(e)?e.keyCode||e.which||this[e.key]:this[e]},getKey:function(e){var t=z(e);if(t&&e.key)return e.key;var n=Y[t?e.keyCode||e.which:e];return Array.isArray(n)&&(n=t?n[e.shiftKey?1:0]:n[0]),n},Cancel:3,Help:6,Backspace:8,Tab:9,Clear:12,Enter:13,Shift:16,Control:17,Alt:18,Pause:19,CapsLock:20,Escape:27,Convert:28,NonConvert:29,Accept:30,ModeChange:31," ":32,PageUp:33,PageDown:34,End:35,Home:36,ArrowLeft:37,ArrowUp:38,ArrowRight:39,ArrowDown:40,Select:41,Print:42,Execute:43,PrintScreen:44,Insert:45,Delete:46,0:48,")":48,1:49,"!":49,2:50,"@":50,3:51,"#":51,4:52,$:52,5:53,"%":53,6:54,"^":54,7:55,"&":55,8:56,"*":56,9:57,"(":57,a:65,A:65,b:66,B:66,c:67,C:67,d:68,D:68,e:69,E:69,f:70,F:70,g:71,G:71,h:72,H:72,i:73,I:73,j:74,J:74,k:75,K:75,l:76,L:76,m:77,M:77,n:78,N:78,o:79,O:79,p:80,P:80,q:81,Q:81,r:82,R:82,s:83,S:83,t:84,T:84,u:85,U:85,v:86,V:86,w:87,W:87,x:88,X:88,y:89,Y:89,z:90,Z:90,OS:91,ContextMenu:93,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,F13:124,F14:125,F15:126,F16:127,F17:128,F18:129,F19:130,F20:131,F21:132,F22:133,F23:134,F24:135,NumLock:144,ScrollLock:145,VolumeMute:181,VolumeDown:182,VolumeUp:183,";":186,":":186,"=":187,"+":187,",":188,"<":188,"-":189,_:189,".":190,">":190,"/":191,"?":191,"`":192,"~":192,"[":219,"{":219,"\\":220,"|":220,"]":221,"}":221,"'":222,'"':222,Meta:224,AltGraph:225,Attn:246,CrSel:247,ExSel:248,EraseEof:249,Play:250,ZoomOut:251};$.Spacebar=$[" "],$.Digit0=$[0],$.Digit1=$[1],$.Digit2=$[2],$.Digit3=$[3],$.Digit4=$[4],$.Digit5=$[5],$.Digit6=$[6],$.Digit7=$[7],$.Digit8=$[8],$.Digit9=$[9],$.Tilde=$["~"],$.GraveAccent=$["`"],$.ExclamationPoint=$["!"],$.AtSign=$["@"],$.PoundSign=$["#"],$.PercentSign=$["%"],$.Caret=$["^"],$.Ampersand=$["&"],$.PlusSign=$["+"],$.MinusSign=$["-"],$.EqualsSign=$["="],$.DivisionSign=$["/"],$.MultiplicationSign=$["*"],$.Comma=$[","],$.Decimal=$["."],$.Colon=$[":"],$.Semicolon=$[";"],$.Pipe=$["|"],$.BackSlash=$["\\"],$.QuestionMark=$["?"],$.SingleQuote=$["'"],$.DoubleQuote=$['"'],$.LeftCurlyBrace=$["{"],$.RightCurlyBrace=$["}"],$.LeftParenthesis=$["("],$.RightParenthesis=$[")"],$.LeftAngleBracket=$["<"],$.RightAngleBracket=$[">"],$.LeftSquareBracket=$["["],$.RightSquareBracket=$["]"];var ee=$;let te;!function(e){e.GoogleDocs="Google Docs",e.GoogleForms="Google Forms",e.GoogleSlides="Google Slides",e.GoogleDrawings="Google Drawings",e.GoogleSheets="Google Sheets"}(te||(te={}));const ne={document:te.GoogleDocs,forms:te.GoogleForms,presentation:te.GoogleSlides,drawings:te.GoogleDrawings,spreadsheets:te.GoogleSheets};var re={3:{code:"Cancel"},6:{code:"Help"},8:{code:"Backspace"},9:{code:"Tab"},12:{code:"Clear"},13:{code:"Enter"},16:{code:"Shift"},17:{code:"Control"},18:{code:"Alt"},19:{code:"Pause"},20:{code:"CapsLock"},21:{code:"KanaMode"},22:{code:"Lang1"},25:{code:"Lang2"},27:{code:"Escape"},28:{code:"Convert"},29:{code:"NonConvert"},30:{code:"Accept"},31:{code:"ModeChange"},32:{code:"Space"},33:{code:"PageUp"},34:{code:"PageDown"},35:{code:"End"},36:{code:"Home"},37:{code:"ArrowLeft"},38:{code:"ArrowUp"},39:{code:"ArrowRight"},40:{code:"ArrowDown"},41:{code:"Select"},42:{code:"Print"},43:{code:"Execute"},44:{code:"PrintScreen"},45:{code:"Insert"},46:{code:"Delete"},47:{code:"Help"},48:{code:"Digit0",keyCap:"0"},49:{code:"Digit1",keyCap:"1"},50:{code:"Digit2",keyCap:"2"},51:{code:"Digit3",keyCap:"3"},52:{code:"Digit4",keyCap:"4"},53:{code:"Digit5",keyCap:"5"},54:{code:"Digit6",keyCap:"6"},55:{code:"Digit7",keyCap:"7"},56:{code:"Digit8",keyCap:"8"},57:{code:"Digit9",keyCap:"9"},65:{code:"KeyA",keyCap:"a"},66:{code:"KeyB",keyCap:"b"},67:{code:"KeyC",keyCap:"c"},68:{code:"KeyD",keyCap:"d"},69:{code:"KeyE",keyCap:"e"},70:{code:"KeyF",keyCap:"f"},71:{code:"KeyG",keyCap:"g"},72:{code:"KeyH",keyCap:"h"},73:{code:"KeyI",keyCap:"i"},74:{code:"KeyJ",keyCap:"j"},75:{code:"KeyK",keyCap:"k"},76:{code:"KeyL",keyCap:"l"},77:{code:"KeyM",keyCap:"m"},78:{code:"KeyN",keyCap:"n"},79:{code:"KeyO",keyCap:"o"},80:{code:"KeyP",keyCap:"p"},81:{code:"KeyQ",keyCap:"q"},82:{code:"KeyR",keyCap:"r"},83:{code:"KeyS",keyCap:"s"},84:{code:"KeyT",keyCap:"t"},85:{code:"KeyU",keyCap:"u"},86:{code:"KeyV",keyCap:"v"},87:{code:"KeyW",keyCap:"w"},88:{code:"KeyX",keyCap:"x"},89:{code:"KeyY",keyCap:"y"},90:{code:"KeyZ",keyCap:"z"},91:{code:"MetaLeft"},92:{code:"MetaRight"},93:{code:"ContextMenu"},95:{code:"Standby"},96:{code:"Numpad0",keyCap:"0"},97:{code:"Numpad1",keyCap:"1"},98:{code:"Numpad2",keyCap:"2"},99:{code:"Numpad3",keyCap:"3"},100:{code:"Numpad4",keyCap:"4"},101:{code:"Numpad5",keyCap:"5"},102:{code:"Numpad6",keyCap:"6"},103:{code:"Numpad7",keyCap:"7"},104:{code:"Numpad8",keyCap:"8"},105:{code:"Numpad9",keyCap:"9"},106:{code:"NumpadMultiply",keyCap:"*"},107:{code:"NumpadAdd",keyCap:"+"},108:{code:"NumpadComma",keyCap:","},109:{code:"NumpadSubtract",keyCap:"-"},110:{code:"NumpadDecimal",keyCap:"."},111:{code:"NumpadDivide",keyCap:"/"},112:{code:"F1"},113:{code:"F2"},114:{code:"F3"},115:{code:"F4"},116:{code:"F5"},117:{code:"F6"},118:{code:"F7"},119:{code:"F8"},120:{code:"F9"},121:{code:"F10"},122:{code:"F11"},123:{code:"F12"},124:{code:"F13"},125:{code:"F14"},126:{code:"F15"},127:{code:"F16"},128:{code:"F17"},129:{code:"F18"},130:{code:"F19"},131:{code:"F20"},132:{code:"F21"},133:{code:"F22"},134:{code:"F23"},135:{code:"F24"},144:{code:"NumLock"},145:{code:"ScrollLock"},160:{code:"ShiftLeft"},161:{code:"ShiftRight"},162:{code:"ControlLeft"},163:{code:"ControlRight"},164:{code:"AltLeft"},165:{code:"AltRight"},166:{code:"BrowserBack"},167:{code:"BrowserForward"},168:{code:"BrowserRefresh"},169:{code:"BrowserStop"},170:{code:"BrowserSearch"},171:{code:"BrowserFavorites"},172:{code:"BrowserHome"},173:{code:"AudioVolumeMute"},174:{code:"AudioVolumeDown"},175:{code:"AudioVolumeUp"},176:{code:"MediaTrackNext"},177:{code:"MediaTrackPrevious"},178:{code:"MediaStop"},179:{code:"MediaPlayPause"},180:{code:"LaunchMail"},181:{code:"MediaSelect"},182:{code:"LaunchApp1"},183:{code:"LaunchApp2"},186:{code:"Semicolon",keyCap:";"},187:{code:"Equal",keyCap:"="},188:{code:"Comma",keyCap:","},189:{code:"Minus",keyCap:"-"},190:{code:"Period",keyCap:"."},191:{code:"Slash",keyCap:"/"},192:{code:"Backquote",keyCap:"`"},219:{code:"BracketLeft",keyCap:"["},220:{code:"Backslash",keyCap:"\\"},221:{code:"BracketRight",keyCap:"]"},222:{code:"Quote",keyCap:"'"},226:{code:"IntlBackslash",keyCap:"\\"},229:{code:"Process"},246:{code:"Attn"},247:{code:"CrSel"},248:{code:"ExSel"},249:{code:"EraseEof"},250:{code:"Play"},251:{code:"ZoomToggle"},254:{code:"Clear"}};const oe=()=>{const e=document.querySelector(".docs-texteventtarget-iframe");return{win:e.contentWindow,doc:e.contentDocument}},se=(e,t)=>{const n=oe(),r=n.doc,o=n.win,s=function(e){if("string"==typeof e&&(e=e.replace(/\s/g,"").split("+")),"object"==typeof e)return e.length?function(e){for(var t,n={keyCode:[],altKey:!1,ctrlKey:!1,shiftKey:!1},r=0,o=e.length;r<o;r++)18===(t=X(e[r]))&&(n.altKey=!0),17===t&&(n.ctrlKey=!0),16===t&&(n.shiftKey=!0),(t<16||t>18)&&n.keyCode.push(t);return n}(e):function(e){var t=e.keyCode.length?e.keyCode:[e.keyCode],n=[];e.altKey&&n.push("alt"),e.ctrlKey&&n.push("ctrl"),e.shiftKey&&n.push("shift");for(var r=0,o=t.length;r<o;r++)n.push(X(t[r]));return n}(e)}(e),i=s.altKey,a=s.shiftKey,l=s.keyCode;let c=s.ctrlKey;const u=e.toLowerCase().startsWith("cmd+")||e.startsWith("⌘+");!u||e.toLowerCase().includes("control")||e.toLowerCase().includes("ctrl")||(c=!1);const d=Array.isArray(l)?l[0]:l,h=ee.getKey(d),g=(re[d]||{code:String.fromCharCode(d)}).code;return{altGraphKey:!1,bubbles:!0,cancelBubble:!1,cancelable:!0,clipboardData:void 0,currentTarget:r,defaultPrevented:!1,detail:0,eventPhase:0,keyLocation:0,layerX:0,layerY:0,pageX:void 0,pageY:void 0,returnValue:!0,srcElement:r.body,target:r.body,timeStamp:(new Date).getTime(),type:t,view:o,charCode:0,altKey:i,ctrlKey:c,shiftKey:a,metaKey:u,keyCode:d,key:h,code:g}};var ie=(e,t="keydown")=>{((e=window.location)=>{const t=e.host,n=e.pathname;if("docs.google.com"!==t)return;let r;const o=n.split("/").filter((e=>!!e));return r=n.startsWith("/a/")?o[2]:o[0],ne[r]})()!==te.GoogleDocs?((e,t="keydown")=>{const n=oe(),r=n.doc,o=n.win,s=r.body.querySelector("div[tabindex]"),i=se(e,t),a=i.key,l=i.code,c=i.keyCode,u=i.altKey,d=i.ctrlKey,h=i.shiftKey,g=i.metaKey,m=new KeyboardEvent(t,{bubbles:!0,cancelable:!0,view:o,key:a,code:l,keyCode:c,altKey:u,ctrlKey:d,shiftKey:h,metaKey:g});s.dispatchEvent(m)})(e,t):((e,t="keydown")=>{var n,r=F(((e,t=document.querySelector(".docs-texteventtarget-iframe").contentDocument)=>{try{const h=[];let g=null,m=null;for(var n in t)if(n.match(/^closure/)&&"number"!=typeof t[n]){var r=t[n];if(!r)continue;if(!g)for(var o in r){var s=r[o];if(s&&s!=t)for(var i in s){var a=s[i];a&&null!=a.length&&a[0].src==t&&(g=o,h.concat(a))}}for(var l in r[String(g)])if(l==e)for(var c=r[String(g)][l],u=0;u<c.length;u++){if(!m&&c[u].src==t)for(var d in c[u])if(c[u][d].src==t){m=d;break}h.push({eventObject:c[u],eventHandler:c[u][String(m)]})}}return h}catch(e){console.warn(e)}})(t));try{for(r.s();!(n=r.n()).done;){const r=n.value,o=se(e,t);try{r.eventHandler(o)}catch(e){console.error("Couldn't execute event",e)}}}catch(e){r.e(e)}finally{r.f()}})(e,t)};const ae=["start","end","backgroundColor","borderLeftColor","borderRightColor","borderTopColor","borderBottomColor","id"];let le={start:0,end:0};document.addEventListener("wizkids-google-docs-outbound",(e=>{let t=null;try{if(t=JSON.parse(e.detail,L),"__onSelectionChange"===t.id){const e=JSON.parse(t.result,L);if(!e)return;"InlineLocation"===e.type&&(le=e.range)}else t.id}finally{t=null}}));const ce=({type:e,args:t=[]},n,r)=>{const o=b(),s=e=>{let t=!1;try{const r=JSON.parse(e.detail,L);t=Boolean(r&&r.id===o),t&&n(JSON.parse(r.result,L))}finally{t&&document.removeEventListener("wizkids-google-docs-outbound",s)}};document.addEventListener("wizkids-google-docs-outbound",s),document.dispatchEvent(new CustomEvent("wizkids-google-docs-inbound",{cancelable:!0,bubbles:!0,detail:JSON.stringify({id:o,type:e,args:t},R)}))},ue=({type:e,args:t=[]})=>new Promise(((n,r)=>{ce({type:e,args:t},n)})),de=({type:e,args:t=[]})=>{let n=null;return ce({type:e,args:t},(e=>{n=e})),n},he=({type:e,args:t=[]})=>{const n=b();document.dispatchEvent(new CustomEvent("wizkids-google-docs-inbound",{cancelable:!0,bubbles:!0,detail:JSON.stringify({id:n,type:e,args:t},R)}))},ge=(me=k((function*(){return ue({type:O})})),function(){return me.apply(this,arguments)});var me;const pe=()=>de({type:O}),fe=(Ee=k((function*(){return ue({type:M})})),function(){return Ee.apply(this,arguments)});var Ee;const ye=()=>de({type:M}),Ce=(ve=k((function*(){return ue({type:G})})),function(){return ve.apply(this,arguments)});var ve;const be=()=>de({type:G}),xe=(Se=k((function*({start:e,end:t}){return(yield fe()).substring(e,t)})),function(e){return Se.apply(this,arguments)});var Se;const Pe=({start:e,end:t})=>{const n=ye();return null==n?n:n.substring(e,t)},we=()=>xe(le),Ne=()=>Pe(le),ke=()=>ue({type:D}),Te=()=>de({type:D}),_e=(e,{side:t="left",length:n=1}={})=>{if(null==e)return null;const r=le,o=r.start,s=r.end;return"left"===t?e.substring(o-n,s):e.substring(o,s+n)},Ae=(Fe=k((function*({side:e="left",length:t=1}={}){const n=yield fe();return _e(n,{side:e,length:t})})),function(){return Fe.apply(this,arguments)});var Fe;const Re=({side:e="left",length:t=1}={})=>{const n=ye();return _e(n,{side:e,length:t})},Le=()=>ue({type:H}),Oe=()=>de({type:H}),Ie=(e,t)=>ue({type:I,args:[e,t]}),Me=(e,t)=>de({type:I,args:[e,t]}),De=e=>ue({type:j,args:[e]}),Be=e=>de({type:j,args:[e]}),Ge=()=>ue({type:K}),je=()=>de({type:K}),He=e=>ue({type:V,args:[e]}),Ke=e=>de({type:V,args:[e]}),Ve=(e,t)=>ue({type:U,args:[e,t]}),Ue=(e,t)=>de({type:U,args:[e,t]}),qe=(e,t)=>new Promise(((n,r)=>{const o=b(),s=e=>{e.source===window&&e.data&&e.data.id===o&&"TH_DOCS_PARSER_RESPONSE"===e.data.action&&("success"===e.data.responseType?n(e.data.responseValue):r(e.data.responseValue),window.removeEventListener("message",s))};window.addEventListener("message",s),window.postMessage({action:"TH_DOCS_PARSER_ACTION",type:e,id:o,options:t},"https://docs.google.com")})),We=(e,t)=>{let n=null;return((e,t,n,r)=>{const o=!!r;switch(t){case S.InsertText:{const t=n.text,r=n.mimeType;e((()=>((e,t)=>he({type:"fXY1",args:[e,t]}))(r,t)));break}case S.KeyboardEvent:{const t=Array.isArray(n)?n:[n];e((()=>{t.forEach((e=>{ie(e.combo,e.type)}))}));break}case S.SetSelection:{const t=n.cursor;e((()=>he({type:"gO78",args:[{range:t,type:"InlineLocation"}]})));break}case S.GetAllText:{const t=o?ye:fe;e((()=>t()));break}case S.GetRangeText:{const t=n,r=t.start,s=t.end,i=o?Pe:xe;e((()=>i({start:r,end:s})));break}case S.GetTextAtCursor:{const t=n.side,r=n.length,s=o?Re:Ae;e((()=>s({side:t,length:r})));break}case S.GetSelection:{const t=o?Ne:we;e((()=>t()));break}case S.GetSelectionRange:{const t=o?pe:ge;e((()=>t()));break}case S.GetCursor:e((()=>le));break;case S.SetHighlights:{const t=n.highlights;e((()=>(e=>{const t=e.map((e=>{let t=e.start,n=e.end,r=e.backgroundColor,o=e.borderLeftColor,s=e.borderRightColor,i=e.borderTopColor,a=e.borderBottomColor,l=e.id;return[l,w({range:{start:t,end:n},backgroundColor:r,borderLeftColor:o,borderRightColor:s,borderTopColor:i,borderBottomColor:a,id:l},_(e,ae))]}));he({type:"zvZQ",args:[t]}),document.dispatchEvent(new CustomEvent("webkitvisibilitychange",{cancelable:!1,bubbles:!0}))})(t)));break}case S.ClearHighlights:e((()=>he({type:B})));break;case S.GetRenderedRanges:{const t=o?be:Ce;e((()=>t()));break}case S.GetParagraphStarts:{const t=o?Te:ke;e((()=>t()));break}case S.RemoveHighlightsById:{const t=n.ids;e((()=>(e=>he({type:B,args:[e]}))(t)));break}case S.SetSpellCheckVisibility:{const t=n.visible;e((()=>(e=>he({type:"149D",args:[e]}))(t)));break}case S.GetSpellCheckErrors:{const t=o?Oe:Le;e((()=>t()));break}case S.GetStyle:{const t=n.styleType,r=n.index,s=o?Me:Ie;e((()=>s(t,r)));break}case S.GetRectsByRange:{const t=n.range,r=o?Be:De;e((()=>r(t)));break}case S.GetAllObjects:{const t=o?je:Ge;e((()=>t()));break}case S.GetObjectById:{const t=n.objectId,r=o?Ke:He;e((()=>r(t)));break}case S.GetObjectByIndex:{const t=n.objectType,r=n.index,s=o?Ue:Ve;e((()=>s(t,r)));break}}})((r=>{n=r(e,t)}),e,t,!0),n},Xe=new Map;class ze{static error=null;static get hasErrors(){return null!=ze.error}static get lastError(){return ze.error}static getDocumentText(){try{return We(S.GetAllText)}catch(e){throw ze.error=new Error(e),ze.error}}static getDocsSelection(){try{const e=ze.getDocumentText(),t=ze.getCursor();return e.substring(t.start,t.end)}catch(e){throw ze.error=new Error(e),ze.error}}static async getDocsSelectionAsync(){try{return qe(S.GetSelection)}catch(e){throw ze.error=new Error(e),ze.error}}static getCursor(){try{return We(S.GetCursor)}catch(e){throw ze.error=new Error(e),ze.error}}static getTextAtCursorAsync(e){try{return(({side:e="left",length:t}={})=>qe(S.GetTextAtCursor,{side:e,length:t}))(e)}catch(e){throw ze.error=new Error(e),ze.error}}static getRangeText(e){try{return(e=>We(S.GetRangeText,e))(e)}catch(e){throw ze.error=new Error(e),ze.error}}static removeHighlight(e){try{(e=>{const t=(e=>{const t=Array.isArray(e)?e:[e];var n,r=F(t);try{for(r.s();!(n=r.n()).done;){const e=n.value;Xe.delete(e)}}catch(e){r.e(e)}finally{r.f()}return t})(e);We(S.RemoveHighlightsById,{ids:t})})(e)}catch(e){throw ze.error=new Error(e),ze.error}}static setHighlight(e){void 0!==e.range&&(e.start=e.range.start,e.end=e.range.end,delete e.range);try{(e=>{(e=>{Xe.set(e.id||b(),e)})(e),We(S.SetHighlights,{highlights:Array.from(Xe.values())})})(e)}catch(e){throw ze.error=new Error(e),ze.error}}static clearHighlights(){try{(()=>{const e=(()=>{const e=[];return Xe.forEach(((t,n)=>{e.push(n)})),Xe.clear(),e})();We(S.RemoveHighlightsById,{ids:e})})()}catch(e){throw ze.error=new Error(e),ze.error}}static getRectsByRange(e){try{return(e=>We(S.GetRectsByRange,{range:e}))(e)}catch(e){throw ze.error=new Error(e),ze.error}}static getAllObjects(){try{return We(S.GetAllObjects)}catch(e){throw ze.error=new Error(e),ze.error}}static getObjectById(e){try{return(e=>We(S.GetObjectById,{objectId:e}))(e)}catch(e){throw ze.error=new Error(e),ze.error}}static getInlineObjectByIndex(e){try{return(e=>We(S.GetObjectByIndex,{objectType:"inline",index:e}))(e)}catch(e){throw ze.error=new Error(e),ze.error}}static getParagraphStarts(){try{return We(S.GetParagraphStarts)}catch(e){throw ze.error=new Error(e),ze.error}}}class Ye extends t.SelectionHandler{getSelectionContext(){if(ze.hasErrors)return null;try{return{text:ze.getDocsSelection(),offset:ze.getCursor().start}}catch(e){return null}}getRectsByRange(e,t,n){if(ze.hasErrors)return null;try{return ze.getRectsByRange({start:t,end:t+n})}catch(e){return null}}}class Je{static sObjectMarker="*";readObjects(e,t){let n=[];const r=e.length;for(let o=0;o<r;++o)if(e[o]==Je.sObjectMarker){const e=ze.getInlineObjectByIndex(o+t);e&&n.push({index:o,object:e})}return n}}const Qe="dji-overlay-id";class Ze extends t.DocumentTextHighlighter{mHighlight=null;mFocusListener;constructor(){super(),this.mHighlight={start:0,end:0,backgroundColor:"#000000",textColor:"#71FDFE",zIndex:1e4,id:Qe},this.mFocusListener=e=>{e.isTrusted||(e.preventDefault(),e.stopImmediatePropagation())}}enableHighlight(e,t,r){return ze.hasErrors?(n.Utils.callMethod(r),!1):(document.addEventListener("focus",this.mFocusListener),this.removeHighlight(),n.Utils.callMethod(r),!0)}disableHighlight(e,t,r){if(ze.hasErrors)return n.Utils.callMethod(r),!1;const o=this.removeHighlight();return document.removeEventListener("focus",this.mFocusListener),n.Utils.callMethod(r),o}highlightWord(e,t,r){if(ze.hasErrors)return!1;if(!this.removeHighlight())return!1;let o=t;for(;o>0&&!n.CharSet.wordSeparator.characterIsMember(e.text[o-1]);o-=1);let s=t;for(;s<e.text.length&&!n.CharSet.wordSeparator.characterIsMember(e.text[s]);s+=1);return this.setHighlight(o+e.offset,s+e.offset,r)}highlight(e,t,n,r){return!ze.hasErrors&&!!this.removeHighlight()&&this.setHighlight(t+e.offset,t+n+e.offset,r)}setHighlight(e,t,n){if(ze.hasErrors)return!1;this.mHighlight.start=e,this.mHighlight.end=e===t?t+1:t,this.mHighlight.textColor=n?n.text:"#000000",this.mHighlight.backgroundColor=n?n.word:"#71FDFE";try{return ze.setHighlight(this.mHighlight),!0}catch(e){return!1}}removeHighlight(){if(ze.hasErrors)return!1;try{return ze.removeHighlight(Qe),!0}catch(e){return!1}}}const $e=new DOMParser;function et(e){try{return null!==$e.parseFromString(e,"text/html").body.querySelector("math")}catch(e){return!1}}function tt(e){const t=e;return void 0!==t.url&&void 0!==t.description}class nt extends t.TextMappingStrategy{constructor(){super(t.TextMappingStrategyOrigin.CARET,!1)}getPositionInText(e,t,r){super.initialize(null,0);let o=Math.max(t.end-1,0);const s=e.length;for(;o<s-1&&!n.CharSet.wordSeparator.characterIsMember(e[o]);)o+=1;return o}}class rt extends t.DocumentTextReader{mSelectionHandler=null;mTextHighlighter=null;mObjectReader=null;get selectionHandler(){return this.mSelectionHandler||(this.mSelectionHandler=new Ye),this.mSelectionHandler}get textHighlighter(){return this.mTextHighlighter||(this.mTextHighlighter=new Ze),this.mTextHighlighter}get objectReader(){return this.mObjectReader||(this.mObjectReader=new Je),this.mObjectReader}getTextContent(e,t,n){if(ze.hasErrors)return{text:null,offset:0};try{const n=ze.getDocumentText(),r=n.length,o=ze.getCursor();if(0===r)return{text:"",offset:0};const s=e.getPositionInText(n,o,!0);if(s<0)return{text:null,offset:0};const i=t.getPositionInText(n,{start:o.start,end:o.end},!1);if(i<0)return{text:null,offset:0};const a=Math.min(s,i);let l=Math.max(s,i);a===l&&(l+=1);let c=n.substring(a,l).replaceAll(/[\x03\x10\x11\x12\x1C]/g," ");c=c.replaceAll(/[\u2019]/g,"'");let u={text:c,offset:a,selection:{start:o.start-a,length:Math.abs(o.end-o.start)},custom:{embeddedLocations:[]}};return this.updateContextWithDocumentObjects(u),u}catch(e){return{text:null,offset:0}}}getSelectedContent(){if(ze.hasErrors)return{text:null,offset:0};try{const e=ze.getCursor();if(e.start===e.end)return{text:null,offset:0};const n=new t.StartOfWordMappingStrategy,r=new nt,o=this.getTextContent(n,r,null);return o&&o.text&&this.updateContextWithSelectionBoundingRect(o),o}catch(e){return{text:null,offset:0}}}updateContextWithDocumentObjects(e){const t=this.objectReader.readObjects(e.text,e.offset);if(0===t.length)return;e.translations=[];let n=0,r=0,o=0;const s=e.text.length,i=t.length;for(;n<s&&o<i;){const s=t[o];s&&s.index===n&&tt(s.object)&&s.object.description&&(r<n&&e.translations.push({text:e.text.substring(r,n),isTranslated:!1}),e.translations.push({text:s.object.description,isTranslated:!1,isMath:et(s.object.description),mathFormat:"mathml"}),r=n+1,o+=1),++n}r<s&&e.translations.push({text:e.text.substring(r,s),isTranslated:!1})}updateContextWithSelectionBoundingRect(e){e.boundingRect=null;const t=ze.getRectsByRange({start:e.offset+e.selection.start,end:e.offset+e.selection.start+e.selection.length-1});if(t&&t.length>0){const n=t.reduce(((e,t,n,r)=>e?e.width<t.width?t:e:t));e.boundingRect=new DOMRectReadOnly(n.left,n.top,n.width,n.height)}}}class ot extends u{createTextReader(){return ze.hasErrors?null:new rt}createSelectionHandler(){return ze.hasErrors?null:new Ye}get isLayered(){return!!ze.hasErrors&&super.isLayered}}class st extends t.TextMapperDelegateFactory{doCreateDelegate(e=null){return n.Utils.isGoogleDocs()?window.dji&&window.dji._goog&&Boolean(window.dji._goog.disablePrimaryRenderer)||n.Utils.isOcrRewordifyPopupElement(e)?null:new ot:null}}class it extends t.ParaLineGuideImpl{setColors(e){return!1}paragraphAtPoint(e,t,n){const o=document.elementFromPoint(e,t);return o&&(o.closest("div.kix-canvas-tile-content")||o.closest("div.kix-rotatingtilemanager"))?r.paragraphFromPoint(n,e,t):null}highlightParagraphAt(e,t,n){return!1}clearHighlights(e){return!1}}t.TextMapperDelegateFactory.registerFactory(new C),t.TextMapperDelegateFactory.registerFactory(new st),t.ParaLineGuide.registerGuideImpl(new it),t.ParaLineGuide.registerGuideImpl(new E),e.DJIHookGoogleSlides=y,Object.defineProperty(e,"__esModule",{value:!0})}));
