window.dji=window.dji||{};
(function(p){function v(){h=f.Running}function w(a){m=!1;e=0;switch(a.error){case "audio-capture":e=404;break;case "not-allowed":e=window.dji.mediaDevices.isMicrophoneUnavailable()?404:401;break;case "network":e=408;break;case "no-speech":break;default:e=500}0!==e&&k("error",e)}function x(){k("audiostart")}function y(){k("audioend")}function z(){k("soundstart")}function A(){k("soundend")}function B(){k("speechstart")}function C(){k("speechend")}function D(){if(m)setTimeout(function(){c.start()},0);
else{var a=g.end,b=e,d=l;h=f.Idle;g.progress=null;l=g.end=null;e=0;k("end",void 0,d);q(a,{error:b},d)}}function E(a){let b="";for(let d=a.resultIndex;d<a.results.length;++d)a.results[d].isFinal&&(b+=F(a.results[d][0].transcript));b=b.trim();0<b.length&&q(g.progress,{error:0,text:b},l)}function F(a){let b=a;c.lang.startsWith("en")&&null===a.match(G)&&H.forEach(d=>{d.atEnd?b.endsWith(d.input)&&(b=b.substring(0,b.length-d.input.length).trimEnd()+d.output):b=b.replace(d.input.trim(),d.output)});return b}
function k(a,b,d){if(g.notification)try{g.notification({type:a,data:b},d||l)}catch(n){Logger.instance.error(n)}}function q(a){if(a)try{a.apply(this,[].slice.call(arguments).splice(1))}catch(b){Logger.instance.error(b)}}let f={NoInitialized:0,Idle:1,Starting:2,Running:3,Stopping:4},c=null,r={US:"en-US",UK:"en-GB",BE:"en-GB",CAN:"en-CA",FR:"fr-FR",SPA:"es-ES",GER:"de-DE"};const G=RegExp("[.!?,]"),H=[{input:"period",output:".",atEnd:!0},{input:"exclamation mark",output:"!",atEnd:!0},{input:"exclamation point",
output:"!",atEnd:!0},{input:"question mark",output:"?",atEnd:!0},{input:"comma",output:",",atEnd:!0}];let h=f.NoInitialized,m=!1,g={notification:null,progress:null,end:null},l=null,e=0;p.initialize=function(){"webkitSpeechRecognition"in window&&!c&&(c=new webkitSpeechRecognition,c.continuous=!1,c.interimResults=!1,c.onstart=v,c.onerror=w,c.onaudiostart=x,c.onaudioend=y,c.onsoundstart=z,c.onsoundend=A,c.onspeechstart=B,c.onspeechend=C,c.onresult=E,c.onend=D,h=f.Idle)};p.start=function(a,b,d,n,t){if(h!==
f.Idle)return q(n,{error:503},t);const u=a.toUpperCase();a=r.hasOwnProperty(u)?r[u]:a;g.notification=b;g.progress=d;g.end=n;l=t;e=0;h=f.Starting;m=!0;c.lang=a;c.start()};p.stop=function(a){if(h===f.Running||h===f.Starting)m=!1,h=f.Stopping,c.stop()}})(window.dji.speechRecognition=window.dji.speechRecognition||{});
