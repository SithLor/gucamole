(async function(){function h(a,b,c,f,g){let k=-1,l=function(){CWEChromeUtilities.checkLastError();f.length<=++k?g&&g():chrome.tabs.executeScript(a,{file:f[k],frameId:b,runAt:c},l)};l()}async function d(a){let b=[];try{for(let c of a){let f=chrome.extension.getURL(c),g=await (await fetch(f)).text();b.push(g)}b=b.join("\n")}catch(c){b=null,Logger.instance.error(c)}return b}async function m(){if(d.__promise)return d.__promise;d.__promise=new Promise(async a=>{let b=await d("dex/dexController.css ContentScripts/ui/cweAsNeeded.css ContentScripts/ui/cweUtils.css ContentScripts/ui/cweFonts.css ContentScripts/ui/cweMainView.css Graphics/sprite/cw/sprite.css Graphics/sprite/sprite-common.css".split(" "));
a(b)});return d.__promise}async function e(){if(e.__promise)return e.__promise;e.__promise=new Promise(async a=>{let b=await d(["ContentScripts/ui/cweMainViewTemplates.html"]);a(b)});return e.__promise}async function n(a){let b=await m(),c=await e();a({css:b,html:c})}async function p(){if("loading"===document.readyState)return new Promise(a=>document.addEventListener("DOMContentLoaded",a))}Logger.initialize();Logger.instance.monitor({event:"load_extension",id:chrome.runtime.id,version:chrome.runtime.getManifest().version,
name:chrome.runtime.getManifest().name});Logger.instance.log(`"${chrome.runtime.getManifest().name}" (${chrome.runtime.id})`);chrome.webNavigation.onDOMContentLoaded.addListener(a=>{0!==a.frameId&&0!==a.url.indexOf("about:")&&chrome.tabs.executeScript(a.tabId,{file:"WebExtensions/frames/djiFramePreloader.js",frameId:a.frameId,runAt:"document_end"},CWEChromeUtilities.createLastErrorHandler())});chrome.runtime.onMessage.addListener(function(a,b,c){if("com.donjohnston.dji.service.load"===a.message)"ms-office-word-editor"===
a.service?h(b.tab.id,b.frameId,"document_end","ThirdParty/mark/mark.min.js libs/core-lib-utils.umd.js Common/core-lib-utils-adapter.js libs/core-lib-text-mapper.umd.js Common/core-lib-text-mapper-adapter.js libs/core-lib-text-mapper-msoffice.umd.js WebExtensions/frames/frameManager.js".split(" ")):"canvas-lms"===a.service&&h(b.tab.id,b.frameId,"document_end",["libs/core-lib-utils.umd.js","Common/core-lib-utils-adapter.js","libs/core-lib-text-mapper.umd.js","Common/core-lib-text-mapper-adapter.js",
"WebExtensions/frames/frameManager.js"]);else if(a.message===window.dji.messages.cwe.ui.RESOURCES)return n(c),!0});m();(async function(){Logger.instance.monitor({event:"init_extension_wait",doc_state:document.readyState});await p();Logger.instance.monitor({event:"init_extension_start",doc_state:document.readyState});await CWEBackgroundManager.initialize();Logger.instance.monitor({event:"init_extension_called",doc_state:document.readyState})})()})();
